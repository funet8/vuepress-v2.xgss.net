import{_ as a}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as e,a as n,o as i}from"./app-BiQR_lPj.js";const l={};function r(d,s){return i(),e("div",null,s[0]||(s[0]=[n(`<h1 id="docker系列教程4-使用docker-hub并将镜像推送到自有仓库" tabindex="-1"><a class="header-anchor" href="#docker系列教程4-使用docker-hub并将镜像推送到自有仓库"><span>Docker系列教程4：使用Docker Hub并将镜像推送到自有仓库</span></a></h1><h1 id="dockerhub是什么" tabindex="-1"><a class="header-anchor" href="#dockerhub是什么"><span>DockerHub是什么</span></a></h1><p>目前 Docker 官方维护了一个公共仓库 Docker Hub，其中已经包括了数量超过 2,650,000 的镜像。大部分需求都可以通过在 Docker Hub 中直接下载镜像来实现。</p><p>我更愿意把他类比 github，docker是存放镜像，github是存放代码的。</p><p>这样自己制作的镜像就可以把它推送（docker push）到DockerHub，要使用的时候直接拉取（docker pull），让开发更加灵活。</p><p>本次教程主要有三部分就教<strong>1.如何使用DockerHub</strong>，当然由于DockerHub在国内访问慢的原因，<strong>2.将镜像推送到阿里云的DockerHub仓库</strong>，<strong>3.创建一个私有Docker仓库</strong>。</p><p><img src="https://imgoss.xgss.net/picgo/image-20221205105530964.png?aliyun" alt="image-20221205105530964"></p><h1 id="一、使用docker-hub" tabindex="-1"><a class="header-anchor" href="#一、使用docker-hub"><span>一、使用Docker Hub</span></a></h1><p>Docker Hub 存放着 Docker镜像 及其组件的所有资源。Docker Hub 可以帮助你与同事之间协作，并获得功能完整的 Docker。为此，它提供的服务有：</p><ul><li>Docker 镜像主机</li><li>用户认证</li><li>自动镜像构建和工作流程工具，如构建触发器和 web hooks</li><li>整合了 GitHub 和 BitBucket</li></ul><h2 id="_1-创建-docker-hub-账户" tabindex="-1"><a class="header-anchor" href="#_1-创建-docker-hub-账户"><span>1.创建 Docker Hub 账户</span></a></h2><p><a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">注册账户</a>： https://hub.docker.com/ ，输入个人信息，如果有账号可以忽略。</p><p><img src="https://imgoss.xgss.net/picgo/image-20221203152739869.png?aliyun" alt="image-20221203152739869"></p><h2 id="_2-通过命令来登录" tabindex="-1"><a class="header-anchor" href="#_2-通过命令来登录"><span>2.通过命令来登录</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>## 登录</span></span>
<span class="line"><span># docker login</span></span>
<span class="line"><span>输入注册的账号和密码</span></span>
<span class="line"><span></span></span>
<span class="line"><span>账号是：starb</span></span>
<span class="line"><span></span></span>
<span class="line"><span>##退出</span></span>
<span class="line"><span># docker logout</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输入用户名和密码。</p><p><img src="https://imgoss.xgss.net/picgo/image-20221203155516562.png?aliyun" alt="image-20221203155516562"></p><h2 id="_3-给镜像打个标签" tabindex="-1"><a class="header-anchor" href="#_3-给镜像打个标签"><span>3.给镜像打个标签</span></a></h2><p>你可以给现有的镜像添加标记，然后提交和构建。我们可以使用<code>docker tag</code>命令。让我们给<code>training/webapp</code>镜像添加一个新的标签。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>1.拉取镜像：</span></span>
<span class="line"><span># docker pull training/webapp</span></span>
<span class="line"><span>Trying to pull repository docker.io/training/webapp</span></span>
<span class="line"><span></span></span>
<span class="line"><span>2.查看镜像:</span></span>
<span class="line"><span># docker images training/webapp</span></span>
<span class="line"><span>REPOSITORY                  TAG                 IMAGE ID            CREATED             SIZE</span></span>
<span class="line"><span>docker.io/training/webapp   latest              6fae60ef3446        7 years ago         349 MB</span></span>
<span class="line"><span></span></span>
<span class="line"><span>3.重新打镜像：</span></span>
<span class="line"><span># docker tag 6fae60ef3446 starb/webapp:v1.1</span></span>
<span class="line"><span></span></span>
<span class="line"><span>4.查看新的标签：</span></span>
<span class="line"><span># docker images starb/webapp</span></span>
<span class="line"><span>REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span></span>
<span class="line"><span>newtag/webapp       v1.1                6fae60ef3446        7 years ago         349 MB</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-向docker-hub推送镜像" tabindex="-1"><a class="header-anchor" href="#_4-向docker-hub推送镜像"><span>4.向Docker Hub推送镜像</span></a></h2><p>一旦你构建或创造一个新的镜像，你可以使用<code>docker push</code>命令推送到Docker Hub。可以对其他人公开进行分享，或把它添加到你的私人仓库中。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span># docker push starb/webapp:v1.1</span></span>
<span class="line"><span>The push refers to a repository [docker.io/newtag/webapp]</span></span>
<span class="line"><span>5f70bf18a086: Preparing</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://imgoss.xgss.net/picgo/image-20221203160125609.png?aliyun" alt="image-20221203160125609"></p><p>再进入你的dockerHub个人页面</p><p><img src="https://imgoss.xgss.net/picgo/image-20221203160243598.png?aliyun" alt="image-20221203160243598"></p><p>有了刚才push的镜像。</p><p>可以把自己的</p><h2 id="_5-把镜像设置为私有" tabindex="-1"><a class="header-anchor" href="#_5-把镜像设置为私有"><span>5.把镜像设置为私有</span></a></h2><p>私有需要登录之后才能拉取，免费的账号私有仓库只能是一个，公共仓库无限制。</p><p><img src="https://imgoss.xgss.net/picgo/image-20221203161536173.png?aliyun" alt="image-20221203161536173"></p><p><img src="https://imgoss.xgss.net/picgo/image-20221203161604928.png?aliyun" alt="image-20221203161604928"></p><h2 id="_6-拉取刚才的镜像" tabindex="-1"><a class="header-anchor" href="#_6-拉取刚才的镜像"><span>6.拉取刚才的镜像</span></a></h2><p>在其他的服务器作为客户端就可以拉取镜像了</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span># docker pull starb/webapp:v1.1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h1 id="二、使用阿里云docker镜像仓库加速" tabindex="-1"><a class="header-anchor" href="#二、使用阿里云docker镜像仓库加速"><span>二、使用阿里云Docker镜像仓库加速</span></a></h1><p>官方镜像下载有时候实在是慢，于是开通了阿里云开发者帐号。</p><p>1.阿里云-云容器Hub服务：<a href="https://cr.console.aliyun.com/" target="_blank" rel="noopener noreferrer">https://cr.console.aliyun.com/</a></p><p>使用方法跟DockerHub大同小异，只是仓库地址改为阿里云的地址，速度比官网杠杠滴。</p><h2 id="_1-登录阿里云docker-registry" tabindex="-1"><a class="header-anchor" href="#_1-登录阿里云docker-registry"><span>1.登录阿里云docker registry:</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>$ sudo docker login --username=funet8@163.com registry.cn-shenzhen.aliyuncs.com</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>登录registry的用户名是您的阿里云账号全名，密码是您开通服务时设置的密码。</p><p>你可以在镜像管理首页点击右上角按钮修改docker login密码。</p><h2 id="_2-从registry中拉取镜像" tabindex="-1"><a class="header-anchor" href="#_2-从registry中拉取镜像"><span>2.从registry中拉取镜像：</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>$ sudo docker pull registry.cn-shenzhen.aliyuncs.com/funet8/centos7.1:[镜像版本号]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_3-将镜像推送到registry" tabindex="-1"><a class="header-anchor" href="#_3-将镜像推送到registry"><span>3.将镜像推送到registry：</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>$ sudo docker login --username=funet8@163.com registry.cn-shenzhen.aliyuncs.com</span></span>
<span class="line"><span>$ sudo docker tag [ImageId] registry.cn-shenzhen.aliyuncs.com/funet8/centos7.1:[镜像版本号]</span></span>
<span class="line"><span>$ sudo docker push registry.cn-shenzhen.aliyuncs.com/funet8/centos7.1:[镜像版本号]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中[ImageId],[镜像版本号]请你根据自己的镜像信息进行填写。</p><h3 id="注意您的网络环境" tabindex="-1"><a class="header-anchor" href="#注意您的网络环境"><span><strong>注意您的网络环境</strong></span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>从ECS推送镜像时，可以选择走内网，速度将大大提升，并且将不会损耗您的公网流量。</span></span>
<span class="line"><span></span></span>
<span class="line"><span>如果您申请的机器是在经典网络，请使用 registry-internal.cn-hangzhou.aliyuncs.com 作为registry的域名登录, 并作为镜像名空间前缀</span></span>
<span class="line"><span></span></span>
<span class="line"><span>如果您申请的机器是在vpc网络的，请使用 registry-vpc.cn-hangzhou.aliyuncs.com 作为registry的域名登录, 并作为镜像名空间前缀</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>sample:</p><p>使用docker tag重命名镜像，并将它通过私网ip推送至registry：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>$ sudo docker images</span></span>
<span class="line"><span></span></span>
<span class="line"><span>REPOSITORY                                                         TAG                 IMAGE ID            CREATED             VIRTUAL SIZE</span></span>
<span class="line"><span>registry.aliyuncs.com/acs/agent                                    0.7-dfb6816         37bb9c63c8b2        7 days ago          37.89 MB</span></span>
<span class="line"><span></span></span>
<span class="line"><span>$ sudo docker tag 37bb9c63c8b2 registry..aliyuncs.com/acs/agent:0.7-dfb6816</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="三、创建私有仓库registry" tabindex="-1"><a class="header-anchor" href="#三、创建私有仓库registry"><span>三、创建私有仓库registry</span></a></h1><p>有时候使用 Docker Hub 这样的公共仓库可能不方便，用户可以创建一个本地仓库供私人使用。</p><h2 id="安装运行-docker-registry" tabindex="-1"><a class="header-anchor" href="#安装运行-docker-registry"><span>安装运行 docker-registry</span></a></h2><p>你可以使用官方 <code>registry</code> 镜像来运行。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># docker run -d -p 5000:5000 --restart=always --name registry registry</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">或者：</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># docker run -d \\</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 5000:5000</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-v </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/opt/data/registry:/var/lib/registry</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">registry</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># docker ps</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">CONTAINER</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ID</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        IMAGE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">               COMMAND</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                  CREATED</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">             STATUS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">              PORTS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                    NAMES</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ac3a01e3641f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        registry</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">            &quot;/entrypoint.sh /e...&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   7</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> seconds</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ago</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       Up</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> seconds</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        0.0.0.0:5000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">5000/tcp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   confident_aryabhata</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这将使用官方的 <code>registry</code> 镜像来启动私有仓库。默认情况下，仓库会被创建在容器的 <code>/var/lib/registry</code> 目录下。你可以通过 <code>-v</code> 参数来将镜像文件存放在本地的指定路径。例如下面的例子将上传的镜像放到本地的 <code>/opt/data/registry</code> 目录。</p><h2 id="在私有仓库上传、搜索、下载镜像" tabindex="-1"><a class="header-anchor" href="#在私有仓库上传、搜索、下载镜像"><span>在私有仓库上传、搜索、下载镜像</span></a></h2><p>创建好私有仓库之后，就可以使用 <code>docker tag</code> 来标记一个镜像，然后推送它到仓库。例如私有仓库地址为 <code>127.0.0.1:5000</code>。</p><h3 id="查看已有的镜像" tabindex="-1"><a class="header-anchor" href="#查看已有的镜像"><span>查看已有的镜像</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span># docker image ls</span></span>
<span class="line"><span>REPOSITORY                                         TAG                 IMAGE ID            CREATED             SIZE</span></span>
<span class="line"><span>docker.io/registry                                 latest              81c944c2288b        2 weeks ago         24.1 MB</span></span>
<span class="line"><span>docker.io/adguard/adguardhome                      latest              18aae264c84e        8 weeks ago         81 MB</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="使用-docker-tag将-adguardhome打标签" tabindex="-1"><a class="header-anchor" href="#使用-docker-tag将-adguardhome打标签"><span>使用 docker tag将 adguardhome打标签</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>格式为： docker tag IMAGE[:TAG] [REGISTRY_HOST[:REGISTRY_PORT]/]REPOSITORY[:TAG]</span></span>
<span class="line"><span></span></span>
<span class="line"><span># docker tag docker.io/adguard/adguardhome 127.0.0.1:5000/adguardhome:v1.0</span></span>
<span class="line"><span>查看：</span></span>
<span class="line"><span># docker images|grep adguardhome</span></span>
<span class="line"><span>127.0.0.1:5000/adguardhome                         v1.0                18aae264c84e        8 weeks ago         81 MB</span></span>
<span class="line"><span>docker.io/adguard/adguardhome                      latest              18aae264c84e        8 weeks ago         81 MB</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="使用-docker-push上传标记的镜像" tabindex="-1"><a class="header-anchor" href="#使用-docker-push上传标记的镜像"><span>使用 docker push上传标记的镜像</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span># docker push 127.0.0.1:5000/adguardhome:v1.0</span></span>
<span class="line"><span>The push refers to a repository [127.0.0.1:5000/adguardhome]</span></span>
<span class="line"><span>5f70bf18a086: Pushed </span></span>
<span class="line"><span>d4178a974467: Pushed </span></span>
<span class="line"><span>7a26e5e5ccf8: Pushed </span></span>
<span class="line"><span>e5bf41d9e3f6: Pushed </span></span>
<span class="line"><span>994393dc58e7: Pushed </span></span>
<span class="line"><span>v1.0: digest: sha256:2a474fedc96c41c3b1c48d1b1dacbfbe78fb194353dced082914bf5d1e5c2217 size: 1368</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="用-curl-查看仓库中的镜像。" tabindex="-1"><a class="header-anchor" href="#用-curl-查看仓库中的镜像。"><span>用 curl 查看仓库中的镜像。</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>$ # curl 127.0.0.1:5000/v2/_catalog</span></span>
<span class="line"><span>{&quot;repositories&quot;:[&quot;adguardhome&quot;]}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>表明镜像已经被成功上传了。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>先删除已有镜像，再尝试从私有仓库中下载这个镜像。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>删除镜像：</span></span>
<span class="line"><span># docker image rm 127.0.0.1:5000/adguardhome:v1.0</span></span>
<span class="line"><span># docker images|grep adguardhome</span></span>
<span class="line"><span>docker.io/adguard/adguardhome                      latest              18aae264c84e        8 weeks ago         81 MB</span></span>
<span class="line"><span></span></span>
<span class="line"><span>拉取镜像</span></span>
<span class="line"><span>#  docker pull 127.0.0.1:5000/adguardhome:v1.0</span></span>
<span class="line"><span>Trying to pull repository 127.0.0.1:5000/adguardhome ... </span></span>
<span class="line"><span>v1.0: Pulling from 127.0.0.1:5000/adguardhome</span></span>
<span class="line"><span>Digest: sha256:2a474fedc96c41c3b1c48d1b1dacbfbe78fb194353dced082914bf5d1e5c2217</span></span>
<span class="line"><span>Status: Downloaded newer image for 127.0.0.1:5000/adguardhome:v1.0</span></span>
<span class="line"><span></span></span>
<span class="line"><span>查看镜像：</span></span>
<span class="line"><span># docker images|grep adguardhome</span></span>
<span class="line"><span>127.0.0.1:5000/adguardhome                         v1.0                18aae264c84e        8 weeks ago         81 MB</span></span>
<span class="line"><span>docker.io/adguard/adguardhome                      latest              18aae264c84e        8 weeks ago         81 MB</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="配置非-https-仓库地址" tabindex="-1"><a class="header-anchor" href="#配置非-https-仓库地址"><span>配置非 https 仓库地址</span></a></h2><p>如果你不想使用 <code>127.0.0.1:5000</code> 作为仓库地址，比如想让本网段的其他主机也能把镜像推送到私有仓库。你就得把例如 <code>192.168.1.3:5000</code> 这样的内网地址作为私有仓库地址，这时你会发现无法成功推送镜像。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span># docker pull 192.168.1.3:5000/adguardhome:v1.0</span></span>
<span class="line"><span>Trying to pull repository 192.168.1.3:5000/adguardhome ... </span></span>
<span class="line"><span>Get https://192.168.1.3:5000/v1/_ping: http: server gave HTTP response to HTTPS client</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这是因为 Docker 默认不允许非 <code>HTTPS</code> 方式推送镜像。我们可以通过 Docker 的配置选项来取消这个限制，或者查看下一节配置能够通过 <code>HTTPS</code> 访问的私有仓库。</p><h3 id="ubuntu-16-04-debian-8-centos-7" tabindex="-1"><a class="header-anchor" href="#ubuntu-16-04-debian-8-centos-7"><span>Ubuntu 16.04+, Debian 8+, centos 7</span></a></h3><p>对于使用 <code>systemd</code> 的系统，请在 <code>/etc/docker/daemon.json</code> 中写入如下内容（如果文件不存在请新建该文件）</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>{</span></span>
<span class="line"><span>  &quot;registry-mirror&quot;: [</span></span>
<span class="line"><span>    &quot;https://hub-mirror.c.163.com&quot;,</span></span>
<span class="line"><span>    &quot;https://mirror.baidubce.com&quot;</span></span>
<span class="line"><span>  ],</span></span>
<span class="line"><span>  &quot;insecure-registries&quot;: [</span></span>
<span class="line"><span>    &quot;192.168.1.3:5000&quot;</span></span>
<span class="line"><span>  ]</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>再重启</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span># docker pull 192.168.1.3:5000/adguardhome:v1.0</span></span>
<span class="line"><span>Trying to pull repository 192.168.1.3:5000/adguardhome ... </span></span>
<span class="line"><span>v1.0: Pulling from 192.168.1.3:5000/adguardhome</span></span>
<span class="line"><span>213ec9aee27d: Pull complete </span></span>
<span class="line"><span>31f9e8542749: Pull complete </span></span>
<span class="line"><span>35797e6c4bae: Pull complete </span></span>
<span class="line"><span>3c40b1afc955: Download complete </span></span>
<span class="line"><span>4f4fb700ef54: Download complete</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="docker-镜像加速" tabindex="-1"><a class="header-anchor" href="#docker-镜像加速"><span>Docker 镜像加速</span></a></h1><p>国内从 DockerHub 拉取镜像有时会遇到困难，此时可以配置镜像加速器。Docker 官方和国内很多云服务商都提供了国内加速器服务，例如：</p><p>网易：https://hub-mirror.c.163.com/</p><p>阿里云：https://&lt;你的ID&gt;.mirror.aliyuncs.com</p><p>七牛云加速器：https://reg-mirror.qiniu.com</p><p>当配置某一个加速器地址之后，若发现拉取不到镜像，请切换到另一个加速器地址。国内各大云服务商均提供了 Docker 镜像加速服务，建议根据运行 Docker 的云平台选择对应的镜像加速服务。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>https://cr.console.aliyun.com/</span></span>
<span class="line"><span>登录：</span></span>
<span class="line"><span>https://cr.console.aliyun.com/cn-shenzhen/instances/mirrors</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://imgoss.xgss.net/picgo/image-20221203161839102.png?aliyun" alt="image-20221203161839102"></p><h2 id="配置镜像加速器" tabindex="-1"><a class="header-anchor" href="#配置镜像加速器"><span>配置镜像加速器</span></a></h2><p>针对Docker客户端版本大于 1.10.0 的用户</p><p>您可以通过修改daemon配置文件/etc/docker/daemon.json来使用加速器</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>$ sudo mkdir -p /etc/docker</span></span>
<span class="line"><span>$ sudo tee /etc/docker/daemon.json &lt;&lt;-&#39;EOF&#39;</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  &quot;registry-mirrors&quot;: [&quot;https://otow63ff.mirror.aliyuncs.com&quot;] # 可以设置自己的地址</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>EOF</span></span>
<span class="line"><span>$ sudo systemctl daemon-reload</span></span>
<span class="line"><span>$ sudo systemctl restart docker</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上就是使用DockerHub和用阿里云的DockerHub加速的教程，用好了真的很方便。</p>`,93)]))}const t=a(l,[["render",r]]),h=JSON.parse('{"path":"/article/jxg5jf9k/","title":"Docker系列教程4-使用DockerHub并将镜像推送到自有仓库","lang":"en-US","frontmatter":{"title":"Docker系列教程4-使用DockerHub并将镜像推送到自有仓库","createTime":"2025/05/27 17:51:17","permalink":"/article/jxg5jf9k/"},"git":{"createdTime":1749111496000,"updatedTime":1750129445000,"contributors":[{"name":"star","username":"star","email":"star@xgss.net","commits":2,"url":"https://github.com/star"}]},"readingTime":{"minutes":7.1,"words":2131},"filePathRelative":"docker/Docker系列教程4-使用DockerHub并将镜像推送到自有仓库.md"}');export{t as comp,h as data};
