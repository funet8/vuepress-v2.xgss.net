import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as n,o as l}from"./app-BiQR_lPj.js";const e={};function t(r,s){return l(),a("div",null,s[0]||(s[0]=[n(`<h1 id="日志系统-rsyslog-journald-等日志系统的配置与使用" tabindex="-1"><a class="header-anchor" href="#日志系统-rsyslog-journald-等日志系统的配置与使用"><span>日志系统：rsyslog / journald 等日志系统的配置与使用</span></a></h1><h2 id="_1️⃣-前言" tabindex="-1"><a class="header-anchor" href="#_1️⃣-前言"><span>1️⃣ 前言</span></a></h2><p>在 Linux 系统运维与开发中，日志是定位问题、审计安全事件、分析系统状态的核心依据。</p><p>在 Linux 系统环境下，rsyslog 和 journald 是两款应用最为广泛的日志系统，前者以灵活的转发机制和丰富的过滤规则著称，后者则凭借与 systemd 的深度集成和高效的二进制日志存储特性成为主流选择。本文将从日志系统的基础认知出发，详细讲解 rsyslog 与 journald 的配置方法、常用操作，并对比两者的核心差异，帮助运维人员根据实际场景选择合适的日志解决方案。</p><h3 id="日志系统的核心作用" tabindex="-1"><a class="header-anchor" href="#日志系统的核心作用"><span>日志系统的核心作用</span></a></h3><p>日志系统的核心价值体现在以下四个方面：</p><ul><li><p><strong>故障排查</strong>：当系统出现服务崩溃、网络中断、权限错误等问题时，日志可提供事件发生的时间、进程 ID、错误代码等关键信息，帮助定位问题根源（例如通过 SSH 登录失败日志排查暴力破解行为）。</p></li><li><p><strong>系统监控</strong>：通过分析日志中的资源占用（如 CPU、内存使用率）、进程启停记录，可实时掌握系统运行状态，提前发现潜在风险（如频繁重启的服务可能存在内存泄漏）。</p></li><li><p><strong>安全审计</strong>：日志记录了用户登录、文件修改、权限变更等操作，可用于追溯违规行为（如某用户删除关键配置文件的操作轨迹），满足合规审计需求（如金融行业的安全日志留存要求）。</p></li><li><p><strong>性能分析</strong>：通过长期收集的日志数据（如数据库查询耗时、网络请求响应时间），可分析系统性能瓶颈，为架构优化提供数据支撑（如优化高频访问的数据库索引）。</p></li></ul><hr><h2 id="_2️⃣-日志系统概览" tabindex="-1"><a class="header-anchor" href="#_2️⃣-日志系统概览"><span>2️⃣ 日志系统概览</span></a></h2><table><thead><tr><th>特性</th><th>rsyslog</th><th>journald</th></tr></thead><tbody><tr><td><strong>日志存储</strong></td><td>文本文件（/var/log/）</td><td>二进制日志（journal 文件）</td></tr><tr><td><strong>性能</strong></td><td>高性能，支持异步写入</td><td>内存+磁盘混合存储</td></tr><tr><td><strong>过滤与路由</strong></td><td>强大规则引擎，支持条件转发</td><td>基本过滤，需配合 <code>journalctl</code></td></tr><tr><td><strong>网络传输</strong></td><td>支持 TCP/UDP、加密传输</td><td>不直接支持</td></tr><tr><td><strong>兼容性</strong></td><td>兼容 syslog 协议</td><td>systemd 环境原生支持</td></tr><tr><td><strong>适用场景</strong></td><td>集中日志、跨主机收集</td><td>本地日志管理、systemd 服务调试</td></tr></tbody></table><hr><h2 id="_3️⃣-journald-配置与使用" tabindex="-1"><a class="header-anchor" href="#_3️⃣-journald-配置与使用"><span>3️⃣ journald 配置与使用</span></a></h2><h3 id="_3-1-配置文件位置" tabindex="-1"><a class="header-anchor" href="#_3-1-配置文件位置"><span>3.1 配置文件位置</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>/etc/systemd/journald.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>常用配置项：</p><div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-ini"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">[Journal]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">Storage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">persistent       </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 持久化到磁盘（/var/log/journal）</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">Compress</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">yes             </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 压缩旧日志</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">SystemMaxUse</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">1G          </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 限制总占用空间</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">MaxFileSec</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">1month        </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 单文件最大保存时间</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改后重启：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemd-journald</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_3-2-常用命令" tabindex="-1"><a class="header-anchor" href="#_3-2-常用命令"><span>3.2 常用命令</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看所有日志</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">journalctl</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看指定服务日志</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">journalctl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nginx</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 实时跟踪日志</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">journalctl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看指定时间段</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">journalctl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --since</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;2025-09-01&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --until</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;2025-09-08&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="_4️⃣-rsyslog-配置与使用" tabindex="-1"><a class="header-anchor" href="#_4️⃣-rsyslog-配置与使用"><span>4️⃣ rsyslog 配置与使用</span></a></h2><h3 id="_4-1-配置文件位置" tabindex="-1"><a class="header-anchor" href="#_4-1-配置文件位置"><span>4.1 配置文件位置</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>/etc/rsyslog.conf</span></span>
<span class="line"><span>/etc/rsyslog.d/*.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-基本配置示例" tabindex="-1"><a class="header-anchor" href="#_4-2-基本配置示例"><span>4.2 基本配置示例</span></a></h3><div class="language-conf line-numbers-mode" data-highlighter="shiki" data-ext="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-conf"><span class="line"><span># 接收本地日志</span></span>
<span class="line"><span>module(load=&quot;imuxsock&quot;)   # Unix socket</span></span>
<span class="line"><span>module(load=&quot;imklog&quot;)     # 内核日志</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 保存不同类型日志</span></span>
<span class="line"><span>authpriv.*    /var/log/secure</span></span>
<span class="line"><span>mail.*        -/var/log/maillog</span></span>
<span class="line"><span>*.info;mail.none;authpriv.none;cron.none   /var/log/messages</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 远程日志转发</span></span>
<span class="line"><span>*.* @@192.168.1.100:514   # TCP</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重启服务：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rsyslog</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h2 id="_5️⃣-rsyslog-journald-协同工作" tabindex="-1"><a class="header-anchor" href="#_5️⃣-rsyslog-journald-协同工作"><span>5️⃣ rsyslog + journald 协同工作</span></a></h2><p>在大多数 systemd 系统中，<strong>journald 会先收集日志，再转发给 rsyslog</strong>，由 rsyslog 进行持久化或转发。 配置转发：</p><div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-ini"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># /etc/systemd/journald.conf</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">ForwardToSyslog</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">yes</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>这样可以：</p><ul><li>journald 提供统一入口（包括 systemd 服务日志）</li><li>rsyslog 提供灵活的存储与网络转发</li></ul><hr><h2 id="_6️⃣-日志优化与安全建议" tabindex="-1"><a class="header-anchor" href="#_6️⃣-日志优化与安全建议"><span>6️⃣ 日志优化与安全建议</span></a></h2><ul><li><strong>持久化策略</strong>：journald 默认存内存，建议开启 <code>Storage=persistent</code></li><li><strong>日志轮转</strong>：rsyslog 配合 <code>logrotate</code> 定期压缩、删除旧日志</li><li><strong>访问控制</strong>：限制 <code>/var/log/</code> 权限，防止敏感信息泄露</li><li><strong>集中化收集</strong>：使用 rsyslog + TCP/TLS 将日志集中到 ELK、Graylog 等平台</li><li><strong>过滤无用日志</strong>：减少磁盘占用与分析成本</li></ul><hr><h2 id="_7️⃣-实战案例-集中收集-nginx-日志到日志服务器" tabindex="-1"><a class="header-anchor" href="#_7️⃣-实战案例-集中收集-nginx-日志到日志服务器"><span>7️⃣ 实战案例：集中收集 Nginx 日志到日志服务器</span></a></h2><p><strong>客户端（Web 服务器）配置：</strong></p><div class="language-conf line-numbers-mode" data-highlighter="shiki" data-ext="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-conf"><span class="line"><span># /etc/rsyslog.d/nginx.conf</span></span>
<span class="line"><span>module(load=&quot;imfile&quot;)</span></span>
<span class="line"><span>input(type=&quot;imfile&quot;</span></span>
<span class="line"><span>      File=&quot;/var/log/nginx/access.log&quot;</span></span>
<span class="line"><span>      Tag=&quot;nginx-access&quot;</span></span>
<span class="line"><span>      Severity=&quot;info&quot;</span></span>
<span class="line"><span>      Facility=&quot;local7&quot;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>local7.* @@logserver.example.com:514</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>日志服务器配置：</strong></p><div class="language-conf line-numbers-mode" data-highlighter="shiki" data-ext="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-conf"><span class="line"><span># /etc/rsyslog.conf</span></span>
<span class="line"><span>module(load=&quot;imtcp&quot;)</span></span>
<span class="line"><span>input(type=&quot;imtcp&quot; port=&quot;514&quot;)</span></span>
<span class="line"><span>local7.* /var/log/nginx_access.log</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="_8️⃣-总结" tabindex="-1"><a class="header-anchor" href="#_8️⃣-总结"><span>8️⃣ 总结</span></a></h2><ul><li><strong>journald</strong>：适合本地调试、统一 systemd 服务日志</li><li><strong>rsyslog</strong>：适合复杂路由、集中化收集、跨主机传输</li><li>两者结合可兼顾 <strong>易用性</strong> 与 <strong>灵活性</strong></li><li>生产环境建议配合 <strong>日志分析平台</strong>（如 ELK、Grafana Loki）实现可视化与告警</li></ul><p>日志系统是 Linux 运维的 “眼睛”，rsyslog 与 journald 作为主流方案，分别代表了传统文本日志与现代二进制日志的技术方向。rsyslog 以兼容性强、远程转发灵活的优势，在分布式日志收集场景中不可或缺；journald 则凭借结构化查询、systemd 深度集成的特性，成为单机运维的高效工具。</p>`,47)]))}const p=i(e,[["render",t]]),o=JSON.parse('{"path":"/%E6%99%BA%E7%BB%B4%E6%94%BB%E5%9F%8E%E7%8B%AE/S15/17.%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F-rsyslog-journald%E7%AD%89%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E7%9A%84%E9%85%8D%E7%BD%AE%E4%B8%8E%E4%BD%BF%E7%94%A8.html","title":"日志系统：rsyslog / journald 等日志系统的配置与使用","lang":"en-US","frontmatter":{},"git":{"createdTime":1760001321000,"updatedTime":1761640845000,"contributors":[{"name":"star","username":"star","email":"star@xgss.net","commits":2,"url":"https://github.com/star"}]},"readingTime":{"minutes":4.11,"words":1234},"filePathRelative":"智维攻城狮/S15/17.日志系统-rsyslog-journald等日志系统的配置与使用.md"}');export{p as comp,o as data};
