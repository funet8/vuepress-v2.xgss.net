import{_ as a}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as e,a as n,o as i}from"./app-BiQR_lPj.js";const l={};function p(d,s){return i(),e("div",null,s[0]||(s[0]=[n(`<h1 id="给你的网站加一道安全锁-免费获取ssl证书" tabindex="-1"><a class="header-anchor" href="#给你的网站加一道安全锁-免费获取ssl证书"><span>给你的网站加一道安全锁，免费获取ssl证书</span></a></h1><p>之前介绍了《<a href="https://cloud.tencent.com/developer/article/2466047" target="_blank" rel="noopener noreferrer">腾讯云轻量应用服务器部署私有笔记</a>》搭建了自己的私有笔记系统，但是没有申请ssl证书，今天来讲一下如何获取免费的ssl证书。</p><p>SSL证书不仅能提升网站的安全性，还能增强用户对网站的信任度，提高网站的转化率。赶快行动起来，为你的网站添加这把安全锁吧！</p><p>当然腾讯云的双十一活动还在继续，可以访问链接： <a href="https://mc.tencent.com/Ijay4BNd" target="_blank" rel="noopener noreferrer">https://mc.tencent.com/Ijay4BNd</a> 选择合适的产品。</p><p><img src="https://imgoss.xgss.net/picgo/image-20241118202323805.png?aliyun" alt="image-20241118202323805"></p><h1 id="什么是ssl证书" tabindex="-1"><a class="header-anchor" href="#什么是ssl证书"><span>什么是SSL证书</span></a></h1><p>SSL（Secure Sockets Layer）证书是一种安全技术，用于加密互联网通信，确保数据在客户端（如浏览器）和服务器之间传输时的安全性和隐私性。它通过加密技术保护网站用户的敏感信息（如密码、信用卡信息等），防止数据在传输过程中被窃取或篡改。</p><p>加密的原理图，当然今天的目标不是</p><p><img src="https://imgoss.xgss.net/picgo/image-20241118200334586.png?aliyun" alt="image-20241118200334586"></p><h1 id="什么是https" tabindex="-1"><a class="header-anchor" href="#什么是https"><span>什么是https</span></a></h1><p><strong>HTTPS</strong>（Hypertext Transfer Protocol Secure）是<strong>超文本传输安全协议</strong>，是HTTP协议的安全版本。它通过使用SSL/TLS协议对数据进行加密，确保了客户端和服务器之间的数据传输的机密性和完整性。</p><p>浏览器与服务器之间的https加密通信会包括以下一些概念：**非对称加密、对称加密、RSA、证书申请、根证书。**https证书加密，就是在传输层tcp和应用层http之间加了一层ssl层来对传输内容进行加密。</p><h1 id="如何获取免费的ssl证书" tabindex="-1"><a class="header-anchor" href="#如何获取免费的ssl证书"><span>如何获取免费的SSL证书</span></a></h1><p>今天主要讲两种方式获取，第一种是在宝塔后台可以申请免费的三个月证书，第二种是acme.sh开源工具来获取</p><h1 id="宝塔获取免费的ssl证书" tabindex="-1"><a class="header-anchor" href="#宝塔获取免费的ssl证书"><span>宝塔获取免费的SSL证书</span></a></h1><h2 id="_1-在宝塔后台" tabindex="-1"><a class="header-anchor" href="#_1-在宝塔后台"><span>1.在宝塔后台</span></a></h2><p>点击“网站”，点击“站点”，点击 &quot;SSL&quot;</p><p><img src="https://imgoss.xgss.net/picgo/image-20241118201046045.png?aliyun" alt="image-20241118201046045"></p><h2 id="_2-再点击申请证书-即可" tabindex="-1"><a class="header-anchor" href="#_2-再点击申请证书-即可"><span>2.再点击申请证书，即可</span></a></h2><p><img src="https://imgoss.xgss.net/picgo/image-20241118201235256.png?aliyun" alt="image-20241118201235256"></p><h2 id="_3-定时需求任务" tabindex="-1"><a class="header-anchor" href="#_3-定时需求任务"><span>3.定时需求任务</span></a></h2><p>定时任务---&gt;添加任务---&gt;续签</p><p><img src="https://imgoss.xgss.net/picgo/image-20241119092612216.png?aliyun" alt="image-20241119092612216"></p><h1 id="通过acme-sh开源工具申请泛解析ssl证书" tabindex="-1"><a class="header-anchor" href="#通过acme-sh开源工具申请泛解析ssl证书"><span>通过acme.sh开源工具申请泛解析SSL证书</span></a></h1><p>acme.sh 是一个开源的、基于Shell脚本的工具，用于自动申请、安装和更新SSL/TLS证书。它通过实现ACME协议来与Let&#39;s Encrypt等证书颁发机构（CA）进行交互，从而实现自动化管理SSL证书。</p><h1 id="前期准备" tabindex="-1"><a class="header-anchor" href="#前期准备"><span>前期准备</span></a></h1><p>1.域名</p><p>2.Linux云服务器（本文系统某讯云的Centos7），测试公网IP为：12.34.56.78</p><p>3.域名服务商的API Token，或者域名解析到申请SSL云服务器IP（实验项目： siyuan.xgss.net）</p><h1 id="安装acme-sh" tabindex="-1"><a class="header-anchor" href="#安装acme-sh"><span>安装acme.sh</span></a></h1><p>普通用户和 root 用户都可以安装使用. 安装过程进行了以下几步:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span># yum install socat -y</span></span>
<span class="line"><span></span></span>
<span class="line"><span># curl https://get.acme.sh | sh</span></span>
<span class="line"><span>或者</span></span>
<span class="line"><span># curl https://get.acme.sh | sh -s email=my@example.com(zerossl.com注册的邮箱账号，在浏览器登录ZeroSSL之后可以看到证书)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>国内的服务器下载github可能会比较慢，如果下载失败，可以多执行几次。</p><p>也可以根据提示使用国内的源。</p><p><img src="https://imgoss.xgss.net/picgo/image-20220627113047199.png?aliyun" alt="image-20220627113047199"></p><p>1、把 acme.sh 安装到你的 home 目录下：~/.acme.sh/ 装过程不会污染已有的系统任何功能和文件, 所有的修改都限制在安装目录中: ~/.acme.sh/</p><p>2、并创建 一个 bash 的 alias, 方便你的使用: alias acme.sh=~/.acme.sh/acme.sh</p><p>3、自动为你创建 cronjob, 每天 0:00 点自动检测所有的证书, 如果快过期了, 需要更新, 则会自动更新证书.</p><p>把 acme.sh 安装到你的 home 目录下:~/.acme.sh/并创建 一个 bash 的 alias, 方便你的使用:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>alias acme.sh=~/.acme.sh/acme.sh</span></span>
<span class="line"><span>echo &#39;alias acme.sh=~/.acme.sh/acme.sh&#39; &gt;&gt;/etc/profile</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="常用命令" tabindex="-1"><a class="header-anchor" href="#常用命令"><span>常用命令</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>acme.sh --help     #获取帮助</span></span>
<span class="line"><span>acme.sh --version  # 查看版本</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="关联-zerossl" tabindex="-1"><a class="header-anchor" href="#关联-zerossl"><span>关联 ZeroSSL</span></a></h2><p>目前 acme.sh 支持四个正式环境 CA，分别是 Let’s Encrypt、Buypass、ZeroSSL 和 SSL.com，默认使用 ZeroSSL，所以我们不用切换。如果不放心，可以设置一下：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>acme.sh --set-default-ca --server zerossl</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="生成证书" tabindex="-1"><a class="header-anchor" href="#生成证书"><span>生成证书</span></a></h2><p>acme.sh 实现了 acme 协议支持的所有验证协议. 一般有两种方式验证: HTTP 和 DNS 验证。</p><p>如果有条件建议使用DNS验证</p><h1 id="http认证" tabindex="-1"><a class="header-anchor" href="#http认证"><span>HTTP认证</span></a></h1><p>此方法<strong>好像不支持域名的泛解析</strong>，笔者想泛解析做泛域名的认证，但一直不成功，不知道什么原因。</p><h2 id="域名解析" tabindex="-1"><a class="header-anchor" href="#域名解析"><span>域名解析</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>siyuan.xgss.net A记录解析到 12.34.56.78</span></span>
<span class="line"><span>只解析上面一条即可，因为只是为 siyuan.xgss.net 申请证书，后面的解析是为了实验能否申请到多*.xgss.net的证书</span></span>
<span class="line"><span>xgss.net A记录解析到 12.34.56.78</span></span>
<span class="line"><span>*.xgss.net A记录解析到 12.34.56.78</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://imgoss.xgss.net/picgo/image-20220627164634187.png?aliyun" alt="image-20220627164634187"></p><p>配置http站点</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span># mkdir -p /data/wwwroot/web/siyuan.xgss.net/</span></span>
<span class="line"><span># echo &#39;hello SSL&#39;&gt; /data/wwwroot/web/siyuan.xgss.net/index.html</span></span>
<span class="line"><span>配置nginx站点</span></span>
<span class="line"><span>server {</span></span>
<span class="line"><span>  listen       80;</span></span>
<span class="line"><span>  access_log /dev/null;</span></span>
<span class="line"><span>  error_log /dev/null;</span></span>
<span class="line"><span>  server_name  siyuan.xgss.net xgss.net;</span></span>
<span class="line"><span>  root /data/wwwroot/web/siyuan.xgss.net/;</span></span>
<span class="line"><span>  location / {</span></span>
<span class="line"><span>                index  index.html index.htm index.php;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>验证是否配置正常</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span># curl http://siyuan.xgss.net/</span></span>
<span class="line"><span>hello SSL</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>http 方式需要在你的网站根目录下放置一个文件, 来验证你的域名所有权,完成验证. 然后就可以生成证书了.</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>acme.sh  --issue  -d mydomain.com -d www.mydomain.com  --webroot  /home/wwwroot/mydomain.com/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>只需要指定域名, 并指定域名所在的网站根目录. acme.sh 会全自动的生成验证文件, 并放到网站的根目录, 然后自动完成验证. 最后会聪明的删除验证文件. 整个过程没有任何副作用.</p><p>如果你用的 nginx服务器, 或者反代, acme.sh 还可以智能的从 nginx的配置中自动完成验证, 你不需要指定网站根目录:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>acme.sh --issue  -d mydomain.com   --nginx</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>注意, 无论是 apache 还是 nginx 模式, acme.sh在完成验证之后, 会恢复到之前的状态, 都不会私自更改你本身的配置. 好处是你不用担心配置被搞坏, 也有一个缺点, 你需要自己配置 ssl 的配置, 否则只能成功生成证书, 你的网站还是无法访问https. 但是为了安全, 你还是自己手动改配置吧.</strong></p><p>如果你还没有运行任何 web 服务, <strong>80</strong> 端口是空闲的, 那么 <strong>acme.sh</strong> 还能假装自己是一个webserver, 临时听在<strong>80</strong> 端口, 完成验证:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>acme.sh  --issue -d mydomain.com   --standalone</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>https://app.zerossl.com/signup 使用邮箱注册一个账号，假设账号的邮箱为：&quot;XXXX@163.com&quot;</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span># /root/.acme.sh/acme.sh --register-account -m XXXX@163.com</span></span>
<span class="line"><span>[Mon Jun 27 13:37:27 CST 2022] No EAB credentials found for ZeroSSL, let&#39;s get one</span></span>
<span class="line"><span>[Mon Jun 27 13:37:30 CST 2022] Registering account: https://acme.zerossl.com/v2/DV90</span></span>
<span class="line"><span>[Mon Jun 27 13:37:38 CST 2022] Registered</span></span>
<span class="line"><span>[Mon Jun 27 13:37:38 CST 2022] ACCOUNT_THUMBPRINT=&#39;*********************&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="申请证书" tabindex="-1"><a class="header-anchor" href="#申请证书"><span>申请证书</span></a></h2><p>将证书放到一个指定的目录，scrm用nginx配置，本例是指定在/data/wwwroot/web/ssl目录下</p><h3 id="_1-创建ssl存放目录" tabindex="-1"><a class="header-anchor" href="#_1-创建ssl存放目录"><span>1.创建ssl存放目录</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>mkdir -p /data/wwwroot/web/ssl</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-申请ssl证书" tabindex="-1"><a class="header-anchor" href="#_2-申请ssl证书"><span>2.申请SSL证书</span></a></h3><p>申请单域名证书，并且指定证书存放的目录</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span># /root/.acme.sh/acme.sh  --issue -d siyuan.xgss.net  --webroot  /data/wwwroot/web/siyuan.xgss.net/ \\</span></span>
<span class="line"><span>--keypath       /data/wwwroot/web/ssl/siyuan.xgss.net.key  \\</span></span>
<span class="line"><span>--fullchainpath /data/wwwroot/web/ssl/siyuan.xgss.net.key.pem \\</span></span>
<span class="line"><span>--reloadcmd &quot;/usr/local/openresty/nginx/sbin/nginx -s reload&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>--reloadcmd 表示复制完成后重启服务器的命令，根据自己服务器状况填写。</p><p>/data/wwwroot/web/ssl/ 需要自己建立好，如果文件夹不存在，会报错。</p><h3 id="_3-生成dhparam文件" tabindex="-1"><a class="header-anchor" href="#_3-生成dhparam文件"><span>3.生成dhparam文件</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>openssl dhparam -out /data/wwwroot/web/ssl/dhparam.pem     2048</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_4-配置siyuan-xgss-net的nginx配置。" tabindex="-1"><a class="header-anchor" href="#_4-配置siyuan-xgss-net的nginx配置。"><span>4.配置siyuan.xgss.net的nginx配置。</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>  server {</span></span>
<span class="line"><span>        listen 443 ssl;</span></span>
<span class="line"><span>		access_log /dev/null;</span></span>
<span class="line"><span>	    error_log /dev/null;</span></span>
<span class="line"><span>		server_name  siyuan.xgss.net;</span></span>
<span class="line"><span>		root /data/wwwroot/web/siyuan.xgss.net/ ;</span></span>
<span class="line"><span>		</span></span>
<span class="line"><span>	    ssl_certificate     /data/wwwroot/web/ssl/siyuan.xgss.net.key.pem;</span></span>
<span class="line"><span>        ssl_certificate_key /data/wwwroot/web/ssl/siyuan.xgss.net.key;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span></span>
<span class="line"><span>        ssl_prefer_server_ciphers on;</span></span>
<span class="line"><span>        ssl_dhparam /data/wwwroot/web/ssl/dhparam.pem;</span></span>
<span class="line"><span>		</span></span>
<span class="line"><span>		location / {</span></span>
<span class="line"><span>			index  index.html index.htm index.php;</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>     }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>浏览器访问： https://siyuan.xgss.net</p><p>证书信息</p><p><img src="https://imgoss.xgss.net/picgo/image-20220627161910298.png?aliyun" alt="image-20220627161910298"></p><h2 id="zerossl官网证书截图" tabindex="-1"><a class="header-anchor" href="#zerossl官网证书截图"><span>ZeroSSL官网证书截图</span></a></h2><p><img src="https://imgoss.xgss.net/picgo/image-20220627172051184.png?aliyun" alt="image-20220627172051184"></p><h1 id="dns认证" tabindex="-1"><a class="header-anchor" href="#dns认证"><span>DNS认证</span></a></h1><h2 id="手动dns方式" tabindex="-1"><a class="header-anchor" href="#手动dns方式"><span>手动DNS方式</span></a></h2><p>手动在域名上添加一条 txt 解析记录, 验证域名所有权。</p><p>这种方式的好处是, 你不需要任何服务器, 不需要任何公网 ip, 只需要 dns 的解析记录即可完成验证. 坏处是，如果不同时配置 Automatic DNS API，使用这种方式 acme.sh 将无法自动更新证书，每次都需要手动再次重新解析验证域名所有权。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>acme.sh  --issue  --dns   -d mydomain.com \\</span></span>
<span class="line"><span> --yes-I-know-dns-manual-mode-enough-go-ahead-please</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>然后, acme.sh 会生成相应的解析记录显示出来, 你只需要在你的域名管理面板中添加这条 txt 记录即可.</p><p>等待解析完成之后, 重新生成证书:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>acme.sh  --renew   -d mydomain.com \\</span></span>
<span class="line"><span>  --yes-I-know-dns-manual-mode-enough-go-ahead-please</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>注意第二次这里用的是 <strong>--renew</strong></p><h2 id="自动dns方式" tabindex="-1"><a class="header-anchor" href="#自动dns方式"><span>自动DNS方式</span></a></h2><p>dns 方式的真正强大之处在于可以使用域名解析商提供的 api 自动添加 txt 记录完成验证.</p><p>由于<code>acme.sh</code>对域名解析/提供商的支持十分广泛,所以请针对自己所在的域名提供商获取对应的API Token，目前支持 cloudflare, dnspod, cloudxns, godaddy 以及 ovh 等数十种解析商的自动集成.</p><p>支持列表:<a href="https://github.com/acmesh-official/acme.sh/wiki/dnsapi" target="_blank" rel="noopener noreferrer">点我跳转</a> | https://github.com/acmesh-official/acme.sh/wiki/dnsapi</p><p>国内目前使用较多的是某讯云和某里云，获取API Token的方法分别是：</p><ul><li><p>某讯云的<code>DNSPod</code></p><p>登录DNSPod,进入顶部导航栏里的用户中心,在左侧的导航栏里,找到<code>安全设置</code>,看到页面的最下面,有个<code>API Token</code>.点击<code>查看</code>-&gt;<code>创建API Token</code>-&gt;填写<code>Tokens名称</code>,复制好ID与Token即可.保存待用。</p></li><li><p>某里云域名</p><p>需要登录到某里云官网获取Ali_Key和Ali_Secret。<a href="https://usercenter.console.aliyun.com/#/manage/ak" target="_blank" rel="noopener noreferrer">点击此处跳转</a> | https://usercenter.console.aliyun.com/#/manage/ak</p><p>当然可以直接使用accessKey</p></li></ul><p><img src="https://imgoss.xgss.net/picgo/image-20220627170505702.png?aliyun" alt="image-20220627170505702"></p><h2 id="某里云api-token申请" tabindex="-1"><a class="header-anchor" href="#某里云api-token申请"><span>某里云API Token申请</span></a></h2><p>申请子账户来申请。</p><p><img src="https://imgoss.xgss.net/picgo/image-20220627170734108.png?aliyun" alt="image-20220627170734108"></p><p><img src="https://imgoss.xgss.net/picgo/image-20220627170621178.png?aliyun" alt="image-20220627170621178"></p><p>详细就不列举了，有疑问可以后台提交工单。</p><h2 id="申请泛解析域名证书" tabindex="-1"><a class="header-anchor" href="#申请泛解析域名证书"><span>申请泛解析域名证书</span></a></h2><p>获取到对应的API Token之后我们需要将id和key设置为环境变量，供acme.sh调用：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span># DNSPod</span></span>
<span class="line"><span>export DP_Id=&quot;你的 API ID&quot;</span></span>
<span class="line"><span>export DP_Key=&quot;你的 Token&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span># aliyun</span></span>
<span class="line"><span>export Ali_Key=&quot;你的 AccessKey ID&quot;</span></span>
<span class="line"><span>export Ali_Secret=&quot;你的 AccessKey Secret&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>临时环境变量只需配置这一次即可，当成功申请证书后，API 信息会被自动保存在~/.acme.sh/account.conf里，下次你使用acme.sh的时候系统会自动读取并使用。</p><p>腾讯云DNSpod：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>acme.sh --issue -d example.com -d *.example.com --dns dns_dp</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>阿里云：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>acme.sh --issue  -d example.com -d *.example.com --dns dns_ali</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>acme.sh --issue  -d xgss.net -d *.xgss.net --dns dns_ali \\</span></span>
<span class="line"><span>--keypath       /data/wwwroot/web/ssl/all.xgss.net.key  \\</span></span>
<span class="line"><span>--fullchainpath /data/wwwroot/web/ssl/all.xgss.net.key.pem \\</span></span>
<span class="line"><span>--reloadcmd &quot;/usr/local/openresty/nginx/sbin/nginx -s reload&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>openssl dhparam -out /data/wwwroot/web/ssl/dhparam.pem     2048      </span></span>
<span class="line"><span></span></span>
<span class="line"><span># ll /data/wwwroot/web/ssl</span></span>
<span class="line"><span>total 16</span></span>
<span class="line"><span>-rw------- 1 root root 1679 Jun 27 19:02 all.xgss.net.key</span></span>
<span class="line"><span>-rw-r--r-- 1 root root 6684 Jun 27 19:02 all.xgss.net.key.pem</span></span>
<span class="line"><span>-rw-r--r-- 1 root root  424 Jun 27 19:03 dhparam.pem</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://imgoss.xgss.net/picgo/image-20220627190216829.png?aliyun" alt="image-20220627190216829"></p><p>(一个小提醒, 这里用的是 service nginx force-reload, 不是 service nginx reload, 据测试, reload 并不会重新加载证书, 所以用的 force-reload)</p><p><strong>你的KEY和Secret都将明文保存‘~/.acme.sh/account.conf’文件中，注意保护隐私。</strong></p><p><img src="https://imgoss.xgss.net/picgo/image-20220628095240206.png?aliyun" alt="image-20220628095240206"></p><p>域名后台新增了两条记录</p><p><img src="https://imgoss.xgss.net/picgo/image-20220627190154936.png?aliyun" alt="image-20220627190154936"></p><h2 id="验证ssl" tabindex="-1"><a class="header-anchor" href="#验证ssl"><span>验证SSL</span></a></h2><p>浏览器打开网址，点击地址的小锁图标，可以查看更多信息。</p><p><img src="https://imgoss.xgss.net/picgo/image-20220627190701821.png?aliyun" alt="image-20220627190701821"></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span># curl https://ssl2.xgss.net/</span></span>
<span class="line"><span>hello SSL</span></span>
<span class="line"><span>[root@shanghai-node02 ssl]# curl https://ssl3.xgss.net/</span></span>
<span class="line"><span>hello SSL</span></span>
<span class="line"><span>[root@shanghai-node02 ssl]# curl https://ssl4.xgss.net/</span></span>
<span class="line"><span>hello SSL</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="定时更新证书" tabindex="-1"><a class="header-anchor" href="#定时更新证书"><span>定时更新证书</span></a></h1><p>安装过程中会自动为你创建 cronjob, 每天 0:00 点自动检测所有的证书, 如果快过期了, 需要更新, 则会自动更新证书。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>00 00 * * * root /root/.acme.sh/acme.sh --cron --home /root/.acme.sh &amp;&gt;/var/log/acme.sh.logs</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h1 id="查看已安装证书的信息" tabindex="-1"><a class="header-anchor" href="#查看已安装证书的信息"><span>查看已安装证书的信息</span></a></h1><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>acme.sh --info -d xgss.net</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h1 id="更新证书" tabindex="-1"><a class="header-anchor" href="#更新证书"><span>更新证书</span></a></h1><p>目前证书在 60 天以后会自动更新, 你无需任何操作. 今后有可能会缩短这个时间, 不过都是自动的, 你不用关心.</p><p>请确保 cronjob 正确安装, 看起来是类似这样的:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>crontab  -l</span></span>
<span class="line"><span></span></span>
<span class="line"><span>56 * * * * &quot;/root/.acme.sh&quot;/acme.sh --cron --home &quot;/root/.acme.sh&quot; &gt; /dev/null</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="更新acme-sh" tabindex="-1"><a class="header-anchor" href="#更新acme-sh"><span>更新acme.sh</span></a></h1><p>目前由于 acme 协议和 letsencrypt CA 都在频繁的更新, 因此 acme.sh 也经常更新以保持同步.</p><p>升级 acme.sh 到最新版</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>acme.sh --upgrade</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果你不想手动升级, 可以开启自动升级:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>acme.sh  --upgrade  --auto-upgrade</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>之后, acme.sh 就会自动保持更新了.</p><p>你也可以随时关闭自动更新:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>acme.sh --upgrade  --auto-upgrade  0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h1 id="结尾" tabindex="-1"><a class="header-anchor" href="#结尾"><span>结尾</span></a></h1><p>SSL证书是保障网站安全的重要工具，它不仅可以保护网站和用户的数据，还可以提升网站的信任度和搜索引擎排名。如果你还没有为你的网站配置SSL证书，建议尽快办理。</p>`,145)]))}const c=a(l,[["render",p]]),h=JSON.parse('{"path":"/article/1p9k5i1n/","title":"给你的网站加一道安全锁，免费获取ssl证书","lang":"en-US","frontmatter":{"title":"给你的网站加一道安全锁，免费获取ssl证书","createTime":"2025/05/27 17:51:17","permalink":"/article/1p9k5i1n/"},"git":{"createdTime":1749111496000,"updatedTime":1750129445000,"contributors":[{"name":"star","username":"star","email":"star@xgss.net","commits":2,"url":"https://github.com/star"}]},"readingTime":{"minutes":10.22,"words":3067},"filePathRelative":"cloud/tengxunyun/给你的网站加一道安全锁，免费获取ssl证书.md"}');export{c as comp,h as data};
