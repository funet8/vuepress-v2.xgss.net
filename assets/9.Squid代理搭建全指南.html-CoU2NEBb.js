import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as e,o as n}from"./app-BiQR_lPj.js";const l={};function t(h,s){return n(),a("div",null,s[0]||(s[0]=[e(`<h1 id="squid代理搭建全指南" tabindex="-1"><a class="header-anchor" href="#squid代理搭建全指南"><span>Squid代理搭建全指南</span></a></h1><h2 id="_1️⃣-前言" tabindex="-1"><a class="header-anchor" href="#_1️⃣-前言"><span>1️⃣ 前言</span></a></h2><p>在网络运维与安全领域，<strong>代理服务器</strong>是流量调度、访问控制和缓存加速的重要工具。 <strong>Squid</strong> 作为开源、高性能的 HTTP/HTTPS/FTP 缓存代理，广泛应用于企业内网、教育网络、爬虫集群等场景。 本文将从 <strong>原理 → 安装 → 配置 → 优化 → 安全加固</strong> 全流程讲解，帮助你快速搭建可用、稳定且安全的 Squid 代理服务。</p><hr><h2 id="_2️⃣-squid-工作原理概述" tabindex="-1"><a class="header-anchor" href="#_2️⃣-squid-工作原理概述"><span>2️⃣ Squid 工作原理概述</span></a></h2><ul><li><strong>代理转发</strong>：客户端请求 → Squid → 目标服务器 → Squid → 客户端</li><li><strong>缓存机制</strong>：对静态资源（HTML、CSS、JS、图片等）进行本地缓存，减少重复请求</li><li><strong>访问控制</strong>：通过 ACL（Access Control List）限制访问来源、目标域名、时间段等</li><li><strong>协议支持</strong>：HTTP、HTTPS（需 CONNECT 隧道）、FTP 等</li></ul><p><strong>架构示意</strong>：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>[Client] ⇄ [Squid Proxy] ⇄ [Internet]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h2 id="_3️⃣-环境准备" tabindex="-1"><a class="header-anchor" href="#_3️⃣-环境准备"><span>3️⃣ 环境准备</span></a></h2><table><thead><tr><th>项目</th><th>推荐配置</th></tr></thead><tbody><tr><td>系统</td><td>Ubuntu 20.04 / CentOS 7+</td></tr><tr><td>内存</td><td>≥ 1GB（缓存多建议 4GB+）</td></tr><tr><td>磁盘</td><td>≥ 10GB（缓存目录需额外空间）</td></tr><tr><td>网络</td><td>公网 IP（或内网测试环境）</td></tr></tbody></table><hr><h2 id="_4️⃣-安装-squid" tabindex="-1"><a class="header-anchor" href="#_4️⃣-安装-squid"><span>4️⃣ 安装 Squid</span></a></h2><h3 id="ubuntu-debian" tabindex="-1"><a class="header-anchor" href="#ubuntu-debian"><span>Ubuntu/Debian</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> update</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> squid</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="centos-rhel" tabindex="-1"><a class="header-anchor" href="#centos-rhel"><span>CentOS/RHEL</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> squid</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>安装完成后，主配置文件路径：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>/etc/squid/squid.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h2 id="_5️⃣-基础配置" tabindex="-1"><a class="header-anchor" href="#_5️⃣-基础配置"><span>5️⃣ 基础配置</span></a></h2><h3 id="_5-1-修改监听端口" tabindex="-1"><a class="header-anchor" href="#_5-1-修改监听端口"><span>5.1 修改监听端口</span></a></h3><p>默认端口为 <strong>3128</strong>，可在 <code>squid.conf</code> 中修改：</p><div class="language-conf line-numbers-mode" data-highlighter="shiki" data-ext="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-conf"><span class="line"><span>http_port 3128</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_5-2-设置访问控制-acl" tabindex="-1"><a class="header-anchor" href="#_5-2-设置访问控制-acl"><span>5.2 设置访问控制（ACL）</span></a></h3><p>示例：仅允许特定 IP 段访问</p><div class="language-conf line-numbers-mode" data-highlighter="shiki" data-ext="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-conf"><span class="line"><span>acl allowed_ips src 192.168.1.0/24</span></span>
<span class="line"><span>http_access allow allowed_ips</span></span>
<span class="line"><span>http_access deny all</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-启用缓存目录" tabindex="-1"><a class="header-anchor" href="#_5-3-启用缓存目录"><span>5.3 启用缓存目录</span></a></h3><div class="language-conf line-numbers-mode" data-highlighter="shiki" data-ext="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-conf"><span class="line"><span>cache_dir ufs /var/spool/squid 100 16 256</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><code>100</code>：缓存大小（MB）</li><li><code>16</code>、<code>256</code>：目录层级</li></ul><h3 id="_5-4-启动与开机自启" tabindex="-1"><a class="header-anchor" href="#_5-4-启动与开机自启"><span>5.4 启动与开机自启</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> enable</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> squid</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> start</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> squid</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="_6️⃣-https-代理支持-隧道模式" tabindex="-1"><a class="header-anchor" href="#_6️⃣-https-代理支持-隧道模式"><span>6️⃣ HTTPS 代理支持（隧道模式）</span></a></h2><p>Squid 默认支持 HTTP，若需 HTTPS：</p><div class="language-conf line-numbers-mode" data-highlighter="shiki" data-ext="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-conf"><span class="line"><span>acl SSL_ports port 443</span></span>
<span class="line"><span>acl CONNECT method CONNECT</span></span>
<span class="line"><span>http_access allow CONNECT SSL_ports</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>客户端需配置为 <strong>HTTP 代理</strong>，访问 HTTPS 时会自动使用 CONNECT 隧道。</p><hr><h2 id="_7️⃣-性能优化建议" tabindex="-1"><a class="header-anchor" href="#_7️⃣-性能优化建议"><span>7️⃣ 性能优化建议</span></a></h2><ul><li><strong>增加缓存内存</strong>：</li></ul><div class="language-conf line-numbers-mode" data-highlighter="shiki" data-ext="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-conf"><span class="line"><span>cache_mem 256 MB</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><strong>调整文件描述符</strong>：</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">ulimit</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 65535</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><strong>开启多进程/多线程</strong>（高并发场景）：</li></ul><div class="language-conf line-numbers-mode" data-highlighter="shiki" data-ext="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-conf"><span class="line"><span>workers 4</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><strong>合理设置缓存策略</strong>：</li></ul><div class="language-conf line-numbers-mode" data-highlighter="shiki" data-ext="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-conf"><span class="line"><span>refresh_pattern ^ftp:           1440    20%     10080</span></span>
<span class="line"><span>refresh_pattern ^gopher:        1440    0%      1440</span></span>
<span class="line"><span>refresh_pattern -i (/cgi-bin/|\\?) 0     0%      0</span></span>
<span class="line"><span>refresh_pattern .               0       20%     4320</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="_8️⃣-安全加固" tabindex="-1"><a class="header-anchor" href="#_8️⃣-安全加固"><span>8️⃣ 安全加固</span></a></h2><ul><li><strong>限制来源 IP</strong>（避免被滥用）</li><li><strong>启用认证</strong>：</li></ul><div class="language-conf line-numbers-mode" data-highlighter="shiki" data-ext="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-conf"><span class="line"><span>auth_param basic program /usr/lib/squid/basic_ncsa_auth /etc/squid/passwd</span></span>
<span class="line"><span>auth_param basic realm Squid Proxy</span></span>
<span class="line"><span>acl authenticated proxy_auth REQUIRED</span></span>
<span class="line"><span>http_access allow authenticated</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>生成用户密码：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> apache2-utils</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">htpasswd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -c</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/squid/passwd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> user1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>定期更新系统与 Squid</strong></li><li><strong>监控日志</strong>：</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tail</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /var/log/squid/access.log</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h2 id="_9️⃣-常见问题排查" tabindex="-1"><a class="header-anchor" href="#_9️⃣-常见问题排查"><span>9️⃣ 常见问题排查</span></a></h2><table><thead><tr><th>问题</th><th>可能原因</th><th>解决方案</th></tr></thead><tbody><tr><td>代理无法访问外网</td><td>防火墙阻挡</td><td>开放 3128 端口</td></tr><tr><td>HTTPS 报错</td><td>CONNECT 未配置</td><td>检查 ACL</td></tr><tr><td>缓存无效</td><td>refresh_pattern 不匹配</td><td>调整规则</td></tr></tbody></table><hr><h2 id="🔟-总结" tabindex="-1"><a class="header-anchor" href="#🔟-总结"><span>🔟 总结</span></a></h2><p>Squid 作为成熟的代理解决方案，具备 <strong>高性能、可扩展、可控性强</strong> 的优势。 通过合理配置 ACL、缓存策略与安全加固措施，可以在企业、教育、爬虫等多种场景中稳定运行。</p>`,61)]))}const p=i(l,[["render",t]]),c=JSON.parse('{"path":"/%E6%99%BA%E7%BB%B4%E6%94%BB%E5%9F%8E%E7%8B%AE/S15/9.Squid%E4%BB%A3%E7%90%86%E6%90%AD%E5%BB%BA%E5%85%A8%E6%8C%87%E5%8D%97.html","title":"Squid代理搭建全指南","lang":"en-US","frontmatter":{},"git":{"createdTime":1756914694000,"updatedTime":1756914694000,"contributors":[{"name":"star","username":"star","email":"star@xgss.net","commits":1,"url":"https://github.com/star"}]},"readingTime":{"minutes":2.42,"words":726},"filePathRelative":"智维攻城狮/S15/9.Squid代理搭建全指南.md"}');export{p as comp,c as data};
