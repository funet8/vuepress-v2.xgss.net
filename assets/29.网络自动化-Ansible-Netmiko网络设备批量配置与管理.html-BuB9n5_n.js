import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as n,o as l}from"./app-BiQR_lPj.js";const t={};function h(e,s){return l(),a("div",null,s[0]||(s[0]=[n(`<h1 id="网络自动化-ansible-netmiko-网络设备批量配置与管理" tabindex="-1"><a class="header-anchor" href="#网络自动化-ansible-netmiko-网络设备批量配置与管理"><span>网络自动化：Ansible/Netmiko 网络设备批量配置与管理</span></a></h1><h2 id="一、引言" tabindex="-1"><a class="header-anchor" href="#一、引言"><span>一、引言</span></a></h2><p>在传统网络运维中，工程师需要逐台登录交换机、路由器进行配置与排错。这种方式不仅效率低下，还容易因手工操作导致配置不一致。随着网络规模的扩大，<strong>网络自动化</strong>成为必然趋势。 本文将聚焦两种常见工具：<strong>Ansible</strong> 与 <strong>Netmiko</strong>，探讨如何实现网络设备的批量配置与管理。</p><hr><h2 id="二、核心工具简介" tabindex="-1"><a class="header-anchor" href="#二、核心工具简介"><span>二、核心工具简介</span></a></h2><h3 id="_1-ansible" tabindex="-1"><a class="header-anchor" href="#_1-ansible"><span>1. Ansible</span></a></h3><ul><li><p><strong>定位</strong>：无代理（Agentless）的自动化运维工具</p></li><li><p>优势</p><p>：</p><ul><li>使用 YAML 编写 Playbook，易读易维护</li><li>支持大规模设备并行操作</li><li>丰富的模块库（包括网络设备模块）</li></ul></li></ul><h3 id="_2-netmiko" tabindex="-1"><a class="header-anchor" href="#_2-netmiko"><span>2. Netmiko</span></a></h3><ul><li><p><strong>定位</strong>：基于 Python 的网络设备 SSH 自动化库</p></li><li><p>优势</p><p>：</p><ul><li>封装 Paramiko，简化 SSH 交互</li><li>支持 Cisco、Huawei、Juniper 等主流厂商设备</li><li>适合快速脚本化与定制化场景</li></ul></li></ul><hr><h2 id="三、应用场景对比" tabindex="-1"><a class="header-anchor" href="#三、应用场景对比"><span>三、应用场景对比</span></a></h2><table><thead><tr><th>场景</th><th>Ansible 适用</th><th>Netmiko 适用</th></tr></thead><tbody><tr><td>大规模批量配置</td><td>✅</td><td>⚠️（需自行写循环）</td></tr><tr><td>配置一致性检查</td><td>✅</td><td>⚠️</td></tr><tr><td>临时性脚本/调试</td><td>⚠️</td><td>✅</td></tr><tr><td>与CI/CD集成</td><td>✅</td><td>⚠️</td></tr><tr><td>学习成本</td><td>中等（YAML/Playbook）</td><td>低（Python脚本）</td></tr></tbody></table><hr><h2 id="四、实战案例" tabindex="-1"><a class="header-anchor" href="#四、实战案例"><span>四、实战案例</span></a></h2><h3 id="_1-使用-ansible-批量下发配置" tabindex="-1"><a class="header-anchor" href="#_1-使用-ansible-批量下发配置"><span>1. 使用 Ansible 批量下发配置</span></a></h3><p><strong>目录结构示例：</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>inventory/</span></span>
<span class="line"><span>  hosts.ini</span></span>
<span class="line"><span>playbooks/</span></span>
<span class="line"><span>  config.yml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>hosts.ini：</strong></p><div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-ini"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">[routers]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">R1 </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">ansible_host</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">192.168.1.1 </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">ansible_user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">admin </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">ansible_password</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">123456</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">R2 </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">ansible_host</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">192.168.1.2 </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">ansible_user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">admin </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">ansible_password</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">123456</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>config.yml：</strong></p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">- </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">批量配置路由器</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  hosts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">routers</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  gather_facts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">no</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  tasks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">下发接口描述</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      ios_config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        lines</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">          - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">description Configured by Ansible</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        parents</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">interface GigabitEthernet0/0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行命令：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ansible-playbook</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> inventory/hosts.ini</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> playbooks/config.yml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h3 id="_2-使用-netmiko-脚本化配置" tabindex="-1"><a class="header-anchor" href="#_2-使用-netmiko-脚本化配置"><span>2. 使用 Netmiko 脚本化配置</span></a></h3><p><strong>Python 示例：</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> netmiko </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ConnectHandler</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">devices </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    {</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;device_type&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;cisco_ios&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ip&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;192.168.1.1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;username&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;admin&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;password&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;123456&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">},</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    {</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;device_type&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;cisco_ios&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ip&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;192.168.1.2&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;username&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;admin&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;password&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;123456&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">},</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">commands </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;interface GigabitEthernet0/0&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;description Configured by Netmiko&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> device </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">in</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> devices:</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    with</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> ConnectHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(**device) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> conn:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        output </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> conn.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">send_config_set</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(commands)</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">{</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">device[</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;ip&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 配置结果:</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">{</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">output</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="五、最佳实践与优化建议" tabindex="-1"><a class="header-anchor" href="#五、最佳实践与优化建议"><span>五、最佳实践与优化建议</span></a></h2><ul><li><strong>配置分层</strong>：将公共配置与差异化配置分离，避免重复。</li><li><strong>版本控制</strong>：结合 Git 管理 Playbook 与脚本，确保可追溯性。</li><li><strong>安全性</strong>：避免明文密码，推荐使用 Ansible Vault 或环境变量。</li><li><strong>测试环境</strong>：先在实验室设备验证，再推送到生产网络。</li><li><strong>混合使用</strong>：大规模场景用 Ansible，临时调试用 Netmiko，优势互补。</li></ul><hr><h2 id="六、结语" tabindex="-1"><a class="header-anchor" href="#六、结语"><span>六、结语</span></a></h2><p>网络自动化并非“一刀切”，而是根据场景选择合适的工具。</p><ul><li><strong>Ansible</strong>：适合标准化、批量化、可扩展的网络管理。</li><li><strong>Netmiko</strong>：适合灵活、快速、定制化的脚本操作。</li></ul><p>通过合理结合两者，网络工程师可以大幅提升效率，减少人为错误，实现真正的“自动化运维”。</p>`,35)]))}const r=i(t,[["render",h]]),d=JSON.parse('{"path":"/%E6%99%BA%E7%BB%B4%E6%94%BB%E5%9F%8E%E7%8B%AE/S15/29.%E7%BD%91%E7%BB%9C%E8%87%AA%E5%8A%A8%E5%8C%96-Ansible-Netmiko%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E6%89%B9%E9%87%8F%E9%85%8D%E7%BD%AE%E4%B8%8E%E7%AE%A1%E7%90%86.html","title":"网络自动化：Ansible/Netmiko 网络设备批量配置与管理","lang":"en-US","frontmatter":{},"git":{"createdTime":1761637265000,"updatedTime":1761637500000,"contributors":[{"name":"star","username":"star","email":"star@xgss.net","commits":2,"url":"https://github.com/star"}]},"readingTime":{"minutes":2.17,"words":651},"filePathRelative":"智维攻城狮/S15/29.网络自动化-Ansible-Netmiko网络设备批量配置与管理.md"}');export{r as comp,d as data};
