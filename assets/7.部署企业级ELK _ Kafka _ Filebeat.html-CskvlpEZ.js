import{_ as a}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as i,a as e,o as n}from"./app-BiQR_lPj.js";const l={};function t(r,s){return n(),i("div",null,s[0]||(s[0]=[e(`<h1 id="如何部署企业级elk-kafka-filebeat" tabindex="-1"><a class="header-anchor" href="#如何部署企业级elk-kafka-filebeat"><span>如何部署企业级ELK + Kafka + Filebeat</span></a></h1><h2 id="背景与架构设计" tabindex="-1"><a class="header-anchor" href="#背景与架构设计"><span>. 背景与架构设计</span></a></h2><p>在企业级日志平台中，<strong>ELK（Elasticsearch + Logstash + Kibana）</strong> 是核心分析与可视化组件，而 <strong>Kafka</strong> 作为高吞吐消息队列，能有效解耦日志采集与处理，<strong>Filebeat</strong> 则是轻量级日志采集器。 典型架构如下：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>[业务服务器] </span></span>
<span class="line"><span>    ↓ Filebeat</span></span>
<span class="line"><span>[Kafka 集群] </span></span>
<span class="line"><span>    ↓ Logstash</span></span>
<span class="line"><span>[Elasticsearch 集群] </span></span>
<span class="line"><span>    ↓ Kibana</span></span>
<span class="line"><span>[可视化与告警]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://imgoss.xgss.net/picgo-tx2025/image-20250831230714174.png?tx" alt="image-20250831230714174"></p><p><strong>优势：</strong></p><ul><li><strong>高可用</strong>：Kafka 缓冲防止 ES 短暂不可用导致数据丢失</li><li><strong>可扩展</strong>：任意扩展采集端、处理端、存储端</li><li><strong>实时性</strong>：秒级日志采集与查询</li><li><strong>解耦</strong>：采集、传输、处理、存储各自独立</li></ul><h2 id="_2-环境规划" tabindex="-1"><a class="header-anchor" href="#_2-环境规划"><span>2. 环境规划</span></a></h2><table><thead><tr><th>角色</th><th>节点数量</th><th>示例 IP</th><th>主要组件</th></tr></thead><tbody><tr><td>ES Master + Kibana</td><td>1</td><td>192.168.1.130</td><td>Elasticsearch、Kibana</td></tr><tr><td>ES Data Node</td><td>2</td><td>192.168.1.131-132</td><td>Elasticsearch</td></tr><tr><td>Kafka Broker</td><td>3</td><td>192.168.1.140-142</td><td>Kafka、Zookeeper</td></tr><tr><td>Logstash</td><td>2</td><td>192.168.1.150-151</td><td>Logstash</td></tr><tr><td>Filebeat</td><td>N</td><td>各业务服务器</td><td>Filebeat</td></tr></tbody></table><p><strong>版本建议：</strong></p><ul><li>Elasticsearch / Logstash / Kibana：7.17.x（稳定且长期支持）</li><li>Kafka：2.8.x 或 3.x（与 Filebeat Kafka Output 兼容）</li><li>Filebeat：与 ELK 版本保持一致</li></ul><h2 id="_3-部署步骤" tabindex="-1"><a class="header-anchor" href="#_3-部署步骤"><span>3. 部署步骤</span></a></h2><h3 id="_3-1-部署-kafka-集群" tabindex="-1"><a class="header-anchor" href="#_3-1-部署-kafka-集群"><span>3.1 部署 Kafka 集群</span></a></h3><ol><li><p><strong>安装 Zookeeper（可用 Kafka 自带）</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>tar -xf kafka_2.13-2.8.0.tgz -C /opt/</span></span>
<span class="line"><span>vim config/zookeeper.properties</span></span>
<span class="line"><span>dataDir=/data/zookeeper</span></span>
<span class="line"><span>clientPort=2181</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动：</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>bin/zookeeper-server-start.sh -daemon config/zookeeper.properties</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>安装 Kafka Broker</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>vim config/server.properties</span></span>
<span class="line"><span>broker.id=1</span></span>
<span class="line"><span>listeners=PLAINTEXT://192.168.1.140:9092</span></span>
<span class="line"><span>log.dirs=/data/kafka-logs</span></span>
<span class="line"><span>zookeeper.connect=192.168.1.140:2181,192.168.1.141:2181,192.168.1.142:2181</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>bin/kafka-server-start.sh -daemon config/server.properties</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>创建日志 Topic</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>bin/kafka-topics.sh --create --zookeeper 192.168.1.140:2181 \\</span></span>
<span class="line"><span>    --replication-factor 2 --partitions 3 --topic logs</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="_3-2-部署-elasticsearch-集群" tabindex="-1"><a class="header-anchor" href="#_3-2-部署-elasticsearch-集群"><span>3.2 部署 Elasticsearch 集群</span></a></h3><ol><li><p><strong>系统优化</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>echo &quot;vm.max_map_count=262144&quot; &gt;&gt; /etc/sysctl.conf</span></span>
<span class="line"><span>sysctl -p</span></span>
<span class="line"><span>ulimit -n 65535</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>配置 elasticsearch.yml</strong></p><p>yaml</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>cluster.name: es-cluster</span></span>
<span class="line"><span>node.name: es-node-1</span></span>
<span class="line"><span>path.data: /data/elasticsearch</span></span>
<span class="line"><span>path.logs: /var/log/elasticsearch</span></span>
<span class="line"><span>network.host: 192.168.1.130</span></span>
<span class="line"><span>discovery.seed_hosts: [&quot;192.168.1.130&quot;,&quot;192.168.1.131&quot;,&quot;192.168.1.132&quot;]</span></span>
<span class="line"><span>cluster.initial_master_nodes: [&quot;es-node-1&quot;,&quot;es-node-2&quot;,&quot;es-node-3&quot;]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>启动并验证</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>./bin/elasticsearch -d</span></span>
<span class="line"><span>curl http://192.168.1.130:9200/_cluster/health?pretty</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="_3-3-部署-kibana" tabindex="-1"><a class="header-anchor" href="#_3-3-部署-kibana"><span>3.3 部署 Kibana</span></a></h3><p>yaml</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>server.host: &quot;0.0.0.0&quot;</span></span>
<span class="line"><span>elasticsearch.hosts: [&quot;http://192.168.1.130:9200&quot;]</span></span>
<span class="line"><span>i18n.locale: &quot;zh-CN&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动：</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>./bin/kibana &amp;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_3-4-部署-logstash" tabindex="-1"><a class="header-anchor" href="#_3-4-部署-logstash"><span>3.4 部署 Logstash</span></a></h3><ol><li><p><strong>安装插件</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>bin/logstash-plugin install logstash-input-kafka</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>配置 logstash.conf</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>input {</span></span>
<span class="line"><span>  kafka {</span></span>
<span class="line"><span>    bootstrap_servers =&gt; &quot;192.168.1.140:9092,192.168.1.141:9092,192.168.1.142:9092&quot;</span></span>
<span class="line"><span>    topics =&gt; [&quot;logs&quot;]</span></span>
<span class="line"><span>    group_id =&gt; &quot;logstash-group&quot;</span></span>
<span class="line"><span>    codec =&gt; &quot;json&quot;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>filter {</span></span>
<span class="line"><span>  json { source =&gt; &quot;message&quot; }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>output {</span></span>
<span class="line"><span>  elasticsearch {</span></span>
<span class="line"><span>    hosts =&gt; [&quot;http://192.168.1.130:9200&quot;]</span></span>
<span class="line"><span>    index =&gt; &quot;logs-%{+YYYY.MM.dd}&quot;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="_3-5-部署-filebeat" tabindex="-1"><a class="header-anchor" href="#_3-5-部署-filebeat"><span>3.5 部署 Filebeat</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>filebeat.inputs:</span></span>
<span class="line"><span>  - type: log</span></span>
<span class="line"><span>    paths:</span></span>
<span class="line"><span>      - /var/log/nginx/access.log</span></span>
<span class="line"><span>      - /var/log/nginx/error.log</span></span>
<span class="line"><span></span></span>
<span class="line"><span>output.kafka:</span></span>
<span class="line"><span>  hosts: [&quot;192.168.1.140:9092&quot;,&quot;192.168.1.141:9092&quot;,&quot;192.168.1.142:9092&quot;]</span></span>
<span class="line"><span>  topic: &quot;logs&quot;</span></span>
<span class="line"><span>  partition.round_robin:</span></span>
<span class="line"><span>    reachable_only: true</span></span>
<span class="line"><span>  required_acks: 1</span></span>
<span class="line"><span>  compression: gzip</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>./filebeat -e -c filebeat.yml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_4-企业级优化建议" tabindex="-1"><a class="header-anchor" href="#_4-企业级优化建议"><span>4. 企业级优化建议</span></a></h2><ul><li><strong>Kafka</strong><ul><li>开启 <code>log.retention.hours</code> 控制日志保留时间</li><li>使用多分区提升并发消费能力</li></ul></li><li><strong>Elasticsearch</strong><ul><li>使用冷热分离（Hot/Warm/Cold 节点）</li><li>定期 rollover + ILM（Index Lifecycle Management）</li></ul></li><li><strong>Logstash</strong><ul><li>多 pipeline 并行处理</li><li>使用持久化队列（persistent queue）</li></ul></li><li><strong>Filebeat</strong><ul><li>启用 <code>bulk_max_size</code> 优化批量发送</li><li>使用多 prospector 分流不同日志类型</li></ul></li><li><strong>安全</strong><ul><li>启用 Kafka + ES 的 SASL/SSL</li><li>Kibana 配置用户权限（X-Pack）</li></ul></li></ul><h2 id="_5-验证与监控" tabindex="-1"><a class="header-anchor" href="#_5-验证与监控"><span>5. 验证与监控</span></a></h2><ul><li><strong>验证数据流</strong>：在 Kibana Discover 中搜索日志</li><li><strong>监控组件</strong>： <ul><li>Kafka：<code>kafka-topics.sh --describe</code></li><li>Elasticsearch：<code>/_cluster/health</code></li><li>Filebeat：<code>filebeat -e -d &quot;publish&quot;</code></li></ul></li><li><strong>告警</strong>：可接入 ElastAlert、Prometheus + Alertmanager</li></ul><h2 id="_6-总结" tabindex="-1"><a class="header-anchor" href="#_6-总结"><span>6. 总结</span></a></h2><p>通过 <strong>Filebeat → Kafka → Logstash → Elasticsearch → Kibana</strong> 的链路，可以构建一个高可用、可扩展、实时的企业级日志分析平台。Kafka 的引入不仅提升了系统的抗压能力，还为后续接入多种消费端（如大数据分析、实时告警）提供了可能性。</p>`,34)]))}const c=a(l,[["render",t]]),o=JSON.parse('{"path":"/%E6%99%BA%E7%BB%B4%E6%94%BB%E5%9F%8E%E7%8B%AE/S15/7.%E9%83%A8%E7%BD%B2%E4%BC%81%E4%B8%9A%E7%BA%A7ELK%20_%20Kafka%20_%20Filebeat.html","title":"如何部署企业级ELK + Kafka + Filebeat","lang":"en-US","frontmatter":{},"git":{"createdTime":1756914694000,"updatedTime":1756914694000,"contributors":[{"name":"star","username":"star","email":"star@xgss.net","commits":1,"url":"https://github.com/star"}]},"readingTime":{"minutes":2.47,"words":742},"filePathRelative":"智维攻城狮/S15/7.部署企业级ELK + Kafka + Filebeat.md"}');export{c as comp,o as data};
