import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as e,o as i}from"./app-BiQR_lPj.js";const p={};function l(t,s){return i(),a("div",null,s[0]||(s[0]=[e(`<h1 id="开源通义万相本地部署方案-文生视频、图生视频、视频生成大模型-支持消费级显卡" tabindex="-1"><a class="header-anchor" href="#开源通义万相本地部署方案-文生视频、图生视频、视频生成大模型-支持消费级显卡"><span>开源通义万相本地部署方案，文生视频、图生视频、视频生成大模型，支持消费级显卡！</span></a></h1><h1 id="万相2-1开源" tabindex="-1"><a class="header-anchor" href="#万相2-1开源"><span>万相2.1开源</span></a></h1><p>近日，大模型万相2.1（Wan）重磅开源，此次开源采用Apache2.0协议，14B和1.3B两个参数规格的全部推理代码和权重全部开源，同时支持文生视频和图生视频任务，全球开发者可在Github、HuggingFace、魔搭社区下载体验。</p><p>此次开源的两个参数版本模型：</p><h2 id="_14b版本万相模型" tabindex="-1"><a class="header-anchor" href="#_14b版本万相模型"><span>14B版本万相模型</span></a></h2><p>14B版本万相模型在指令遵循、复杂运动生成、物理建模、文字视频生成等方面表现突出，在权威评测集Vbench中，万相2.1以总分86.22%大幅超越Sora、Luma、Pika等国内外模型，稳居榜首位置。</p><h2 id="_1-3b版本" tabindex="-1"><a class="header-anchor" href="#_1-3b版本"><span>1.3B版本</span></a></h2><p>1.3B版本万相模型不仅超过了更大尺寸的开源模型，甚至还和一些闭源的模型结果接近，同时能在消费级显卡运行，仅需8.2GB显存就可以生成480P视频，适用于二次模型开发和学术研究。</p><p><img src="https://imgoss.xgss.net/picgo/image-20250315001037814.png?aliyun" alt="image-20250315001037814"></p><h2 id="开源社区链接" tabindex="-1"><a class="header-anchor" href="#开源社区链接"><span>开源社区链接</span></a></h2><p>Github: https://github.com/Wan-Video/Wan2.1</p><p>HuggingFace: https://huggingface.co/Wan-AI</p><p>魔搭社区：https://modelscope.cn/organization/Wan-AI</p><p>通义万相：https://tongyi.aliyun.com/wanxiang/videoCreation</p><h1 id="本地搭建" tabindex="-1"><a class="header-anchor" href="#本地搭建"><span>本地搭建</span></a></h1><h2 id="硬件介绍" tabindex="-1"><a class="header-anchor" href="#硬件介绍"><span>硬件介绍</span></a></h2><p>本测试的硬件</p><p>系统：Windows11专业版</p><p>CPU: 英特尔I7-13700KF</p><p>内存： 32G</p><p>硬盘：1T nvme +4T 机械</p><p>显卡：RTX 4070 Ti</p><h1 id="搭建说明" tabindex="-1"><a class="header-anchor" href="#搭建说明"><span>搭建说明</span></a></h1><p>起初按照官方推荐的方案搭建</p><h1 id="搭建方案一" tabindex="-1"><a class="header-anchor" href="#搭建方案一"><span>搭建方案一</span></a></h1><h2 id="_1-下载安装comfyui" tabindex="-1"><a class="header-anchor" href="#_1-下载安装comfyui"><span>1.下载安装ComfyUI</span></a></h2><p>一键安装包 ：</p><p>【<a href="https://www.comfy.org/" target="_blank" rel="noopener noreferrer">点击前往</a> 】https://www.comfy.org/ 支持 Windows 和 mac 系统，我这里下载Windows系统的</p><p>选择GPU</p><p><img src="https://imgoss.xgss.net/picgo/image-20250314145540776.png?aliyun" alt="image-20250314145540776"></p><p>安装位置，一般默认，如果C盘空间不够，可以改成其他位置</p><p>我这里改成D盘,D:\\AI\\ComfyUI</p><p><img src="https://imgoss.xgss.net/picgo/image-20250314145753940.png?aliyun" alt="image-20250314145753940"></p><p>其他默认</p><p>点击安装即可</p><p><img src="https://imgoss.xgss.net/picgo/image-20250314150111085.png?aliyun" alt="image-20250314150111085"></p><p><img src="https://imgoss.xgss.net/picgo/image-20250314150206714.png?aliyun" alt="image-20250314150206714"></p><p>安装完成之后，点击下载模型。</p><p><img src="https://imgoss.xgss.net/picgo/image-20250314150338625.png?aliyun" alt="image-20250314150338625"></p><h2 id="_2-下载文本编码器和-vae" tabindex="-1"><a class="header-anchor" href="#_2-下载文本编码器和-vae"><span>2.下载文本编码器和 VAE</span></a></h2><p>下载<a href="https://huggingface.co/Comfy-Org/Wan_2.1_ComfyUI_repackaged/tree/main/split_files/text_encoders" target="_blank" rel="noopener noreferrer">umt5_xxl_fp8_e4m3fn_scaled.safetensors </a>，</p><p>地址：https://huggingface.co/Comfy-Org/Wan_2.1_ComfyUI_repackaged/tree/main/split_files/text_encoders</p><p>如果显卡显存低于8G选择下载：“umt5_xxl_fp8_e4m3fn_scaled.safetensors”，如果你的显卡显存大于12G可以选择“umt5_xxl_fp16.safetensors”。</p><p>我这演示下载，umt5_xxl_fp8_e4m3fn_scaled.safetensors</p><p>将下载好的文件放入：ComfyUI/models/text_encoders/</p><p><a href="https://huggingface.co/Comfy-Org/Wan_2.1_ComfyUI_repackaged/blob/main/split_files/vae/wan_2.1_vae.safetensors" target="_blank" rel="noopener noreferrer">wan_2.1_vae.safetensors </a></p><p>地址：https://huggingface.co/Comfy-Org/Wan_2.1_ComfyUI_repackaged/blob/main/split_files/vae/wan_2.1_vae.safetensors</p><p><img src="https://imgoss.xgss.net/picgo/image-20250314152005864.png?aliyun" alt="image-20250314152005864"></p><p>放入：ComfyUI/models/vae/</p><h2 id="_3、-下载视频生成模型" tabindex="-1"><a class="header-anchor" href="#_3、-下载视频生成模型"><span>**3、**下载视频生成模型</span></a></h2><p>【<a href="https://huggingface.co/Comfy-Org/Wan_2.1_ComfyUI_repackaged/tree/main/split_files/diffusion_models" target="_blank" rel="noopener noreferrer">点击下载</a>】地址：https://huggingface.co/Comfy-Org/Wan_2.1_ComfyUI_repackaged/tree/main/split_files/diffusion_models</p><p>注意：建议使用 fp16 版本而不是 bf16 版本，因为它们会产生更好的结果。</p><p>质量等级（从高到低）：fp16 &gt; bf16 &gt; fp8_scaled &gt; fp8_e4m3fn</p><p>根据你自己的电脑配置选择。</p><p>我这里演示下载“wan2.1_t2v_1.3B_fp16.safetensors”</p><p>这些文件位于：ComfyUI/models/diffusion_models/</p><p>这些示例使用 16 位文件，但如果内存不足，则可以使用 fp8 文件。</p><h2 id="_4、文字转视频工作流" tabindex="-1"><a class="header-anchor" href="#_4、文字转视频工作流"><span>4、文字转视频工作流</span></a></h2><p>下载 <a href="https://comfyanonymous.github.io/ComfyUI_examples/wan/text_to_video_wan.json" target="_blank" rel="noopener noreferrer">Json 格式的工作流</a>，地址：https://comfyanonymous.github.io/ComfyUI_examples/wan/text_to_video_wan.json</p><h2 id="_5-导入工作流" tabindex="-1"><a class="header-anchor" href="#_5-导入工作流"><span>5.导入工作流</span></a></h2><p>重启 ComfyUI</p><p>默认的提示词，点击执行按钮。</p><p><img src="https://imgoss.xgss.net/picgo/image-20250314180435615.png?aliyun" alt="image-20250314180435615"></p><p>修改提示词，生成视频，以下图片为wan2.1生成的。</p><h2 id="关键字" tabindex="-1"><a class="header-anchor" href="#关键字"><span>关键字</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>一位时尚的女士在充满温暖发光的霓虹灯和动画城市标志的东京街道上行走。她穿着黑色皮夹克，一条长红裙和黑色靴子，背着黑色手提包。她戴着太阳镜和红色口红。她走路自信而随意。街道潮湿而具有反射性，营造出五光十色灯光的镜面效果。许多行人在四处走动。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="https://imgoss.xgss.net/picgo/image-20250314182843048.png?aliyun" alt="image-20250314182843048"></p><p>再让deepseek生成一些提示词</p><h2 id="美女滑雪" tabindex="-1"><a class="header-anchor" href="#美女滑雪"><span>美女滑雪</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>场景：雪山、滑雪道</span></span>
<span class="line"><span>主角：一位年轻女性，穿着时尚的滑雪服</span></span>
<span class="line"><span>动作：她快速下坡、做出流畅的转弯动作，偶尔做一些高难度的跳跃或花式动作</span></span>
<span class="line"><span>环境：阳光明媚，雪地反射出耀眼的光芒，远处是白雪覆盖的山脉，滑雪道上还有其他滑雪者</span></span>
<span class="line"><span>情感：展现出她的自信、优雅和速度感，镜头捕捉她兴奋和专注的表情</span></span>
<span class="line"><span>音乐：动感的电子音乐或极限运动风格的背景音乐</span></span>
<span class="line"><span>细节：镜头可以聚焦她的滑雪装备，或者快速转场展示她与雪地环境的互动。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://imgoss.xgss.net/picgo/image-20250314183103021.png?aliyun" alt="image-20250314183103021"></p><h2 id="小猫跳舞" tabindex="-1"><a class="header-anchor" href="#小猫跳舞"><span>小猫跳舞</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>场景：温馨的家中环境，阳光透过窗户照进房间，地板干净整洁</span></span>
<span class="line"><span>主角：一只可爱的小猫，毛茸茸的，颜色可以是橙色、黑白相间或其他可爱配色</span></span>
<span class="line"><span>动作：小猫随着音乐的节奏轻巧地跳舞，做出小范围的旋转、摆动或是可爱的舞步，甚至可能用爪子打节奏</span></span>
<span class="line"><span>环境：房间里可能有玩具球、毯子等小猫常见的物品，增添趣味性</span></span>
<span class="line"><span>音乐：欢快的、轻松的背景音乐，适合小猫的动作和气氛，可以是一些童趣或电子风格的旋律</span></span>
<span class="line"><span>情感：表现出小猫调皮、活泼的一面，配合镜头捕捉它快乐、专注、或者搞怪的表情</span></span>
<span class="line"><span>细节：可以特写小猫的脚步或尾巴的摆动，展示其动作的协调性和可爱程度，偶尔做些搞笑或意外的动作来增加趣味性。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://imgoss.xgss.net/picgo/image-20250314183344374.png?aliyun" alt="image-20250314183344374"></p><h1 id="图生视频" tabindex="-1"><a class="header-anchor" href="#图生视频"><span>图生视频</span></a></h1><h2 id="下载wan2-1-i2v-480p-14b-fp16-safetensors文件" tabindex="-1"><a class="header-anchor" href="#下载wan2-1-i2v-480p-14b-fp16-safetensors文件"><span>下载<a href="https://huggingface.co/Comfy-Org/Wan_2.1_ComfyUI_repackaged/blob/main/split_files/diffusion_models/wan2.1_i2v_480p_14B_fp16.safetensors" target="_blank" rel="noopener noreferrer">wan2.1_i2v_480p_14B_fp16.safetensors</a>文件</span></a></h2><p>地址： https://huggingface.co/Comfy-Org/Wan_2.1_ComfyUI_repackaged/tree/main/split_files/diffusion_models</p><p>根据自己的显存大小选择，我这里选择小一点的 wan2.1_t2v_1.3B_bf16.safetensors</p><p>将其放入：ComfyUI/models/diffusion_models/</p><p><img src="https://imgoss.xgss.net/picgo/image-20250314160257722.png?aliyun" alt="image-20250314160257722"></p><p>下载 <a href="https://huggingface.co/Comfy-Org/Wan_2.1_ComfyUI_repackaged/blob/main/split_files/clip_vision/clip_vision_h.safetensors" target="_blank" rel="noopener noreferrer">clip_vision_h.safetensors</a> 文件</p><p>地址：https://huggingface.co/Comfy-Org/Wan_2.1_ComfyUI_repackaged/blob/main/split_files/clip_vision/clip_vision_h.safetensors</p><p><img src="https://imgoss.xgss.net/picgo/image-20250314155920162.png?aliyun" alt="image-20250314155920162"></p><p>放入：ComfyUI/models/clip_vision/</p><p>请注意，此示例仅生成 512×512 的 33 帧，因为我希望它易于访问，但模型可以做的不止这些。如果您有硬件/耐心运行它，720p 模型就相当不错。</p><p><a href="https://comfyanonymous.github.io/ComfyUI_examples/wan/image_to_video_wan_example.json" target="_blank" rel="noopener noreferrer">Json 格式的工作流</a></p><p><a href="https://comfyanonymous.github.io/ComfyUI_examples/flux" target="_blank" rel="noopener noreferrer">输入图像可以在通量</a>页面上找到。</p><p><a href="https://huggingface.co/Comfy-Org/Wan_2.1_ComfyUI_repackaged/blob/main/split_files/diffusion_models/wan2.1_i2v_720p_14B_fp16.safetensors" target="_blank" rel="noopener noreferrer">以下是720p </a>型号的相同示例：</p><p>山羊打架</p><p>原图：</p><p><img src="https://imgoss.xgss.net/picgo/image-20250314183556177.png?aliyun" alt="image-20250314183556177"></p><p>生成之后的视频（截图）</p><p><img src="https://imgoss.xgss.net/picgo/image-20250314183534058.png?aliyun" alt="image-20250314183534058"></p><h1 id="搭建方案二" tabindex="-1"><a class="header-anchor" href="#搭建方案二"><span>搭建方案二</span></a></h1><p>由于方案二搭建方案一直报错，这种方法不推荐，仅作为笔者记录采坑！</p><h2 id="_1-安装python" tabindex="-1"><a class="header-anchor" href="#_1-安装python"><span>1.安装Python</span></a></h2><p>去python官网下载：</p><p>https://www.python.org/downloads/</p><p>我这边下载的是 python-3.13.2-amd64.exe</p><p>安装python</p><p>勾选下面两项，再点击 install now，安装软件。</p><p><img src="https://imgoss.xgss.net/picgo/image-20250307161033932.png?aliyun" alt="image-20250307161033932"></p><h2 id="_2-python换成国内源" tabindex="-1"><a class="header-anchor" href="#_2-python换成国内源"><span>2.Python换成国内源</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>在命令行中执行：</p><p><img src="https://imgoss.xgss.net/picgo/image-20250307161525029.png?aliyun" alt="image-20250307161525029"></p><h2 id="_3-克隆项目wan2-1" tabindex="-1"><a class="header-anchor" href="#_3-克隆项目wan2-1"><span>3.克隆项目Wan2.1</span></a></h2><p>克隆项目</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>git clone https://github.com/Wan-Video/Wan2.1.git</span></span>
<span class="line"><span>cd Wan2.1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>安装依赖</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>Install dependencies:</span></span>
<span class="line"><span>查看版本：</span></span>
<span class="line"><span>pip --version</span></span>
<span class="line"><span>pip 24.3.1 </span></span>
<span class="line"><span></span></span>
<span class="line"><span># Ensure torch &gt;= 2.4.0</span></span>
<span class="line"><span>pip install -r requirements.txt</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://imgoss.xgss.net/picgo/image-20250307162035740.png?aliyun" alt="image-20250307162035740"></p><p>报错1：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>     ---------------------------------------- 1.3/1.3 MB 506.7 kB/s eta 0:00:00</span></span>
<span class="line"><span>Collecting imageio-ffmpeg (from -r requirements.txt (line 13))</span></span>
<span class="line"><span>  Downloading https://pypi.tuna.tsinghua.edu.cn/packages/2c/c6/fa760e12a2483469e2bf5058c5faff664acf66cadb4df2ad6205b016a73d/imageio_ffmpeg-0.6.0-py3-none-win_amd64.whl (31.2 MB)</span></span>
<span class="line"><span>     -------------------------------------- 31.2/31.2 MB 565.4 kB/s eta 0:00:00</span></span>
<span class="line"><span>Collecting flash_attn (from -r requirements.txt (line 14))</span></span>
<span class="line"><span>  Downloading https://pypi.tuna.tsinghua.edu.cn/packages/11/34/9bf60e736ed7bbe15055ac2dab48ec67d9dbd088d2b4ae318fd77190ab4e/flash_attn-2.7.4.post1.tar.gz (6.0 MB)</span></span>
<span class="line"><span>     ---------------------------------------- 6.0/6.0 MB 872.1 kB/s eta 0:00:00</span></span>
<span class="line"><span>ERROR: Could not install packages due to an OSError: [Errno 2] No such file or directory: &#39;C:\\\\Users\\\\Administrator\\\\AppData\\\\Local\\\\Temp\\\\pip-install-8t1fvex0\\\\flash-attn_355b4bf0645846d5946da128691050af\\\\csrc\\\\composable_kernel\\\\client_example\\\\24_grouped_conv_activation\\\\grouped_convnd_fwd_scaleadd_scaleadd_relu\\\\grouped_conv_fwd_scaleadd_scaleadd_relu_bf16.cpp&#39;</span></span>
<span class="line"><span>HINT: This error might have occurred since this system does not have Windows Long Path support enabled. You can find information on how to enable this at https://pip.pypa.io/warnings/enable-long-paths</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>[notice] A new release of pip is available: 24.3.1 -&gt; 25.0.1</span></span>
<span class="line"><span>[notice] To update, run: python.exe -m pip install --upgrade pip</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>解决：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>python.exe -m pip install --upgrade pip</span></span>
<span class="line"><span>pip --version</span></span>
<span class="line"><span>pip 25.0.1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>报错2：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>Collecting flash_attn (from -r requirements.txt (line 14))</span></span>
<span class="line"><span>  Using cached https://pypi.tuna.tsinghua.edu.cn/packages/11/34/9bf60e736ed7bbe15055ac2dab48ec67d9dbd088d2b4ae318fd77190ab4e/flash_attn-2.7.4.post1.tar.gz (6.0 MB)</span></span>
<span class="line"><span>ERROR: Could not install packages due to an OSError: [Errno 2] No such file or directory: &#39;C:\\\\Users\\\\Administrator\\\\AppData\\\\Local\\\\Temp\\\\pip-install-kgnff0x2\\\\flash-attn_f6b86d432d5f493d9ccd50fb1e950e0e\\\\csrc\\\\composable_kernel\\\\client_example\\\\24_grouped_conv_activation\\\\grouped_convnd_fwd_scaleadd_scaleadd_relu\\\\grouped_conv_fwd_scaleadd_scaleadd_relu_bf16.cpp&#39;</span></span>
<span class="line"><span>HINT: This error might have occurred since this system does not have Windows Long Path support enabled. You can find information on how to enable this at https://pip.pypa.io/warnings/enable-long-paths</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="启用windows长路径支持" tabindex="-1"><a class="header-anchor" href="#启用windows长路径支持"><span>启用Windows长路径支持</span></a></h3><p>从Windows 10版本1607开始，Microsoft引入了对长路径的支持，但需要手动启用。</p><ol><li><p><strong>通过注册表启用长路径支持</strong></p><ul><li><p>按下<code>Win + R</code>，打开运行对话框，输入<code>regedit</code>并回车，打开注册表编辑器。</p></li><li><p>导航到以下路径：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\FileSystem</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>在右侧窗格中找到名为<code>LongPathsEnabled</code>的DWORD值。如果没有，右键单击空白处，选择新建 -&gt; DWORD（32位）值，并命名为<code>LongPathsEnabled</code>。</p></li><li><p>双击<code>LongPathsEnabled</code>，将其值设置为<code>1</code>。</p></li><li><p>关闭注册表编辑器。</p></li></ul><p><strong>或者</strong>，你可以使用以下PowerShell命令（需要管理员权限）：</p><p>powershell</p><div class="language-powershell line-numbers-mode" data-highlighter="shiki" data-ext="powershell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-powershell"><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">New-ItemProperty</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Path </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\FileSystem&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Name </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;LongPathsEnabled&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Value </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">PropertyType DWORD </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Force</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol><p><img src="https://imgoss.xgss.net/picgo/image-20250307164222817.png?aliyun" alt="image-20250307164222817"></p><p>报错3</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>  Getting requirements to build wheel did not run successfully.</span></span>
<span class="line"><span>  exit code: 1</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  [23 lines of output]</span></span>
<span class="line"><span>  Traceback (most recent call last):</span></span>
<span class="line"><span>    File &quot;C:\\Users\\Administrator\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\site-packages\\pip\\_vendor\\pyproject_hooks\\_in_process\\_in_process.py&quot;, line 389, in &lt;module&gt;</span></span>
<span class="line"><span>      main()</span></span>
<span class="line"><span>      ~~~~^^</span></span>
<span class="line"><span>    File &quot;C:\\Users\\Administrator\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\site-packages\\pip\\_vendor\\pyproject_hooks\\_in_process\\_in_process.py&quot;, line 373, in main</span></span>
<span class="line"><span>      json_out[&quot;return_val&quot;] = hook(**hook_input[&quot;kwargs&quot;])</span></span>
<span class="line"><span>                               ~~~~^^^^^^^^^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span>    File &quot;C:\\Users\\Administrator\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\site-packages\\pip\\_vendor\\pyproject_hooks\\_in_process\\_in_process.py&quot;, line 143, in get_requires_for_build_wheel</span></span>
<span class="line"><span>      return hook(config_settings)</span></span>
<span class="line"><span>    File &quot;C:\\Users\\Administrator\\AppData\\Local\\Temp\\pip-build-env-jbn4g9x9\\overlay\\Lib\\site-packages\\setuptools\\build_meta.py&quot;, line 334, in get_requires_for_build_wheel</span></span>
<span class="line"><span>      return self._get_build_requires(config_settings, requirements=[])</span></span>
<span class="line"><span>             ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span>    File &quot;C:\\Users\\Administrator\\AppData\\Local\\Temp\\pip-build-env-jbn4g9x9\\overlay\\Lib\\site-packages\\setuptools\\build_meta.py&quot;, line 304, in _get_build_requires</span></span>
<span class="line"><span>      self.run_setup()</span></span>
<span class="line"><span>      ~~~~~~~~~~~~~~^^</span></span>
<span class="line"><span>    File &quot;C:\\Users\\Administrator\\AppData\\Local\\Temp\\pip-build-env-jbn4g9x9\\overlay\\Lib\\site-packages\\setuptools\\build_meta.py&quot;, line 522, in run_setup</span></span>
<span class="line"><span>      super().run_setup(setup_script=setup_script)</span></span>
<span class="line"><span>      ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span>    File &quot;C:\\Users\\Administrator\\AppData\\Local\\Temp\\pip-build-env-jbn4g9x9\\overlay\\Lib\\site-packages\\setuptools\\build_meta.py&quot;, line 320, in run_setup</span></span>
<span class="line"><span>      exec(code, locals())</span></span>
<span class="line"><span>      ~~~~^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span>    File &quot;&lt;string&gt;&quot;, line 22, in &lt;module&gt;</span></span>
<span class="line"><span>  ModuleNotFoundError: No module named &#39;torch&#39;</span></span>
<span class="line"><span>  [end of output]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  note: This error originates from a subprocess, and is likely not a problem with pip.</span></span>
<span class="line"><span>error: subprocess-exited-with-error</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Getting requirements to build wheel did not run successfully.</span></span>
<span class="line"><span>exit code: 1</span></span>
<span class="line"><span></span></span>
<span class="line"><span>See above for output.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>note: This error originates from a subprocess, and is likely not a problem with pip.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="查看nvidia的版本" tabindex="-1"><a class="header-anchor" href="#查看nvidia的版本"><span>查看NVIDIA的版本</span></a></h2><p><img src="https://imgoss.xgss.net/picgo/image-20250307170811387.png?aliyun" alt="image-20250307170811387"></p><h2 id="下载cuda-toolkit" tabindex="-1"><a class="header-anchor" href="#下载cuda-toolkit"><span>下载CUDA Toolkit</span></a></h2><p>https://developer.nvidia.com/cuda-toolkit-archive</p><p><img src="https://imgoss.xgss.net/picgo/image-20250307171126638.png?aliyun" alt="image-20250307171126638"></p><p>安装软件</p><p><img src="https://imgoss.xgss.net/picgo2025/image-20250307171840360.png?aliyun" alt="image-20250307171840360"></p><p><img src="https://imgoss.xgss.net/picgo/image-20250307172337568.png?aliyun" alt="image-20250307172337568"></p><p>验证</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>nvcc --version</span></span>
<span class="line"><span>nvcc: NVIDIA (R) Cuda compiler driver</span></span>
<span class="line"><span>Copyright (c) 2005-2024 NVIDIA Corporation</span></span>
<span class="line"><span>Built on Wed_Oct_30_01:18:48_Pacific_Daylight_Time_2024</span></span>
<span class="line"><span>Cuda compilation tools, release 12.6, V12.6.85</span></span>
<span class="line"><span>Build cuda_12.6.r12.6/compiler.35059454_0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="安装flash-attn" tabindex="-1"><a class="header-anchor" href="#安装flash-attn"><span>安装flash_attn</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>pip install flash_attn -i https://mirrors.aliyun.com/pypi/simple/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>遇到报错：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span> pip install flash_attn -i https://mirrors.aliyun.com/pypi/simple/</span></span>
<span class="line"><span>Looking in indexes: https://mirrors.aliyun.com/pypi/simple/</span></span>
<span class="line"><span>Collecting flash_attn</span></span>
<span class="line"><span>  Using cached https://mirrors.aliyun.com/pypi/packages/11/34/9bf60e736ed7bbe15055ac2dab48ec67d9dbd088d2b4ae318fd77190ab4e/flash_attn-2.7.4.post1.tar.gz (6.0 MB)</span></span>
<span class="line"><span>  Installing build dependencies ... done</span></span>
<span class="line"><span>  Getting requirements to build wheel ... error</span></span>
<span class="line"><span>  error: subprocess-exited-with-error</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  × Getting requirements to build wheel did not run successfully.</span></span>
<span class="line"><span>  │ exit code: 1</span></span>
<span class="line"><span>  ╰─&gt; [23 lines of output]</span></span>
<span class="line"><span>      Traceback (most recent call last):</span></span>
<span class="line"><span>        File &quot;C:\\Users\\Administrator\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\site-packages\\pip\\_vendor\\pyproject_hooks\\_in_process\\_in_process.py&quot;, line 389, in &lt;module&gt;</span></span>
<span class="line"><span>          main()</span></span>
<span class="line"><span>          ~~~~^^</span></span>
<span class="line"><span>        File &quot;C:\\Users\\Administrator\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\site-packages\\pip\\_vendor\\pyproject_hooks\\_in_process\\_in_process.py&quot;, line 373, in main</span></span>
<span class="line"><span>          json_out[&quot;return_val&quot;] = hook(**hook_input[&quot;kwargs&quot;])</span></span>
<span class="line"><span>                                   ~~~~^^^^^^^^^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span>        File &quot;C:\\Users\\Administrator\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\site-packages\\pip\\_vendor\\pyproject_hooks\\_in_process\\_in_process.py&quot;, line 143, in get_requires_for_build_wheel</span></span>
<span class="line"><span>          return hook(config_settings)</span></span>
<span class="line"><span>        File &quot;C:\\Users\\Administrator\\AppData\\Local\\Temp\\pip-build-env-1qn6p69k\\overlay\\Lib\\site-packages\\setuptools\\build_meta.py&quot;, line 334, in get_requires_for_build_wheel</span></span>
<span class="line"><span>          return self._get_build_requires(config_settings, requirements=[])</span></span>
<span class="line"><span>                 ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span>        File &quot;C:\\Users\\Administrator\\AppData\\Local\\Temp\\pip-build-env-1qn6p69k\\overlay\\Lib\\site-packages\\setuptools\\build_meta.py&quot;, line 304, in _get_build_requires</span></span>
<span class="line"><span>          self.run_setup()</span></span>
<span class="line"><span>          ~~~~~~~~~~~~~~^^</span></span>
<span class="line"><span>        File &quot;C:\\Users\\Administrator\\AppData\\Local\\Temp\\pip-build-env-1qn6p69k\\overlay\\Lib\\site-packages\\setuptools\\build_meta.py&quot;, line 522, in run_setup</span></span>
<span class="line"><span>          super().run_setup(setup_script=setup_script)</span></span>
<span class="line"><span>          ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span>        File &quot;C:\\Users\\Administrator\\AppData\\Local\\Temp\\pip-build-env-1qn6p69k\\overlay\\Lib\\site-packages\\setuptools\\build_meta.py&quot;, line 320, in run_setup</span></span>
<span class="line"><span>          exec(code, locals())</span></span>
<span class="line"><span>          ~~~~^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span>        File &quot;&lt;string&gt;&quot;, line 22, in &lt;module&gt;</span></span>
<span class="line"><span>      ModuleNotFoundError: No module named &#39;torch&#39;</span></span>
<span class="line"><span>      [end of output]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  note: This error originates from a subprocess, and is likely not a problem with pip.</span></span>
<span class="line"><span>error: subprocess-exited-with-error</span></span>
<span class="line"><span></span></span>
<span class="line"><span>× Getting requirements to build wheel did not run successfully.</span></span>
<span class="line"><span>│ exit code: 1</span></span>
<span class="line"><span>╰─&gt; See above for output.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>note: This error originates from a subprocess, and is likely not a problem with pip.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>试了很多方法一直报错，放弃了</p><h1 id="结束" tabindex="-1"><a class="header-anchor" href="#结束"><span>结束</span></a></h1><p>这就是部署开源通义万相本地部署方案，简直是视频生成领域的一大福音。它降低了使用门槛，让更多人能体验到AI视频生成的乐趣。如果你对视频创作、AI技术感兴趣，那可千万别错过。</p><p>写文不易，如果你都看到了这里，请点个赞和在看，分享给更多的朋友；也别忘了关注星哥玩云！这里有满满的干货分享，还有轻松有趣的技术交流～点个赞、分享给身边的小伙伴，一起成长，一起玩转技术世界吧！ 😊</p>`,142)]))}const o=n(p,[["render",l]]),c=JSON.parse('{"path":"/article/7awhl5rb/","title":"3.通义万相本地部署-文生图","lang":"en-US","frontmatter":{"title":"3.通义万相本地部署-文生图","createTime":"2025/05/27 17:51:17","permalink":"/article/7awhl5rb/"},"git":{"createdTime":1749111496000,"updatedTime":1750129445000,"contributors":[{"name":"star","username":"star","email":"star@xgss.net","commits":3,"url":"https://github.com/star"}]},"readingTime":{"minutes":9.73,"words":2919},"filePathRelative":"chatgpt2025/3.通义万相本地部署-文生图.md"}');export{o as comp,c as data};
