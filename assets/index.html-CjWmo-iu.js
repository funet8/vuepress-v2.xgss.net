import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as i,o as n}from"./app-BiQR_lPj.js";const l={};function d(r,s){return n(),a("div",null,s[0]||(s[0]=[i(`<h1 id="如何做一个mysql的自动巡检脚本" tabindex="-1"><a class="header-anchor" href="#如何做一个mysql的自动巡检脚本"><span>如何做一个MySQL的自动巡检脚本</span></a></h1><p>作为一个运维工程师，巡检少不了，如何做一个MySQL的自动巡检脚本（语言不限），最好能提供一些巡检指标、巡检项目、巡检语句的解释、最终的巡检文件等等。</p><p>本文是根据公众号@墨天轮的，根据这个文章 https://mp.weixin.qq.com/s/jHs7_lerBBIeDBDXraGW5Q 。</p><p>文章末尾有获取shell的巡检脚本和《MySQL数据库巡检报告模板.pdf》的方法。</p><p><img src="https://imgoss.xgss.net/picgo/mysql-xunjian2.jpg?aliyun" alt="mysql-xunjian2"></p><h2 id="输出结果页面" tabindex="-1"><a class="header-anchor" href="#输出结果页面"><span>输出结果页面</span></a></h2><p>使用shell脚本输出html页面的截图</p><p><img src="https://imgoss.xgss.net/picgo/image-20241013233714183.png?aliyun" alt="image-20241013233714183"></p><h2 id="数据库版本" tabindex="-1"><a class="header-anchor" href="#数据库版本"><span>数据库版本</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>select version();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="数据库大小" tabindex="-1"><a class="header-anchor" href="#数据库大小"><span>数据库大小</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>SELECT table_schema &quot;Database name&quot;, sum( table_rows ) &quot;No. of rows&quot;, sum( data_length ) / 1024 / 1024 &quot;Size data (MB)&quot;, sum( index_length)/ 1024 / 1024 &quot;Size index (MB)&quot; FROM information_schema.TABLES GROUP BY table_schema;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="自增-id-使用" tabindex="-1"><a class="header-anchor" href="#自增-id-使用"><span>自增 ID 使用</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>SELECT table_schema, table_name,ENGINE, Auto_increment FROM information_schema.TABLES WHERE TABLE_SCHEMA NOT IN( &quot;INFORMATION_SCHEMA&quot;, &quot;PERFORMANCE_SCHEMA&quot;,&quot;MYSQL&quot;, &quot;SYS&quot;) limit 30;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="存储引擎不是-innodb-的表" tabindex="-1"><a class="header-anchor" href="#存储引擎不是-innodb-的表"><span>存储引擎不是 innodb 的表</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>SELECT TABLE_SCHEMA, TABLE_NAME,ENGINE FROM INFORMATION_SCHEMA.TABLES WHERE ENGINE != &#39;innodb&#39; AND TABLE_SCHEMA NOT IN ( &quot;INFORMATION_SCHEMA&quot;, &quot;PERFORMANCE_SCHEMA&quot;, &quot;MYSQL&quot;, &quot;SYS&quot; );</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="无主键的表" tabindex="-1"><a class="header-anchor" href="#无主键的表"><span>无主键的表</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>SELECT t1.table_schema, t1.table_name, t1.table_type FROM information_schema.TABLES t1 LEFT OUTER JOIN information_schema.TABLE_CONSTRAINTS t2 ON t1.table_schema = t2.TABLE_SCHEMA AND t1.table_name = t2.TABLE_NAME AND t2.CONSTRAINT_NAME IN ( &#39;PRIMARY&#39; ) WHERE t2.table_name IS NULL AND t1.TABLE_SCHEMANOT IN ( &#39;information_schema&#39;, &#39;performance_schema&#39;, &#39;test&#39;, &#39;mysql&#39;, &#39;sys&#39; ) AND t1.table_type = &quot;BASE TABLE&quot;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="运行线程状态查询" tabindex="-1"><a class="header-anchor" href="#运行线程状态查询"><span>运行线程状态查询</span></a></h2><p>查看当前并发 线程是否状态正常。检查 state 列是否存在 wait for xxx lock 的状态，如果有则存在锁事务；</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show full processlist;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>mariadb&gt; show full processlist;</span></span>
<span class="line"><span>+-----+-------------+---------------------+------+---------+------+--------------------------+-----------------------+----------+</span></span>
<span class="line"><span>| Id  | User        | Host                | db   | Command | Time | State                    | Info                  | Progress |</span></span>
<span class="line"><span>+-----+-------------+---------------------+------+---------+------+--------------------------+-----------------------+----------+</span></span>
<span class="line"><span>|   2 | system user |                     | NULL | Daemon  | NULL | InnoDB purge worker      | NULL                  |    0.000 |</span></span>
<span class="line"><span>|   1 | system user |                     | NULL | Daemon  | NULL | InnoDB purge coordinator | NULL                  |    0.000 |</span></span>
<span class="line"><span>|   3 | system user |                     | NULL | Daemon  | NULL | InnoDB purge worker      | NULL                  |    0.000 |</span></span>
<span class="line"><span>|   4 | system user |                     | NULL | Daemon  | NULL | InnoDB purge worker      | NULL                  |    0.000 |</span></span>
<span class="line"><span>|   5 | system user |                     | NULL | Daemon  | NULL | InnoDB shutdown handler  | NULL                  |    0.000 |</span></span>
<span class="line"><span>| 113 | root        | 192.168.1.251:11537 | NULL | Query   |    0 | init                     | show full processlist |    0.000 |</span></span>
<span class="line"><span>+-----+-------------+---------------------+------+---------+------+--------------------------+-----------------------+----------+</span></span>
<span class="line"><span>6 rows in set (0.04 sec)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="innodb-死锁检查" tabindex="-1"><a class="header-anchor" href="#innodb-死锁检查"><span>InnoDB 死锁检查</span></a></h2><p>查看 LATEST DETECTED, DEADLOCK 输出段，若存在，则需要摘取相应的语句。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show engine innodb status;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="innodb-长事务检查" tabindex="-1"><a class="header-anchor" href="#innodb-长事务检查"><span>InnoDB 长事务检查</span></a></h2><p>检查 TRANSACTIONS 输出段，看是否存在 ACTIVE 时间过长的事务，若存在，则需要关注</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show engine innodb status;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="指定-tcp-ip连接的侦听队列的大小" tabindex="-1"><a class="header-anchor" href="#指定-tcp-ip连接的侦听队列的大小"><span>指定 TCP/IP连接的侦听队列的大小</span></a></h2><p>back_log 参数的值指出在 MySQL 暂时停止响应新请求之前的短时间内多少个请求可以被存在堆栈中。如果系统在一个短时间内有很多连接，则需要增大该参数的值。不同的操作系统在这个队列。默认值为 50。对于 Linux 系统推荐设置为小于 512 的整数。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show variables like &#39;back_log%&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="max-allowed-packet包的值" tabindex="-1"><a class="header-anchor" href="#max-allowed-packet包的值"><span>max_allowed_packet包的值</span></a></h2><p>客户端和服务器均有自己的max_allowed_packet 变量，如打算处理大的信息包，必须增加客户端和服务器上的该变量。一般情况下，服务器默认max-allowed-packet 为 1MB</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show variables like &#39;max_allowed_packet%&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="交互式连接超时时间" tabindex="-1"><a class="header-anchor" href="#交互式连接超时时间"><span>交互式连接超时时间</span></a></h2><p>交互式连接超时时间(mysql 工具、mysqldump 等),参数默认值：28800 秒（8 小时），建议调小。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show variables like &#39;interactive_timeout%&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="非交互式连接超时时间" tabindex="-1"><a class="header-anchor" href="#非交互式连接超时时间"><span>非交互式连接超时时间</span></a></h2><p>非交互式连接超时时间，默认的连接mysql api 程序,jdbc 连接数据库等,参数默认值：28800 秒（8 小时），建议调小。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show variables like &#39;wait_timeout%&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="skip-name-resolve" tabindex="-1"><a class="header-anchor" href="#skip-name-resolve"><span>skip_name_resolve</span></a></h2><p>使用该参数后可加快内网地址的请求</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show variables like &#39;skip_name_resolve%&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="最大连接数检查" tabindex="-1"><a class="header-anchor" href="#最大连接数检查"><span>最大连接数检查</span></a></h2><p>若 max_used_connections 逼近max_connections ，则需要调大max_connections。 max_used_connections / max_connections * 100% （理想值≈ 85%）</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show global status like &#39;max_used_connections&#39;;</span></span>
<span class="line"><span>show global variables like &#39;max_connections&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="当前连接数检查" tabindex="-1"><a class="header-anchor" href="#当前连接数检查"><span>当前连接数检查</span></a></h2><p>应小于 max_connections</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show global status like &#39;Threads_connected&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="异常连接检查" tabindex="-1"><a class="header-anchor" href="#异常连接检查"><span>异常连接检查</span></a></h2><p>检 查 Aborted_clients 以 及Aborted_connects 值是否正常</p><p>Aborted_clients: 表示客户端连接被中止的次数。这通常是因为客户端超时、错误或其他原因导致连接中断。 Aborted_connects: 表示尝试建立连接但被中止的次数。这可能由于客户端连接过多、服务器资源不足、网络问题或其他原因导致。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show global status like &#39;aborted%&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="开启-binlog-日志" tabindex="-1"><a class="header-anchor" href="#开启-binlog-日志"><span>开启 binlog 日志</span></a></h2><p>binlog 日志开启，能实时记录保存DML 操作</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show variables like &#39;log_bin%&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="binlog-保留天数" tabindex="-1"><a class="header-anchor" href="#binlog-保留天数"><span>binlog 保留天数</span></a></h2><p>让mysql 自动清理若干天前的binlog</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show variables like &#39;expire_logs_days%&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="文件打开限制数" tabindex="-1"><a class="header-anchor" href="#文件打开限制数"><span>文件打开限制数</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show variables like &#39;open_files_limit%&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="线程池缓存大小" tabindex="-1"><a class="header-anchor" href="#线程池缓存大小"><span>线程池缓存大小</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show variables like &#39;thread_cache_size%&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="排序缓冲区大小" tabindex="-1"><a class="header-anchor" href="#排序缓冲区大小"><span>排序缓冲区大小</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show variables like &#39;sort_buffer_size%&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="内连接缓冲区大小" tabindex="-1"><a class="header-anchor" href="#内连接缓冲区大小"><span>内连接缓冲区大小</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show variables like &#39;join_buffer_size%&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="innodb-存储引擎缓存分配大小" tabindex="-1"><a class="header-anchor" href="#innodb-存储引擎缓存分配大小"><span>InnoDB 存储引擎缓存分配大小</span></a></h2><p>物理内存的 50% - 75%</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show global variables like &#39;innodb_buffer_pool_size&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="展示innodb-io-capacity的全局变量" tabindex="-1"><a class="header-anchor" href="#展示innodb-io-capacity的全局变量"><span>展示Innodb_io_capacity的全局变量</span></a></h2><p>控制 InnoDB 引擎的 I/O 操作速率</p><p>sata/sas 硬盘这个值在 200。 sas raid10: 2000。 ssd 硬盘：8000。 fusion-io（闪存卡）：25,000-50,000。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show global variables like &#39;innodb_io_capacity&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="表缓存检查" tabindex="-1"><a class="header-anchor" href="#表缓存检查"><span>表缓存检查</span></a></h2><p>若 opened_tables 过大，则需要调大table_open_cache 值</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show global status like &#39;%opened_tables%&#39;;</span></span>
<span class="line"><span>show variables like &#39;%table_open_cache%&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="查询缓存检查" tabindex="-1"><a class="header-anchor" href="#查询缓存检查"><span>查询缓存检查</span></a></h2><p>一般情况下，需要禁用 query_cache</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show variables like &#39;%query_cache%&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="表缓存检查-1" tabindex="-1"><a class="header-anchor" href="#表缓存检查-1"><span>表缓存检查</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show global status like &#39;%opened_tables%&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="innodb-独立表空间" tabindex="-1"><a class="header-anchor" href="#innodb-独立表空间"><span>InnoDB 独立表空间</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show variables like &#39;innodb_file_per_table%&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="innodb-打开文件数" tabindex="-1"><a class="header-anchor" href="#innodb-打开文件数"><span>InnoDB 打开文件数</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show variables like &#39;innodb_open_files%&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="innodb-并发线程" tabindex="-1"><a class="header-anchor" href="#innodb-并发线程"><span>InnoDB 并发线程</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show variables like &#39;innodb_thread_concurrency%&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="innodb-将缓存中的redo-日志回写到日志文件的设置" tabindex="-1"><a class="header-anchor" href="#innodb-将缓存中的redo-日志回写到日志文件的设置"><span>InnoDB 将缓存中的redo 日志回写到日志文件的设置</span></a></h2><p>建议设为 1</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show variables like &#39;innodb_flush_log_at_trx_commit%&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="innodb-日志缓冲大小" tabindex="-1"><a class="header-anchor" href="#innodb-日志缓冲大小"><span>InnoDB 日志缓冲大小</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show variables like &#39;sync_binlog%&#39;;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>show variables like &#39;innodb_log_buffer_size%&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="innodb-日志文件大小" tabindex="-1"><a class="header-anchor" href="#innodb-日志文件大小"><span>InnoDB 日志文件大小</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show variables like &#39;innodb_log_file_size%&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="innodb-日志文件组" tabindex="-1"><a class="header-anchor" href="#innodb-日志文件组"><span>InnoDB 日志文件组</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show variables like &#39;innodb_log_files_in_group%&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>QPS 检查 (间隔执行,通过两次的间隔时间做差值，计算 QPS)</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show status like &#39;queries&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="读写比检查" tabindex="-1"><a class="header-anchor" href="#读写比检查"><span>读写比检查</span></a></h2><p>读请求是 com_select； 写请求是 com_insert； com_update;com_delete 通过统计读写的请求数，算出读写比例。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show status like &#39;com_%&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="innodb-buffer-pool-检查" tabindex="-1"><a class="header-anchor" href="#innodb-buffer-pool-检查"><span>InnoDB Buffer Pool 检查</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show status like &#39;Innodb_buffer_pool_read_requests&#39;;</span></span>
<span class="line"><span>show status like &#39;Innodb_buffer_pool_reads&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="临时表检查" tabindex="-1"><a class="header-anchor" href="#临时表检查"><span>临时表检查</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show global status like &#39;%tmp%&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="存储引擎binlog-磁盘使用比例" tabindex="-1"><a class="header-anchor" href="#存储引擎binlog-磁盘使用比例"><span>存储引擎binlog 磁盘使用比例</span></a></h2><p>Binlog_cache_disk_use / Binlog_cache_use</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span></span></span>
<span class="line"><span>show global status like &#39;Binlog_cache_disk_use&#39;;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>show global status like &#39;Binlog_cache_use&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="存储引擎磁盘临时表创建数" tabindex="-1"><a class="header-anchor" href="#存储引擎磁盘临时表创建数"><span>存储引擎磁盘临时表创建数</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show global status like &#39;Created_tmp_disk_tables&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>存储引擎全表扫描比例</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>(Handler_read_rnd_next + Handler_read_rnd) / (Handler_read_rnd_next + Handler_read_rnd + Handler_read_first + Handler_read_next + Handler_read_k</span></span>
<span class="line"><span>ey + Handler_read_prev)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>存储引擎索引使用</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>(Handler_read_first + Handler_read_key + Handler_read_next + Handler_read_prev</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>show global status like &#39;Handler_read_first&#39;;</span></span>
<span class="line"><span>show global status like &#39;Handler_read_key&#39;;</span></span>
<span class="line"><span>show global status like &#39;Handler_read_next&#39;;</span></span>
<span class="line"><span>show global status like &#39;Handler_read_prev&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="存储引擎空余内存大小" tabindex="-1"><a class="header-anchor" href="#存储引擎空余内存大小"><span>存储引擎空余内存大小</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show global status like &#39;Innodb_buffer_pool_pages_free&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="存储引擎重做日志等待" tabindex="-1"><a class="header-anchor" href="#存储引擎重做日志等待"><span>存储引擎重做日志等待</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show global status like &#39;Innodb_log_waits&#39;;</span></span>
<span class="line"><span>show global status like &#39;Innodb_log_writes&#39;;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Innodb_log_waits/ Innodb_log_writes</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="存储引擎表锁等待比例" tabindex="-1"><a class="header-anchor" href="#存储引擎表锁等待比例"><span>存储引擎表锁等待比例</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>Table_locks_waited / (Table_locks_waited + Table_locks_immediate)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>show global status like &#39;Table_locks_waited&#39;;</span></span>
<span class="line"><span>show global status like &#39;Table_locks_immediate&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="存储引擎线程缓存" tabindex="-1"><a class="header-anchor" href="#存储引擎线程缓存"><span>存储引擎线程缓存</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show global status like &#39;threads_created&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="并发线程查询" tabindex="-1"><a class="header-anchor" href="#并发线程查询"><span>并发线程查询</span></a></h2><p>应小于 10，过大，说明并发数太多，存在慢语句</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show global status like &#39;threads_running%&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="慢查询日志开启" tabindex="-1"><a class="header-anchor" href="#慢查询日志开启"><span>慢查询日志开启</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show variables like &#39;%slow%&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="慢查询查询时间" tabindex="-1"><a class="header-anchor" href="#慢查询查询时间"><span>慢查询查询时间</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>show variables like &#39;long_query_time%&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h1 id="获取pdf和脚本" tabindex="-1"><a class="header-anchor" href="#获取pdf和脚本"><span>获取pdf和脚本</span></a></h1><p>关注公众号，关注公众号回复&quot;MySQL巡检&quot;</p><p><img src="https://imgoss.xgss.net/picgo/image-20241013172819225.png?aliyun" alt="image-20241013172819225"></p>`,132)]))}const c=e(l,[["render",d]]),o=JSON.parse('{"path":"/article/pbns4t40/","title":"MySQL数据库巡检报告模板","lang":"en-US","frontmatter":{"title":"MySQL数据库巡检报告模板","createTime":"2025/05/27 17:51:17","permalink":"/article/pbns4t40/"},"git":{"createdTime":1749111496000,"updatedTime":1750129445000,"contributors":[{"name":"star","username":"star","email":"star@xgss.net","commits":2,"url":"https://github.com/star"}]},"readingTime":{"minutes":5.34,"words":1602},"filePathRelative":"mysql/MySQL数据库巡检报告模板.md"}');export{c as comp,o as data};
