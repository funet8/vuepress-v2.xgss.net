import{_ as a}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as n,a as i,o as e}from"./app-BiQR_lPj.js";const l={};function p(r,s){return e(),n("div",null,s[0]||(s[0]=[i(`<h1 id="群晖nas配置之自有服务器frp实现内网穿透" tabindex="-1"><a class="header-anchor" href="#群晖nas配置之自有服务器frp实现内网穿透"><span>群晖NAS配置之自有服务器frp实现内网穿透</span></a></h1><h1 id="什么是frp" tabindex="-1"><a class="header-anchor" href="#什么是frp"><span>什么是frp</span></a></h1><p>frp 是一个专注于内网穿透的高性能的反向代理应用，支持 TCP、UDP、HTTP、HTTPS 等多种协议，且支持 P2P 通信。可以将内网服务以安全、便捷的方式通过具有公网 IP 节点的中转暴露到公网。今天跟大家分享一下frp实现内网穿透</p><p><img src="https://imgoss.xgss.net/picgo/frps-datu.png?aliyun" alt="frps-datu"></p><h1 id="为什么使用-frp" tabindex="-1"><a class="header-anchor" href="#为什么使用-frp"><span>为什么使用 frp ？</span></a></h1><p>通过在具有公网 IP 的节点上部署 frp 服务端，可以轻松地将内网服务穿透到公网，同时提供诸多专业的功能特性，这包括：</p><ol><li>客户端服务端通信支持 TCP、QUIC、KCP 以及 Websocket 等多种协议</li><li>采用 TCP 连接流式复用，在单个连接间承载更多请求，节省连接建立时间，降低请求延迟。</li><li>代理组间的负载均衡。</li><li>端口复用，多个服务通过同一个服务端端口暴露。</li><li>支持 P2P 通信，流量不经过服务器中转，充分利用带宽资源。</li><li>多个原生支持的客户端插件（静态文件查看，HTTPS/HTTP 协议转换，HTTP、SOCK5 代理等），便于独立使用 frp 客户端完成某些工作。</li><li>高度扩展性的服务端插件系统，易于结合自身需求进行功能扩展。</li><li>服务端和客户端 UI 页面。</li></ol><p>开源地址： https://github.com/fatedier/frp</p><p>FRP文档： https://gofrp.org</p><h1 id="安装frp" tabindex="-1"><a class="header-anchor" href="#安装frp"><span>安装frp</span></a></h1><h2 id="下载frp" tabindex="-1"><a class="header-anchor" href="#下载frp"><span>下载frp</span></a></h2><ol><li><p>前往 <a href="https://github.com/fatedier/frp/releases" target="_blank" rel="noopener noreferrer">frp GitHub发布页面</a>，找到最新版本。例如，假设最新版本是 <code>v0.52.3</code>。</p></li><li><p>下载适用于CentOS 7架构的frp服务器二进制文件。例如，对于64位架构，你可以使用：</p></li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>mkdir -p /data/</span></span>
<span class="line"><span>cd /data/</span></span>
<span class="line"><span>wget https://github.com/fatedier/frp/releases/download/v0.52.3/frp_0.52.3_linux_amd64.tar.gz</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>解压下载的文件：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>tar zxvf frp_0.52.3_linux_amd64.tar.gz </span></span>
<span class="line"><span>mv frp_0.52.3_linux_amd64 frp</span></span>
<span class="line"><span># ll</span></span>
<span class="line"><span>total 29996</span></span>
<span class="line"><span>-rwxr-xr-x 1 1001 127 13905920 Oct 24 10:56 frpc</span></span>
<span class="line"><span>-rw-r--r-- 1 1001 127      142 Oct 24 10:57 frpc.toml</span></span>
<span class="line"><span>-rwxr-xr-x 1 1001 127 16789504 Oct 24 10:56 frps</span></span>
<span class="line"><span>-rw-r--r-- 1 1001 127       16 Oct 24 10:57 frps.toml</span></span>
<span class="line"><span>-rw-r--r-- 1 1001 127    11358 Oct 24 10:57 LICENSE</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="配置frp服务器" tabindex="-1"><a class="header-anchor" href="#配置frp服务器"><span>配置frp服务器</span></a></h2><p>添加frp服务器的配置。以下是一个示例：</p><p>有关如何编写配置文件，请参考： https://gofrp.org/zh-cn/docs/examples/</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>vi frps.toml</span></span>
<span class="line"><span>bindPort = 7000</span></span>
<span class="line"><span>vhostHTTPPort = 80</span></span>
<span class="line"><span># auth.token = &quot;abcdef&quot; #安全验证不能有数字</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用以下命令启动服务器：./frps -c ./frps.toml</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>./frps -c ./frps.toml</span></span>
<span class="line"><span>2023/11/28 13:34:03 [I] [root.go:102] frps uses config file: ./frps.toml</span></span>
<span class="line"><span>2023/11/28 13:34:03 [I] [service.go:200] frps tcp listen on 0.0.0.0:7000</span></span>
<span class="line"><span>2023/11/28 13:34:03 [I] [root.go:111] frps started successfully</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="防火墙配置" tabindex="-1"><a class="header-anchor" href="#防火墙配置"><span>防火墙配置</span></a></h2><p>如果启用了防火墙，请打开必要的端口（默认是7000）：</p><p>HTTP 请求的监听端口为 80</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>sudo firewall-cmd --zone=public --add-port=7000/tcp --permanent</span></span>
<span class="line"><span>sudo firewall-cmd --reload</span></span>
<span class="line"><span>或者</span></span>
<span class="line"><span>iptables -A INPUT -p tcp --dport 7000 -j ACCEPT</span></span>
<span class="line"><span>service iptables save</span></span>
<span class="line"><span>systemctl restart iptables.service</span></span>
<span class="line"><span></span></span>
<span class="line"><span>iptables -A INPUT -p tcp --dport 80 -j ACCEPT</span></span>
<span class="line"><span>iptables -I INPUT -p tcp --match multiport --dports 6000:7000 -j ACCEPT #批量开放6000-7000的端口。</span></span>
<span class="line"><span>service iptables save</span></span>
<span class="line"><span>systemctl restart iptables</span></span>
<span class="line"><span></span></span>
<span class="line"><span>service iptables save</span></span>
<span class="line"><span>systemctl restart iptables</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="设置systemd服务-可选但建议" tabindex="-1"><a class="header-anchor" href="#设置systemd服务-可选但建议"><span>设置systemd服务（可选但建议）</span></a></h2><p>创建一个frp的systemd服务文件：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>vi /etc/systemd/system/frps.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>添加以下内容：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>[Unit]</span></span>
<span class="line"><span>Description=frp服务器</span></span>
<span class="line"><span>After=network.target</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[Service]</span></span>
<span class="line"><span>Type=simple</span></span>
<span class="line"><span>ExecStart=/data/frp/frps -c /data/frp/frps.toml</span></span>
<span class="line"><span>Restart=on-failure</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[Install]</span></span>
<span class="line"><span>WantedBy=multi-user.target</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启用并启动frp服务：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>systemctl enable frps</span></span>
<span class="line"><span>systemctl start frps</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>验证服务是否启动</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>systemctl restart frps</span></span>
<span class="line"><span># netstat -tunpl|grep 7000</span></span>
<span class="line"><span>tcp6       0      0 :::7000                 :::*                    LISTEN      19949/frps</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="群晖nas客户端配置frp" tabindex="-1"><a class="header-anchor" href="#群晖nas客户端配置frp"><span>群晖nas客户端配置frp</span></a></h2><h3 id="下载frp客户端" tabindex="-1"><a class="header-anchor" href="#下载frp客户端"><span>下载frp客户端</span></a></h3><p>用ssh连接登录群晖，</p><p>下载适用于群晖架构的frp客户端</p><p>前往 frp GitHub发布页面，找到适用于群晖的版本。确保下载与群晖架构相匹配的frp客户端。</p><p>下载frp客户端。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>cd /root</span></span>
<span class="line"><span>wget https://github.com/fatedier/frp/releases/download/v0.52.3/frp_0.52.3_linux_amd64.tar.gz</span></span>
<span class="line"><span>tar -zxvf frp_0.52.3_linux_amd64.tar.gz </span></span>
<span class="line"><span>mv frp_0.52.3_linux_amd64 frp</span></span>
<span class="line"><span>cd /root/frp</span></span>
<span class="line"><span>ls</span></span>
<span class="line"><span>frpc  frpc.toml  frps  frps.toml  LICENSE</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="配置frp客户端" tabindex="-1"><a class="header-anchor" href="#配置frp客户端"><span>配置frp客户端</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>vi frpc.toml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>[common]</span></span>
<span class="line"><span>serverAddr = &quot;127.0.0.1&quot;</span></span>
<span class="line"><span>serverPort = 7000</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[[proxies]]</span></span>
<span class="line"><span>name = &quot;stars-nas-ssh&quot;</span></span>
<span class="line"><span>type = &quot;tcp&quot;</span></span>
<span class="line"><span>localIP = &quot;127.0.0.1&quot;</span></span>
<span class="line"><span>localPort = 22</span></span>
<span class="line"><span>remotePort = 6000</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>将 serverAddr 替换为frp服务器的IP地址</p><p>确保 token 与frp服务器上配置的token匹配。</p><p>根据需要配置其他端口转发规则，上述示例是将本地的SSH服务（本地端口22）映射到远程端口6000。</p><h3 id="运行frp客户端" tabindex="-1"><a class="header-anchor" href="#运行frp客户端"><span>运行frp客户端</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span># /root/frp/frpc -c /root/frp/frpc.toml</span></span>
<span class="line"><span>2023/11/28 13:58:38 [I] [root.go:139] start frpc service for config file [/root/frp/frpc.toml]</span></span>
<span class="line"><span>2023/11/28 13:58:38 [I] [service.go:299] [c22cfeca075e01e1] login to server success, get run id [c22cfeca075e01e1]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>如果需要后台运行，可以使用类似 nohup ./frpc -c frpc.ini &amp; 这样的命令。</span></span>
<span class="line"><span></span></span>
<span class="line"><span>nohup /root/frp/frpc -c /root/frp/frpc.toml &gt;/dev/null 2&gt;&amp;1 &amp;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>ssh -o Port=6000 user@{frp服务器ip}</span></span>
<span class="line"><span>Synology strongly advises you not to run commands as the root user, who has</span></span>
<span class="line"><span>the highest privileges on the system. Doing so may cause major damages</span></span>
<span class="line"><span>to the system. Please note that if you choose to proceed, all consequences are</span></span>
<span class="line"><span>at your own risk.</span></span>
<span class="line"><span>user@star-nas:~$</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>至此可以远程登录ssh</p><h2 id="域名解析" tabindex="-1"><a class="header-anchor" href="#域名解析"><span>域名解析</span></a></h2><p><img src="https://imgoss.xgss.net/picgo/image-20231128155546735.png?aliyun" alt="image-20231128155546735"></p><h2 id="开放web和ssh" tabindex="-1"><a class="header-anchor" href="#开放web和ssh"><span>开放web和ssh</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>vi /root/frp/frpc.toml</span></span>
<span class="line"><span>serverAddr = &quot;xx.xx.xx.xx&quot;</span></span>
<span class="line"><span>serverPort = 7000</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[[proxies]]</span></span>
<span class="line"><span>name = &quot;stars-nas-ssh&quot;</span></span>
<span class="line"><span>type = &quot;tcp&quot;</span></span>
<span class="line"><span>localIP = &quot;127.0.0.1&quot;</span></span>
<span class="line"><span>localPort = 60920</span></span>
<span class="line"><span>remotePort = 6000</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[[proxies]]</span></span>
<span class="line"><span>name = &quot;web&quot;</span></span>
<span class="line"><span>type = &quot;http&quot;</span></span>
<span class="line"><span>localPort = 80</span></span>
<span class="line"><span>customDomains = [&quot;nasweb.frp.xgss.net&quot;]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[[proxies]]</span></span>
<span class="line"><span>name = &quot;web2&quot;</span></span>
<span class="line"><span>type = &quot;http&quot;</span></span>
<span class="line"><span>localPort = 5000</span></span>
<span class="line"><span>customDomains = [&quot;nas.frp.xgss.net&quot;]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="检查" tabindex="-1"><a class="header-anchor" href="#检查"><span>检查</span></a></h2><p><img src="https://imgoss.xgss.net/picgo/image-20231128161122393.png?aliyun" alt="image-20231128161122393"></p><p><img src="https://imgoss.xgss.net/picgo/image-20231128161137610.png?aliyun" alt="image-20231128161137610"></p><p>内网穿透成功。</p><p>如果你 vhostHTTPPort = 8080 则这里访问的域名需要加端口：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>nasweb.frp.xgss.net:8080</span></span>
<span class="line"><span>nas.frp.xgss.net:80</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="windows客户端" tabindex="-1"><a class="header-anchor" href="#windows客户端"><span>windows客户端</span></a></h2><h3 id="下载windows客户端" tabindex="-1"><a class="header-anchor" href="#下载windows客户端"><span>下载Windows客户端</span></a></h3><p>前往 <a href="https://github.com/fatedier/frp/releases" target="_blank" rel="noopener noreferrer">frp GitHub发布页面</a>，找到最新版本</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>https://github.com/fatedier/frp/releases/download/v0.52.3/frp_0.52.3_windows_amd64.zip</span></span>
<span class="line"><span>或者</span></span>
<span class="line"><span>http://js.funet8.com/centos_software/frp/frp_0.52.3_windows_amd64.zip</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>下载解压到桌面位置</p><p><img src="https://imgoss.xgss.net/picgo/image-20231128162736001.png?aliyun" alt="image-20231128162736001"></p><h3 id="编辑frpc-toml配置文件" tabindex="-1"><a class="header-anchor" href="#编辑frpc-toml配置文件"><span>编辑frpc.toml配置文件</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>serverAddr = &quot;x.x.x.x&quot;</span></span>
<span class="line"><span>serverPort = 7000</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[[proxies]]</span></span>
<span class="line"><span>name = &quot;test-tcp&quot;</span></span>
<span class="line"><span>type = &quot;tcp&quot;</span></span>
<span class="line"><span>localIP = &quot;127.0.0.1&quot;</span></span>
<span class="line"><span>localPort = 3389</span></span>
<span class="line"><span>remotePort = 6002</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="编写start-bat-并运行" tabindex="-1"><a class="header-anchor" href="#编写start-bat-并运行"><span>编写start.bat，并运行</span></a></h3><p>用记事本编辑，再用管理员身份运行。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>@echo off</span></span>
<span class="line"><span>cd /d C:\\Users\\Administrator\\Desktop\\frp</span></span>
<span class="line"><span>frpc.exe -c frpc.toml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://imgoss.xgss.net/picgo/image-20231128162931360.png?aliyun" alt="image-20231128162931360"></p><p><img src="https://imgoss.xgss.net/picgo/image-20231128163008961.png?aliyun" alt="image-20231128163008961"></p><p>测试远程登录。</p><p><img src="https://imgoss.xgss.net/picgo/image-20231128162620137.png?aliyun" alt="image-20231128162620137"></p><h1 id="设置开机启动" tabindex="-1"><a class="header-anchor" href="#设置开机启动"><span>设置开机启动</span></a></h1><h2 id="开机启动方法1" tabindex="-1"><a class="header-anchor" href="#开机启动方法1"><span>开机启动方法1</span></a></h2><p>此设置需要用户登录才可以运行脚本</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>在 Windows 10 中可以通过以下步骤来设置 bat 文件开机自动运行：</span></span>
<span class="line"><span></span></span>
<span class="line"><span>1、打开“运行”对话框，按 Win + R 键。</span></span>
<span class="line"><span></span></span>
<span class="line"><span>2、输入 shell:startup</span></span>
<span class="line"><span></span></span>
<span class="line"><span>3、在“启动”文件夹中创建一个快捷方式，指向要运行的 bat 文件。</span></span>
<span class="line"><span></span></span>
<span class="line"><span>4、重启电脑，bat 文件就会在系统启动时自动运行。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>bat批处理脚本解决Windows10开机后桌面频繁启动:https://blog.csdn.net/FisrtBqy/article/details/130077994</p><h2 id="开机启动方法2" tabindex="-1"><a class="header-anchor" href="#开机启动方法2"><span>开机启动方法2</span></a></h2><p>设置开机启动</p><p>右击此电脑→管理→任务计划程序→右侧的“创建任务”</p><p><img src="https://imgoss.xgss.net/picgo/image-20240702111819150.png?aliyun" alt="image-20240702111819150"></p><h3 id="常规" tabindex="-1"><a class="header-anchor" href="#常规"><span>常规</span></a></h3><p><img src="https://imgoss.xgss.net/picgo/image-20240702111906733.png?aliyun" alt="image-20240702111906733"></p><h3 id="触发器" tabindex="-1"><a class="header-anchor" href="#触发器"><span>触发器</span></a></h3><p>开始任务选择启动时。</p><p><img src="https://imgoss.xgss.net/picgo/image-20240702111958454.png?aliyun" alt="image-20240702111958454"></p><h3 id="操作" tabindex="-1"><a class="header-anchor" href="#操作"><span>操作</span></a></h3><p>选择启动frp的脚本。</p><p><img src="https://imgoss.xgss.net/picgo/image-20240702112045284.png?aliyun" alt="image-20240702112045284"></p><p>重启测试是否能开机启动。</p><h1 id="配置校验" tabindex="-1"><a class="header-anchor" href="#配置校验"><span>配置校验</span></a></h1><p>通过执行 frpc verify -c ./frpc.toml 或 frps verify -c ./frps.toml 可以对配置文件中的参数进行预先校验。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>./frps verify -c ./frps.toml </span></span>
<span class="line"><span>frpc: the configuration file ./frpc.toml syntax is ok</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>如果出现此结果，则说明新的配置文件没有错误，否则会输出具体的错误信息。</p><h1 id="配置拆分" tabindex="-1"><a class="header-anchor" href="#配置拆分"><span>配置拆分</span></a></h1><p>通过 <code>includes</code> 参数可以在主配置中包含其他配置文件，从而实现将代理配置拆分到多个文件中管理。</p><div class="language-toml line-numbers-mode" data-highlighter="shiki" data-ext="toml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-toml"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># frpc.toml</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">serverAddr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;x.x.x.x&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">serverPort</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">7000</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">includes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = [</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;./confd/*.toml&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ./confd/test.toml</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[[</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">proxies</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ssh&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;tcp&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">localIP</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;127.0.0.1&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">localPort</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">22</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">remotePort</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">6000</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上述配置在 frpc.toml 中通过 includes 额外包含了 <code>./confd</code> 目录下所有的 toml 文件的代理配置内容，效果等价于将这两个文件合并成一个文件。</p><p>需要注意的是 includes 指定的文件中只能包含代理配置，通用参数的配置只能放在主配置文件中。</p><h1 id="安全认证token" tabindex="-1"><a class="header-anchor" href="#安全认证token"><span>安全认证Token</span></a></h1><p>Token 身份认证是一种简单的身份认证方式，只需要在 frp 的客户端 frpc 和服务端 frps 配置文件中配置相同的 token 即可。</p><h2 id="配置示例" tabindex="-1"><a class="header-anchor" href="#配置示例"><span>配置示例</span></a></h2><div class="language-toml line-numbers-mode" data-highlighter="shiki" data-ext="toml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-toml"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># frps.toml</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bindPort</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">7000</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">auth.token</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;abc&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># frpc.toml</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">auth.token</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;abc&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="配置https" tabindex="-1"><a class="header-anchor" href="#配置https"><span>配置HTTPS</span></a></h1><p>文档： https://gofrp.org/zh-cn/docs/examples/https2http/</p><p>使用 https2http 插件将本地 HTTP 服务转换为 HTTPS 服务，以供外部访问。</p><h2 id="配置-frps-toml" tabindex="-1"><a class="header-anchor" href="#配置-frps-toml"><span>配置 frps.toml</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>bindPort = 7000</span></span>
<span class="line"><span>vhostHTTPSPort = 443</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="配置-frpc-toml" tabindex="-1"><a class="header-anchor" href="#配置-frpc-toml"><span>配置 frpc.toml</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>serverAddr = &quot;x.x.x.x&quot;</span></span>
<span class="line"><span>serverPort = 7000</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[[proxies]]</span></span>
<span class="line"><span>name = &quot;test_htts2http&quot;</span></span>
<span class="line"><span>type = &quot;https&quot;</span></span>
<span class="line"><span>customDomains = [&quot;test.yourdomain.com&quot;]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[proxies.plugin]</span></span>
<span class="line"><span>type = &quot;https2http&quot;</span></span>
<span class="line"><span>localAddr = &quot;127.0.0.1:80&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span># HTTPS 证书相关的配置</span></span>
<span class="line"><span>crtPath = &quot;./server.crt&quot;</span></span>
<span class="line"><span>keyPath = &quot;./server.key&quot;</span></span>
<span class="line"><span>hostHeaderRewrite = &quot;127.0.0.1&quot;</span></span>
<span class="line"><span>requestHeaders.set.x-from-where = &quot;frp&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="获取https证书" tabindex="-1"><a class="header-anchor" href="#获取https证书"><span>获取HTTPS证书</span></a></h2><h2 id="访问-https-服务" tabindex="-1"><a class="header-anchor" href="#访问-https-服务"><span>访问 HTTPS 服务</span></a></h2><p>打开您的 Web 浏览器，访问域名</p><h1 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h1><p>ngrok和frp的各有优缺点</p><h2 id="ngrok-的优点" tabindex="-1"><a class="header-anchor" href="#ngrok-的优点"><span>ngrok 的优点</span></a></h2><p>简单易用：ngrok拥有非常简洁的用户界面和易于使用的命令行工具，使得内网穿透变得非常容易。</p><p>快速搭建：你不需要拥有自己的服务器，只需下载ngrok客户端即可开始使用。</p><p>跨平台支持：ngrok支持多种操作系统，包括Windows、Linux和macOS等。</p><p>具备安全特性：ngrok提供了基本的身份验证和TLS加密传输等安全特性。</p><h2 id="ngrok-的缺点" tabindex="-1"><a class="header-anchor" href="#ngrok-的缺点"><span>ngrok 的缺点</span></a></h2><p>限制版和付费版：ngrok提供了免费版，但其功能有限，如并发连接数和隧道数量的限制。付费版则提供更多高级功能。</p><p>不开源：ngrok的源代码并未公开，因此在安全性方面用户难以进行审查。</p><h2 id="frp优点" tabindex="-1"><a class="header-anchor" href="#frp优点"><span>frp优点：</span></a></h2><p>开源免费：frp是开源软件，可以免费使用，且有活跃的社区支持。 配置灵活：frp提供了灵活的配置选项，允许用户进行端口映射、TCP/UDP转发等。 自托管：你可以轻松地在自己的服务器上自行搭建和管理frp服务。 支持多种代理类型：包括TCP、HTTP和UDP等多种类型的代理。</p><h2 id="frp缺点" tabindex="-1"><a class="header-anchor" href="#frp缺点"><span>frp缺点：</span></a></h2><p>配置相对复杂：对于新手来说，frp的配置可能相对复杂，需要一定的学习和理解。 需要自行搭建服务器：使用frp需要自己拥有服务器，并进行相应的部署和维护。</p>`,132)]))}const c=a(l,[["render",p]]),h=JSON.parse('{"path":"/article/2z491qtl/","title":"群晖NAS配置之自有服务器frp实现内网穿透","lang":"en-US","frontmatter":{"title":"群晖NAS配置之自有服务器frp实现内网穿透","createTime":"2025/05/27 17:51:17","permalink":"/article/2z491qtl/"},"git":{"createdTime":1749111496000,"updatedTime":1750129445000,"contributors":[{"name":"star","username":"star","email":"star@xgss.net","commits":2,"url":"https://github.com/star"}]},"readingTime":{"minutes":8.01,"words":2403},"filePathRelative":"NAS/群晖NAS配置之自有服务器frp实现内网穿透.md"}');export{c as comp,h as data};
