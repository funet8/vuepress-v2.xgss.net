import{_ as a}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as e,a as i,o as n}from"./app-BiQR_lPj.js";const l={};function p(t,s){return n(),e("div",null,s[0]||(s[0]=[i(`<h1 id="linux服务器局域网通过一台iptables计算机桥接上网" tabindex="-1"><a class="header-anchor" href="#linux服务器局域网通过一台iptables计算机桥接上网"><span>linux服务器局域网通过一台iptables计算机桥接上网</span></a></h1><h2 id="需求实现" tabindex="-1"><a class="header-anchor" href="#需求实现"><span>需求实现</span></a></h2><p>最近上了两天mysql服务器，没有分配公网ip，所以无法访问公网的一些资源。但是里面有些服务需要公网才能实现。</p><p>这是需求：其实功能使用iptables来实现SNAT转发，可以让无公网IP的服务器与公网通信</p><p>服务器A，双网卡</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>系统： centos</span></span>
<span class="line"><span>IP:192.168.20.178</span></span>
<span class="line"><span>IP2:XX.XX.XX.XXX</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>服务器B，单网卡</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>IP:192.168.20.200</span></span>
<span class="line"><span></span></span>
<span class="line"><span>要实现B通过A上公网</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="在a上操作" tabindex="-1"><a class="header-anchor" href="#在a上操作"><span>在A上操作</span></a></h2><h3 id="_1-开启其转发功能" tabindex="-1"><a class="header-anchor" href="#_1-开启其转发功能"><span>1.开启其转发功能</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span># vi /etc/sysctl.conf</span></span>
<span class="line"><span>开启转发</span></span>
<span class="line"><span>net.ipv4.ip_forward=1</span></span>
<span class="line"><span># echo 1 &gt; /proc/sys/net/ipv4/ip_forward</span></span>
<span class="line"><span>#sysctl -p（使之立即生效）</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-对iptables进行规制的设置" tabindex="-1"><a class="header-anchor" href="#_2-对iptables进行规制的设置"><span>2.对iptables进行规制的设置</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>iptables -F     #清除掉之前所有的iptables规则（生产环境谨慎使用）</span></span>
<span class="line"><span>iptables -P INPUT ACCEPT        #允许接收数据包</span></span>
<span class="line"><span>iptables -P FORWARD ACCEPT      #允许发送数据包</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>iptables -t nat -A POSTROUTING -s 192.168.20.0/24 -o em1 -j MASQUERADE      #在有外部IP的网口上做NAT</span></span>
<span class="line"><span>service iptables save</span></span>
<span class="line"><span>service iptables restart</span></span>
<span class="line"><span>service iptables status</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-重启网络" tabindex="-1"><a class="header-anchor" href="#_3-重启网络"><span>3.重启网络</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>/etc/init.d/network restart</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="在服务器b上操作" tabindex="-1"><a class="header-anchor" href="#在服务器b上操作"><span>在服务器B上操作</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span># vi /etc/sysconfig/network-scripts/ifcfg-em2</span></span>
<span class="line"><span>修改：</span></span>
<span class="line"><span>GATEWAY=192.168.20.178</span></span>
<span class="line"><span>DNS1=114.114.114.114</span></span>
<span class="line"><span>重启网络：</span></span>
<span class="line"><span># service network restart</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>再ping www.baidu.com 看能否ping通</p><h2 id="走过的坑" tabindex="-1"><a class="header-anchor" href="#走过的坑"><span>走过的坑</span></a></h2><p>1.在执行第二步“对iptables进行规制的设置”设置的时候，由于原服务器有iptables的规则，不能直接iptables -F 就在/etc/sysconfig/iptables 跟本地对照记录。 删除了“-A FORWARD -j REJECT --reject-with icmp-host-prohibited ”这条记录，而找到原因的时候是在本地搭建好了， 先在本地的虚拟机实现了该功能，同样的iptables记录可以</p><p>2.B服务器还要配置一个DNS</p><p>参考： https://blog.csdn.net/hbhswxy2007/article/details/48462959 https://blog.csdn.net/hiccupzhu/article/details/51073557</p>`,23)]))}const c=a(l,[["render",p]]),h=JSON.parse('{"path":"/article/twlgwye5/","title":"使用iptables来实现SNAT转发，可以让无公网IP的服务器与公网通信","lang":"en-US","frontmatter":{"title":"使用iptables来实现SNAT转发，可以让无公网IP的服务器与公网通信","createTime":"2025/05/27 17:51:17","permalink":"/article/twlgwye5/"},"git":{"createdTime":1749111496000,"updatedTime":1750129445000,"contributors":[{"name":"star","username":"star","email":"star@xgss.net","commits":2,"url":"https://github.com/star"}]},"readingTime":{"minutes":1.49,"words":447},"filePathRelative":"linux-basis/使用iptables来实现SNAT转发，可以让无公网IP的服务器与公网通信.md"}');export{c as comp,h as data};
