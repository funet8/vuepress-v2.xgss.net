# CI/CD流水线：Jenkins/GitLab CI 自动化构建与部署

## 一、前言

在现代软件开发中，**持续集成（CI）**与**持续交付/部署（CD）**已成为团队高效协作的核心。通过自动化流水线，开发者可以快速验证代码质量、缩短交付周期，并降低人为操作带来的风险。本文将结合 **Jenkins** 与 **GitLab CI** 两种常见工具，探讨如何构建一套实用的 CI/CD 流水线。

------

## 二、CI/CD核心概念

- **CI（Continuous Integration）**  
   每次代码提交后自动构建、测试，确保主干分支始终保持可用。
- **CD（Continuous Delivery/Deployment）**  
   将构建产物自动部署到测试或生产环境，实现快速迭代。

流水线的目标：

1. **自动化**：减少人工干预
2. **可重复**：统一流程，避免环境差异
3. **可追踪**：日志与版本可溯源

------

## 三、工具对比：Jenkins vs GitLab CI

| 特性     | Jenkins                       | GitLab CI                        |
| -------- | ----------------------------- | -------------------------------- |
| 部署方式 | 独立服务，需安装与维护        | GitLab 内置，开箱即用            |
| 配置方式 | 使用 `Jenkinsfile` 或 UI 配置 | 使用 `.gitlab-ci.yml`            |
| 插件生态 | 丰富插件，灵活扩展            | 与 GitLab 紧密集成，生态相对集中 |
| 使用场景 | 适合多语言、多平台复杂流水线  | 适合 GitLab 项目一体化管理       |
| 学习成本 | 较高，需要运维经验            | 较低，配置文件即声明式流水线     |

------

## 四、Jenkins流水线实践

### 1. 安装与配置

- 安装 Jenkins 服务（Docker 或 systemd 管理）
- 安装常用插件：Git、Pipeline、Credentials、Blue Ocean
- 配置凭证（SSH Key 或 Token）

### 2. Jenkinsfile 示例

```groovy
pipeline {
    agent any
    stages {
        stage('Checkout') {
            steps {
                git branch: 'main', url: 'git@github.com:repo/project.git'
            }
        }
        stage('Build') {
            steps {
                sh 'npm install && npm run build'
            }
        }
        stage('Test') {
            steps {
                sh 'npm test'
            }
        }
        stage('Deploy') {
            steps {
                sh './scripts/deploy.sh'
            }
        }
    }
}
```

------

## 五、GitLab CI 流水线实践

### 1. 配置 Runner

- 安装 GitLab Runner（支持 Docker、Shell、Kubernetes）
- 注册 Runner 并绑定到项目

### 2. `.gitlab-ci.yml` 示例

```yaml
stages:
  - build
  - test
  - deploy

build:
  stage: build
  script:
    - npm install
    - npm run build

test:
  stage: test
  script:
    - npm test

deploy:
  stage: deploy
  script:
    - ./scripts/deploy.sh
  only:
    - main
```

------

## 六、最佳实践清单

- **统一环境**：使用 Docker 镜像保证构建环境一致性
- **分阶段执行**：构建、测试、部署分离，便于排错
- **日志持久化**：构建日志保存到外部存储，便于审计
- **自动化回滚**：部署失败时快速恢复到上一个版本
- **安全管理**：凭证统一管理，避免硬编码在脚本中

------

## 七、结语

CI/CD 流水线不仅是工具的堆叠，更是团队工程文化的体现。Jenkins 提供了高度灵活的插件生态，而 GitLab CI 则强调与代码仓库的无缝集成。选择哪种工具，取决于团队规模、项目复杂度与现有生态。关键在于：**让自动化成为习惯，让交付更快、更稳、更可控。**

