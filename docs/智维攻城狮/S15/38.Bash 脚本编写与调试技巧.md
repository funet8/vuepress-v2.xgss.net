# Shell脚本基础：Bash 脚本编写与调试技巧

在日常运维与开发工作中，Shell脚本是不可或缺的工具。它不仅能快速完成批量任务，还能将复杂的操作流程封装为一键执行的脚本。本文将系统梳理 **Bash 脚本编写与调试技巧**，帮助你从基础到进阶，提升脚本质量与可维护性。

------

## 📝 一、Bash脚本基础语法

### 1. 脚本结构

```bash
#!/bin/bash
# 脚本说明：示例脚本
echo "Hello, World!"
```

- `#!/bin/bash`：指定解释器
- `#`：注释
- `echo`：输出内容

### 2. 变量与参数

```bash
name="StarGe"
echo "Hello $name"

echo "第一个参数: $1"
echo "参数总数: $#"
```

- 普通变量：`name="value"`
- 脚本参数：`$1`、`$#`、`$@`

### 3. 条件与循环

```bash
if [ -f "/etc/passwd" ]; then
  echo "文件存在"
else
  echo "文件不存在"
fi

for i in {1..5}; do
  echo "循环 $i"
done
```

------

## 🔧 二、常用编写技巧

- **使用函数封装逻辑**

```bash
backup() {
  cp "$1" "$1.bak"
  echo "已备份 $1"
}
backup /etc/hosts
```

- **严格模式提高健壮性**

```bash
set -euo pipefail
```

- `-e`：遇到错误立即退出
- `-u`：使用未定义变量时报错
- `-o pipefail`：管道中任一命令失败则整体失败
- **使用数组与字典**

```bash
arr=(a b c)
echo ${arr[1]}   # 输出 b

declare -A dict
dict["name"]="StarGe"
echo ${dict["name"]}
```

------

## 🐞 三、调试技巧

### 1. 基础调试

- `bash -x script.sh`：逐行打印执行过程
- `set -x` / `set +x`：在脚本中开启/关闭调试

### 2. 错误捕获

```bash
trap 'echo "脚本出错，行号：$LINENO"' ERR
```

### 3. 日志输出

```bash
log() {
  echo "$(date '+%F %T') - $*"
}
log "开始执行任务"
```

------

## 📌 四、最佳实践清单

- ✅ 使用 **严格模式** 保证脚本健壮性
- ✅ 将 **重复逻辑封装为函数**
- ✅ 使用 **日志与调试模式** 便于排查问题
- ✅ 保持脚本 **结构化与可读性**
- ✅ 在复杂场景中，优先考虑 **配置化与模块化**

------

## 🎯 总结

Bash脚本是运维与开发的“瑞士军刀”。掌握基础语法只是第一步，更重要的是养成 **结构化编写、严格模式、调试与日志** 的习惯。这样不仅能提升效率，还能让脚本在团队协作与长期维护中更具价值。