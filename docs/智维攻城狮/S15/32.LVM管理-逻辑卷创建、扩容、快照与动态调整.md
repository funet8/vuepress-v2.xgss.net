# LVM管理：逻辑卷创建、扩容、快照与动态调整

Linux Logical Volume Manager（LVM）是一种灵活的存储管理机制，它突破了传统分区的限制，支持逻辑卷的动态调整、快照创建和在线扩容。本文将从基础到实战，梳理 LVM 的核心操作与应用场景。

------

## 一、LVM核心概念

- **PV（Physical Volume）物理卷**：由磁盘或分区初始化而成，是 LVM 的最底层。
- **VG（Volume Group）卷组**：由一个或多个 PV 组成的存储池。
- **LV（Logical Volume）逻辑卷**：从 VG 中划分出的逻辑存储单元，类似传统分区，可挂载文件系统。
- **PE（Physical Extent）物理扩展块**：VG 的最小分配单位，通常为 4MB。

------

## 二、逻辑卷创建流程

### 1. 初始化物理卷

```bash
pvcreate /dev/sdb /dev/sdc
```

### 2. 创建卷组

```bash
vgcreate vg_data /dev/sdb /dev/sdc
```

### 3. 创建逻辑卷

```bash
lvcreate -L 20G -n lv_app vg_data
```

### 4. 格式化并挂载

```bash
mkfs.ext4 /dev/vg_data/lv_app
mkdir /data
mount /dev/vg_data/lv_app /data
```

> **对照清单**：PV → VG → LV → 格式化 → 挂载

------

## 三、逻辑卷扩容

### 1. 在线扩容逻辑卷

```bash
lvextend -L +10G /dev/vg_data/lv_app
```

### 2. 扩展文件系统

- **ext4 文件系统**

```bash
resize2fs /dev/vg_data/lv_app
```

- **xfs 文件系统**

```bash
xfs_growfs /data
```

> **注意**：XFS 仅支持扩容，不支持缩容。

------

## 四、逻辑卷快照

快照（Snapshot）用于数据保护和快速回滚，常见于备份场景。

### 1. 创建快照

```bash
lvcreate -L 5G -s -n lv_app_snap /dev/vg_data/lv_app
```

### 2. 挂载快照

```bash
mount /dev/vg_data/lv_app_snap /mnt/snap
```

### 3. 删除快照

```bash
umount /mnt/snap
lvremove /dev/vg_data/lv_app_snap
```

> **最佳实践**：快照大小建议 ≥ 原卷 20%，避免写入过多导致快照失效。

------

## 五、动态调整与维护

- **查看卷组与逻辑卷信息**

```bash
vgdisplay
lvdisplay
```

- **添加新磁盘并扩展卷组**

```bash
pvcreate /dev/sdd
vgextend vg_data /dev/sdd
```

- **缩小逻辑卷（需谨慎）**

```bash
umount /data
e2fsck -f /dev/vg_data/lv_app
resize2fs /dev/vg_data/lv_app 15G
lvreduce -L 15G /dev/vg_data/lv_app
mount /dev/vg_data/lv_app /data
```

------

## 六、应用场景与最佳实践

- **数据库存储**：通过快照实现一致性备份。
- **虚拟化环境**：动态扩容逻辑卷，避免停机。
- **文件服务器**：卷组池化管理，灵活分配存储。

**建议**：

1. 生产环境中，快照仅用于短期备份。
2. 定期监控 VG 空间，避免 PE 耗尽。
3. 对关键数据，扩容/缩容前务必做好备份。

------

## 七、总结

LVM 提供了比传统分区更灵活的存储管理方式：

- **逻辑卷创建**：快速构建存储空间
- **扩容**：支持在线动态调整
- **快照**：保障数据安全与备份效率
- **动态调整**：适应业务增长与硬件扩展

通过合理使用 LVM，运维人员可以在保证数据安全的前提下，实现高效、灵活的存储管理。