# 网络自动化：Ansible/Netmiko 网络设备批量配置与管理

## 一、引言

在传统网络运维中，工程师需要逐台登录交换机、路由器进行配置与排错。这种方式不仅效率低下，还容易因手工操作导致配置不一致。随着网络规模的扩大，**网络自动化**成为必然趋势。
 本文将聚焦两种常见工具：**Ansible** 与 **Netmiko**，探讨如何实现网络设备的批量配置与管理。

------

## 二、核心工具简介

### 1. Ansible

- **定位**：无代理（Agentless）的自动化运维工具

- 优势

  ：

  - 使用 YAML 编写 Playbook，易读易维护
  - 支持大规模设备并行操作
  - 丰富的模块库（包括网络设备模块）

### 2. Netmiko

- **定位**：基于 Python 的网络设备 SSH 自动化库

- 优势

  ：

  - 封装 Paramiko，简化 SSH 交互
  - 支持 Cisco、Huawei、Juniper 等主流厂商设备
  - 适合快速脚本化与定制化场景

------

## 三、应用场景对比

| 场景            | Ansible 适用          | Netmiko 适用      |
| --------------- | --------------------- | ----------------- |
| 大规模批量配置  | ✅                     | ⚠️（需自行写循环） |
| 配置一致性检查  | ✅                     | ⚠️                 |
| 临时性脚本/调试 | ⚠️                     | ✅                 |
| 与CI/CD集成     | ✅                     | ⚠️                 |
| 学习成本        | 中等（YAML/Playbook） | 低（Python脚本）  |

------

## 四、实战案例

### 1. 使用 Ansible 批量下发配置

**目录结构示例：**

```
inventory/
  hosts.ini
playbooks/
  config.yml
```

**hosts.ini：**

```ini
[routers]
R1 ansible_host=192.168.1.1 ansible_user=admin ansible_password=123456
R2 ansible_host=192.168.1.2 ansible_user=admin ansible_password=123456
```

**config.yml：**

```yaml
- name: 批量配置路由器
  hosts: routers
  gather_facts: no
  tasks:
    - name: 下发接口描述
      ios_config:
        lines:
          - description Configured by Ansible
        parents: interface GigabitEthernet0/0
```

执行命令：

```bash
ansible-playbook -i inventory/hosts.ini playbooks/config.yml
```

------

### 2. 使用 Netmiko 脚本化配置

**Python 示例：**

```python
from netmiko import ConnectHandler

devices = [
    {"device_type": "cisco_ios", "ip": "192.168.1.1", "username": "admin", "password": "123456"},
    {"device_type": "cisco_ios", "ip": "192.168.1.2", "username": "admin", "password": "123456"},
]

commands = ["interface GigabitEthernet0/0", "description Configured by Netmiko"]

for device in devices:
    with ConnectHandler(**device) as conn:
        output = conn.send_config_set(commands)
        print(f"{device['ip']} 配置结果:\n{output}")
```

------

## 五、最佳实践与优化建议

- **配置分层**：将公共配置与差异化配置分离，避免重复。
- **版本控制**：结合 Git 管理 Playbook 与脚本，确保可追溯性。
- **安全性**：避免明文密码，推荐使用 Ansible Vault 或环境变量。
- **测试环境**：先在实验室设备验证，再推送到生产网络。
- **混合使用**：大规模场景用 Ansible，临时调试用 Netmiko，优势互补。

------

## 六、结语

网络自动化并非“一刀切”，而是根据场景选择合适的工具。

- **Ansible**：适合标准化、批量化、可扩展的网络管理。
- **Netmiko**：适合灵活、快速、定制化的脚本操作。

通过合理结合两者，网络工程师可以大幅提升效率，减少人为错误，实现真正的“自动化运维”。

