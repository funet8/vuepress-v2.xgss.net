# Helm：K8s 包管理工具 Helm 的使用

## 一、为什么需要 Helm

在 Kubernetes 中，部署一个应用往往需要维护多个 YAML 文件（Deployment、Service、Ingress、ConfigMap 等）。随着微服务数量增加，手动管理这些文件不仅繁琐，还容易出错。**Helm 的出现解决了以下痛点**：

- **统一管理**：将应用相关的所有资源打包为一个 Chart。
- **高效复用**：同一套模板可应用于不同环境（开发、测试、生产）。
- **版本控制**：支持应用的升级与回滚。
- **简化部署**：一条命令即可完成复杂应用的安装。

## 二、Helm 核心概念

- **Chart**：Helm 包，包含应用所需的镜像、依赖和资源定义，类似于 apt 的 deb 包。
- **Repository**：存储 Chart 的仓库，可公有或私有。
- **Release**：Chart 在 Kubernetes 集群中的运行实例，一个 Chart 可以部署多次。

## 三、安装与配置

1. 安装 Helm

   ```bash
   curl -fsSL https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
   helm version
   ```

2. 添加仓库

   ```bash
   helm repo add bitnami https://charts.bitnami.com/bitnami
   helm repo update
   ```

## 四、基础操作

- 搜索 Chart

  ```bash
  helm search repo mysql
  ```

- 安装 Chart

  ```bash
  helm install mydb bitnami/mysql
  ```

- 查看 Release

  ```bash
  helm list
  ```

- 升级与回滚

  ```bash
  helm upgrade mydb bitnami/mysql
  helm rollback mydb 1
  ```

- 卸载 Release

  ```bash
  helm uninstall mydb
  ```

## 五、自定义 Chart

Helm 提供 `helm create` 命令快速生成一个 Chart 目录结构：

```
mychart/
├── charts/           # 子Chart依赖
├── templates/        # 模板文件（Deployment/Service等）
├── Chart.yaml        # Chart元数据
└── values.yaml       # 默认配置值
```

- **Chart.yaml**：描述 Chart 的基本信息。
- **values.yaml**：定义可配置参数。
- **templates/**：存放 Kubernetes 资源模板。

通过修改 `values.yaml`，即可在不同环境中灵活调整配置。

## 六、最佳实践

- 使用 **私有仓库** 管理团队内部 Chart。
- 结合 **CI/CD** 自动化部署。
- 定期清理无用 Release，避免资源残留。
- 在生产环境中启用 **RBAC 与安全策略**，确保 Helm 操作安全。

## 七、总结

Helm 被称为 **“K8s 的 apt-get”**，是 Kubernetes 生态中不可或缺的工具。它不仅简化了应用的部署与管理，还为团队协作和环境隔离提供了强大支持。掌握 Helm，意味着你能更高效地驾驭 Kubernetes 的复杂应用场景