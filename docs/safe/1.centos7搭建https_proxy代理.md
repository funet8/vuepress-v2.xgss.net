# centos7搭建https_proxy代理





## 搭建https_proxy代理

在 CentOS7 上最常见的方式是使用 **Squid** 搭建 HTTPS/HTTP 代理服务端。

核心步骤包括：

安装 Squid 

配置监听端口与 ACL

启用 HTTPS CONNECT 支持 

（可选）添加账号认证 

开放防火墙端口 

 启动并测试服务

### 1. 安装 Squid

```bash
sudo yum -y update
sudo yum -y install epel-release
sudo yum -y install squid httpd-tools
```

### 2. 配置 Squid

编辑配置文件：

```bash
vim /etc/squid/squid.conf
```

关键配置示例：

```conf
# 监听端口（默认 3128，可改为 8080/其他）
http_port 0.0.0.0:3128

# 允许 HTTPS CONNECT
acl SSL_ports port 443
acl Safe_ports port 80
acl Safe_ports port 443
http_access allow CONNECT SSL_ports

# 允许认证用户访问
auth_param basic program /usr/lib64/squid/basic_ncsa_auth /etc/squid/passwd
auth_param basic realm proxy
acl authenticated proxy_auth REQUIRED
http_access allow authenticated
```

### 3. 创建认证用户（可选）

```bash
sudo htpasswd -c /etc/squid/passwd user1
# 输入密码
```

### 4. 开放防火墙端口

```bash
sudo firewall-cmd --permanent --add-port=3128/tcp
sudo firewall-cmd --reload
```

### 5. 启动并设置开机自启

```bash
sudo systemctl enable squid
sudo systemctl start squid
sudo systemctl status squid
```



```
systemctl status squid
● squid.service - Squid caching proxy
   Loaded: loaded (/usr/lib/systemd/system/squid.service; enabled; vendor preset: disabled)
   Active: active (running) since Tue 2025-11-04 15:45:41 CST; 5s ago
  Process: 20838 ExecStart=/usr/sbin/squid $SQUID_OPTS -f $SQUID_CONF (code=exited, status=0/SUCCESS)
  Process: 20832 ExecStartPre=/usr/libexec/squid/cache_swap.sh (code=exited, status=0/SUCCESS)
 Main PID: 20840 (squid)
    Tasks: 3
   Memory: 13.6M
   CGroup: /system.slice/squid.service
           ├─20840 /usr/sbin/squid -f /etc/squid/squid.conf
           ├─20842 (squid-1) -f /etc/squid/squid.conf
           └─20843 (logfile-daemon) /var/log/squid/access.log

Nov 04 15:45:41 vpn-guigui2 systemd[1]: Starting Squid caching proxy...
Nov 04 15:45:41 vpn-guigui2 squid[20840]: Squid Parent: will start 1 kids
Nov 04 15:45:41 vpn-guigui2 squid[20840]: Squid Parent: (squid-1) process 20842 started
Nov 04 15:45:41 vpn-guigui2 systemd[1]: Started Squid caching proxy.
```



### 6. 测试代理

在客户端设置：

```bash
export https_proxy=http://user1:password@<服务器IP>:3128
curl -I https://www.google.com --proxy http://<服务器IP>:3128
```









