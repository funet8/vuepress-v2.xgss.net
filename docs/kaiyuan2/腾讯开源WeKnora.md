# è…¾è®¯å¼€æºåŸºäºå¤§æ¨¡å‹çš„æ™ºèƒ½çŸ¥è¯†åº“ï¼Œè½»æ¾éƒ¨ç½²å…¨æ”»ç•¥



## å‰è¨€

åœ¨ä¼ä¸šçŸ¥è¯†ç®¡ç†ã€ç§‘ç ”æ–‡çŒ®åˆ†æã€æŠ€æœ¯æ”¯æŒã€æ³•å¾‹åˆè§„å®¡æŸ¥ç­‰åœºæ™¯ä¸­ï¼Œä¼ ç»Ÿçš„å…¨æ–‡æ£€ç´¢å’Œå…³é”®è¯åŒ¹é…å·²ç»æ— æ³•æ»¡è¶³å¤æ‚ã€å¤šæ¨¡æ€çš„æ–‡æ¡£ç†è§£éœ€æ±‚ã€‚  

è…¾è®¯è¿‘æœŸå¼€æºçš„ **WeKnora** æ¡†æ¶ï¼Œå°†å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ä¸è¯­ä¹‰æ£€ç´¢ã€æ™ºèƒ½æ¨ç†æ·±åº¦èåˆï¼Œä¸ºç»“æ„å¤æ‚ã€å†…å®¹å¼‚æ„çš„æ–‡æ¡£æä¾›é«˜è´¨é‡çš„é—®ç­”ä¸åˆ†æèƒ½åŠ›ã€‚

æœ¬æ–‡å°†å¸¦ä½ å¿«é€Ÿäº†è§£ WeKnora çš„æ ¸å¿ƒç‰¹æ€§ï¼Œå¹¶æ‰‹æŠŠæ‰‹æ¼”ç¤ºå¦‚ä½•åœ¨ **é£ç‰› NAS** ä¸Šé€šè¿‡ Docker éƒ¨ç½²ï¼Œè®©ä½ çš„ç§æœ‰çŸ¥è¯†åº“ç§’å˜â€œæ™ºèƒ½é—®ç­”ä¸“å®¶â€ã€‚

![img](https://imgoss.xgss.net/picgo-tx2025/QQ_1757256221891.png?tx)

## WeKnora é¡¹ç›®ä»‹ç»

WeKnoraï¼ˆç»´å¨œæ‹‰ï¼‰ æ˜¯ä¸€æ¬¾åŸºäºå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„æ–‡æ¡£ç†è§£ä¸è¯­ä¹‰æ£€ç´¢æ¡†æ¶ï¼Œä¸“ä¸ºç»“æ„å¤æ‚ã€å†…å®¹å¼‚æ„çš„æ–‡æ¡£åœºæ™¯è€Œæ‰“é€ ã€‚

æ¡†æ¶é‡‡ç”¨æ¨¡å—åŒ–æ¶æ„ï¼Œèåˆå¤šæ¨¡æ€é¢„å¤„ç†ã€è¯­ä¹‰å‘é‡ç´¢å¼•ã€æ™ºèƒ½å¬å›ä¸å¤§æ¨¡å‹ç”Ÿæˆæ¨ç†ï¼Œæ„å»ºèµ·é«˜æ•ˆã€å¯æ§çš„æ–‡æ¡£é—®ç­”æµç¨‹ã€‚æ ¸å¿ƒæ£€ç´¢æµç¨‹åŸºäº RAGï¼ˆRetrieval-Augmented Generationï¼‰ æœºåˆ¶ï¼Œå°†ä¸Šä¸‹æ–‡ç›¸å…³ç‰‡æ®µä¸è¯­è¨€æ¨¡å‹ç»“åˆï¼Œå®ç°æ›´é«˜è´¨é‡çš„è¯­ä¹‰å›ç­”ã€‚

å®˜ç½‘ï¼š https://weknora.weixin.qq.com

## æ ¸å¿ƒç‰¹æ€§

- **ğŸ” ç²¾å‡†ç†è§£**ï¼šæ”¯æŒ PDFã€Wordã€å›¾ç‰‡ç­‰æ–‡æ¡£çš„ç»“æ„åŒ–å†…å®¹æå–ï¼Œç»Ÿä¸€æ„å»ºè¯­ä¹‰è§†å›¾
- **ğŸ§  æ™ºèƒ½æ¨ç†**ï¼šå€ŸåŠ©å¤§è¯­è¨€æ¨¡å‹ç†è§£æ–‡æ¡£ä¸Šä¸‹æ–‡ä¸ç”¨æˆ·æ„å›¾ï¼Œæ”¯æŒç²¾å‡†é—®ç­”ä¸å¤šè½®å¯¹è¯
- **ğŸ”§ çµæ´»æ‰©å±•**ï¼šä»è§£æã€åµŒå…¥ã€å¬å›åˆ°ç”Ÿæˆå…¨æµç¨‹è§£è€¦ï¼Œä¾¿äºçµæ´»é›†æˆä¸å®šåˆ¶æ‰©å±•
- **âš¡ é«˜æ•ˆæ£€ç´¢**ï¼šæ··åˆå¤šç§æ£€ç´¢ç­–ç•¥ï¼šå…³é”®è¯ã€å‘é‡ã€çŸ¥è¯†å›¾è°±
- **ğŸ¯ ç®€å•æ˜“ç”¨**ï¼šç›´è§‚çš„Webç•Œé¢ä¸æ ‡å‡†APIï¼Œé›¶æŠ€æœ¯é—¨æ§›å¿«é€Ÿä¸Šæ‰‹
- **ğŸ”’ å®‰å…¨å¯æ§**ï¼šæ”¯æŒæœ¬åœ°åŒ–ä¸ç§æœ‰äº‘éƒ¨ç½²ï¼Œæ•°æ®å®Œå…¨è‡ªä¸»å¯æ§

## ä½¿ç”¨åœºæ™¯

![img](https://imgoss.xgss.net/picgo-tx2025/QQ_1757254553072.png?tx)



## åŠŸèƒ½æ¨¡å—èƒ½åŠ›

![img](https://imgoss.xgss.net/picgo-tx2025/QQ_1757254588806.png?tx)

## åœ¨é£ç‰› NAS ä¸Šéƒ¨ç½² WeKnora

> ç†è®ºä¸Šï¼Œä»»ä½•æ”¯æŒ Docker çš„è®¾å¤‡éƒ½å¯éƒ¨ç½² WeKnoraï¼Œè¿™é‡Œä»¥é£ç‰› NAS ä¸ºä¾‹ã€‚

ç¡®ä¿æœ¬åœ°å·²å®‰è£…ä»¥ä¸‹å·¥å…·ï¼š

Dockerã€Docker Composeã€Git

### 1. å¯ç”¨ SSH ç™»å½•
åœ¨é£ç‰› OS ä¸­å¼€å¯ **SSH ç™»å½•** åŠŸèƒ½ï¼Œå¹¶åˆ‡æ¢åˆ° `root` ç”¨æˆ·ï¼š
```bash
sudo -i
```

### 2. åˆ›å»ºéƒ¨ç½²ç›®å½•

```bash
mkdir -p /data/docker && cd /data/docker
```

### 3. å…‹éš†é¡¹ç›®

```bash
# å…‹éš†ä¸»ä»“åº“
git clone https://github.com/Tencent/WeKnora.git
cd WeKnora
```

### 4. é…ç½®ç¯å¢ƒå˜é‡

```bash
cp .env.example .env
# ç¼–è¾‘ .env å¡«å†™å¯¹åº”é…ç½®ä¿¡æ¯
```

> `.env.example` æ–‡ä»¶ä¸­æœ‰è¯¦ç»†æ³¨é‡Šï¼Œå¯æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ã€‚

### 5.å¯åŠ¨æœåŠ¡

å¦‚æœéœ€è¦å®‰è£…ollamaåˆ™æ‰§è¡Œè¿™ä¸ªï¼Œæˆ‘è¿™è¾¹ä¸æ‰§è¡Œï¼Œå› ä¸ºæˆ‘å·²ç»æœ‰å®‰è£…ollamaäº†ã€‚

```
# å¯åŠ¨å…¨éƒ¨æœåŠ¡ï¼ˆå« Ollama ä¸åç«¯å®¹å™¨ï¼‰
./scripts/start_all.sh
# æˆ–
make start-all
```



### 5.å¯åŠ¨æœåŠ¡å¤‡é€‰

```
# å¯åŠ¨æœåŠ¡
docker compose up -d
```

![img](https://imgoss.xgss.net/picgo-tx2025/QQ_1757255116788.png?tx)

æ¥ä¸‹æ¥å°±çœ‹ç½‘ç»œçš„æƒ…å†µäº†ã€‚

### 6.åœæ­¢æœåŠ¡

```
./scripts/start_all.sh --stop
# æˆ–
make stop-all
```



###  æœåŠ¡è®¿é—®åœ°å€

å¯åŠ¨æˆåŠŸåï¼Œå¯è®¿é—®ä»¥ä¸‹åœ°å€ï¼š

- Web UIï¼š`http://localhost`
- åç«¯ APIï¼š`http://localhost:8080`
- é“¾è·¯è¿½è¸ªï¼ˆJaegerï¼‰ï¼š`http://localhost:16686`

é¦–æ¬¡è¿›å…¥éœ€é…ç½®ï¼š

é¦–æ¬¡è®¿é—®ä¼šè‡ªåŠ¨è·³è½¬åˆ°åˆå§‹åŒ–é…ç½®é¡µé¢ï¼Œé…ç½®å®Œæˆåä¼šè‡ªåŠ¨è·³è½¬åˆ°çŸ¥è¯†åº“é¡µé¢ã€‚è¯·æŒ‰ç…§é¡µé¢æç¤ºä¿¡æ¯å®Œæˆæ¨¡å‹çš„é…ç½®ã€‚

- å¤§æ¨¡å‹ï¼ˆæœ¬åœ° ollama æˆ–è¿œç¨‹ APIï¼‰
- Embedding æ¨¡å‹
- Rerank æ¨¡å‹
- å¤šæ¨¡æ€è§£æ
- æ–‡æ¡£åˆ†å‰²ç­–ç•¥

------

## ä½¿ç”¨ä½“éªŒ

1. **ä¸Šä¼ æ–‡æ¡£**  
    æ”¯æŒæ‰¹é‡ä¸Šä¼ ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è§£æå¹¶ç”ŸæˆçŸ¥è¯†åº“ç´¢å¼•ã€‚
2. **æ™ºèƒ½é—®ç­”**  
    è¾“å…¥é—®é¢˜ï¼ŒWeKnora ä¼šç»“åˆçŸ¥è¯†åº“å†…å®¹è¿›è¡Œç²¾å‡†å›ç­”ï¼Œå¹¶ç»™å‡ºå¼•ç”¨æ¥æºã€‚
3. **å¤šè½®å¯¹è¯**  
    æ”¯æŒä¸Šä¸‹æ–‡å…³è”çš„è¿ç»­æé—®ï¼Œé€‚åˆæ·±åº¦åˆ†æä¸æ¢ç´¢ã€‚

WeKnora æä¾›äº†ä¸€ç³»åˆ— RESTful APIï¼Œç”¨äºåˆ›å»ºå’Œç®¡ç†çŸ¥è¯†åº“ã€æ£€ç´¢çŸ¥è¯†ï¼Œä»¥åŠè¿›è¡ŒåŸºäºçŸ¥è¯†çš„é—®ç­”ã€‚æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†è¿™äº› API çš„ä½¿ç”¨æ–¹å¼ã€‚

## å¦‚ä½•æŸ¥çœ‹æ—¥å¿—ï¼Ÿ

```
# æŸ¥çœ‹ ä¸»æœåŠ¡ æ—¥å¿—
docker exec -it WeKnora-app tail -f /var/log/WeKnora.log

# æŸ¥çœ‹ æ–‡æ¡£è§£ææ¨¡å— æ—¥å¿—
docker exec -it WeKnora-docreader tail -f /var/log/docreader.log
```

## å¦‚ä½•å¯åŠ¨å’Œåœæ­¢æœåŠ¡ï¼Ÿ

```
# å¯åŠ¨æœåŠ¡
./scripts/start_all.sh

# åœæ­¢æœåŠ¡
./scripts/start_all.sh --stop

# æ¸…ç©ºæ•°æ®åº“
./scripts/start_all.sh --stop && make clean-db
```



## åº”ç”¨åœºæ™¯

- ä¼ä¸šå†…éƒ¨çŸ¥è¯†ç®¡ç†
- ç§‘ç ”æ–‡çŒ®åˆ†æ
- äº§å“æŠ€æœ¯æ”¯æŒ
- æ³•å¾‹åˆè§„å®¡æŸ¥
- åŒ»ç–—çŸ¥è¯†è¾…åŠ©

## æ€»ç»“

WeKnora ä½œä¸ºè…¾è®¯å¼€æºçš„ **æ™ºèƒ½çŸ¥è¯†åº“æ¡†æ¶**ï¼Œåœ¨æ–‡æ¡£è§£æã€è¯­ä¹‰æ£€ç´¢ã€æ™ºèƒ½æ¨ç†ç­‰æ–¹é¢è¡¨ç°å‡ºè‰²ã€‚ ç»“åˆé£ç‰› NASï¼ˆå…¶ä»–çš„æœåŠ¡å™¨ä¹Ÿå¯ä»¥ï¼‰ çš„æœ¬åœ°åŒ–éƒ¨ç½²èƒ½åŠ›ï¼Œä½ å¯ä»¥è½»æ¾æ„å»ºä¸€ä¸ª **å®‰å…¨å¯æ§ã€åŠŸèƒ½å¼ºå¤§** çš„ç§æœ‰çŸ¥è¯†åº“ç³»ç»Ÿã€‚

å¦‚æœä½ æ­£åœ¨å¯»æ‰¾ä¸€æ¬¾ **å¯æœ¬åœ°éƒ¨ç½²ã€æ”¯æŒå¤šæ¨¡æ€ã€åŸºäºå¤§æ¨¡å‹çš„çŸ¥è¯†åº“è§£å†³æ–¹æ¡ˆ**ï¼ŒWeKnora å€¼å¾—ä¸€è¯•ã€‚

å†™æ–‡ä¸æ˜“ï¼Œå¦‚æœä½ éƒ½çœ‹åˆ°äº†è¿™é‡Œï¼Œè¯·ç‚¹ä¸ªèµå’Œåœ¨çœ‹ï¼Œåˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ï¼›ä¹Ÿåˆ«å¿˜äº†å…³æ³¨æ˜Ÿå“¥ç©äº‘ï¼è¿™é‡Œæœ‰æ»¡æ»¡çš„å¹²è´§åˆ†äº«ï¼Œè¿˜æœ‰è½»æ¾æœ‰è¶£çš„æŠ€æœ¯äº¤æµï½ç‚¹ä¸ªèµã€åˆ†äº«ç»™èº«è¾¹çš„å°ä¼™ä¼´ï¼Œä¸€èµ·æˆé•¿ï¼Œä¸€èµ·ç©è½¬æŠ€æœ¯ä¸–ç•Œå§ï¼ ğŸ˜Š



# WeKnoraçš„ä½¿ç”¨

## 80ç«¯å£è¢«å ç”¨

ç”±äºæ­å»ºWeKnoraçš„80ç«¯å£è¢«å ç”¨ï¼ŒæŠ¥é”™ï¼š

```
Error response from daemon: failed to set up container networking: driver failed programming external connectivity on endpoint WeKnora-frontend (6f1a34f78e900c8027c65236eaffc48c5d47611b979d6825797348b189559c37): failed to bind host port for 0.0.0.0:80:172.18.0.8:80/tcp: address already in use
```

ä¿®æ”¹ docker-compose.yml æ–‡ä»¶

```
  frontend:
    image: wechatopenai/weknora-ui:latest
    container_name: WeKnora-frontend
    ports:
      - "80:80"  
ä¸­çš„ â€˜80:80â€™æ”¹æˆ 81:80

```

ä¿®æ”¹.env

```
vi .env
æŠŠOLLAMA_BASE_URL=http://host.docker.internal:11434
#OLLAMA_BASE_URL=http://host.docker.internal:11434
æ”¹æˆäº†
OLLAMA_BASE_URL=http://192.168.1.18:11434
```



å†æ¬¡è¿è¡Œ

```
docker ps
CONTAINER ID   IMAGE                                   COMMAND                  CREATED          STATUS                   PORTS                                                                                                                                                                                              NAMES
7fe245b1547f   wechatopenai/weknora-ui:latest          "/docker-entrypoint.â€¦"   32 minutes ago   Up 8 minutes             0.0.0.0:81->80/tcp                                                                                                                                                                                 WeKnora-frontend
02007c0d740a   wechatopenai/weknora-app:latest         "supervisord -c /etcâ€¦"   32 minutes ago   Up 8 minutes             0.0.0.0:8080->8080/tcp                                                                                                                                                                             WeKnora-app
49db9309840d   wechatopenai/weknora-docreader:latest   "supervisord -c /etcâ€¦"   32 minutes ago   Up 8 minutes             0.0.0.0:50051->50051/tcp                                                                                                                                                                           WeKnora-docreader
ea4ea9bf515f   jaegertracing/all-in-one:latest         "/go/bin/all-in-one-â€¦"   32 minutes ago   Up 8 minutes             0.0.0.0:4317-4318->4317-4318/tcp, 0.0.0.0:5778->5778/tcp, 0.0.0.0:9411->9411/tcp, 0.0.0.0:14250->14250/tcp, 0.0.0.0:14268->14268/tcp, 0.0.0.0:16686->16686/tcp, 0.0.0.0:6831-6832->6831-6832/udp   weknora-jaeger-1
2f405f897e38   paradedb/paradedb:latest                "docker-entrypoint.sâ€¦"   32 minutes ago   Up 8 minutes (healthy)   0.0.0.0:5432->5432/tcp                                                                                                                                                                             WeKnora-postgres
eb7a460e95af   redis:7.0-alpine                        "docker-entrypoint.sâ€¦"   32 minutes ago   Up 8 minutes             0.0.0.0:6379->6379/tcp                                                                                                                                                                             WeKnora-redis
```





## WeKnora ç³»ç»Ÿåˆå§‹åŒ–é…ç½®

ç”±äºå±€åŸŸç½‘é‡Œé¢æœ‰å®‰è£…ollamaï¼Œæ‰€ä»¥å®‰è£…WeKnoraçš„æ—¶å€™å°±æ²¡æœ‰å®‰è£…ollamaã€‚

### LLM å¤§è¯­è¨€æ¨¡å‹é…ç½®

æ¨¡å‹åç§°ï¼š ä½¿ç”¨ ollama list æŸ¥çœ‹æœ‰å“ªäº›æ¨¡å‹ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨ gpt-oss:20b

Base URLå¡«å†™ï¼š `http://192.168.1.18:11434/v1`

æµ‹è¯•ï¼š

```
curl http://192.168.1.18:11434/api/generate -d '{
  "model": "gpt-oss:20b",
  "prompt": "Why is the sky blue?",
  "stream": false 
}'
```

### Embedding åµŒå…¥æ¨¡å‹é…ç½®

æ¨¡å‹åç§°ï¼šnomic-embed-text:latest ï¼ˆæ²¡æœ‰åˆ™éœ€è¦å®‰è£…ï¼‰

ç»´åº¦ï¼š768ï¼ˆç»´åº¦å¿…é¡»ä¸ºæœ‰æ•ˆæ•´æ•°å€¼ï¼Œå¸¸è§å–å€¼ä¸º768, 1024, 1536, 3584ç­‰ï¼‰

Base URLå¡«å†™ï¼š `http://192.168.1.18:11434/v1`

![img](https://imgoss.xgss.net/picgo-tx2025/QQ_1757301490702.png?tx)

## å®Œæˆé…ç½®

![img](https://imgoss.xgss.net/picgo-tx2025/QQ_1757301881161.png?tx)

ä¸Šä¼ æ–‡ç« 

![img](https://imgoss.xgss.net/picgo-tx2025/QQ_1757302299670.png?tx)

å†é—®ä¸ªé—®é¢˜

![img](https://imgoss.xgss.net/picgo-tx2025/QQ_1757302426203.png?tx)