# Rocky Linux 9 源码包安装php8

大家好，我是星哥！今天咱们不聊yum一键安装的“快餐式”部署，来点儿硬核的——源码编译安装PHP 8.3。为什么要折腾源码？因为它能让你深度定制PHP功能、启用最新特性，还能避开系统默认源的版本限制。

话不多说，跟着星哥一步步把PHP 8.3.3 在Rocky Linux 9上从0到1跑起来，顺便把性能榨干！

![img](https://imgoss.xgss.net/picgo-tx2025/QQ_1752581819875.png?tx)

# 快速安装

Rocky Linux 9系统中源码包安装php8.3.3 并且使用phpfpm

安装目录为：/data/app/php8.3

用户为 www 

端口自定义为 8300

需要PHP安装扩展

zip

openssl

libmemcached

phpredis

pcntl

amqp

rabbitmq

swoole

```
# 使用：
# gitee:
# wget https://gitee.com/funet8/Rocky-Linux-Shell/raw/main/shell/Rocky_Linux_9_Install_PHP8_3_PHPFPM.sh
# sh Rocky_Linux_9_Install_PHP8_3_PHPFPM.sh
# github:
# wget https://raw.githubusercontent.com/funet8/Rocky-Linux-Shell/refs/heads/main/shell/Rocky_Linux_9_Install_PHP8_3_PHPFPM.sh
# sh Rocky_Linux_9_Install_PHP8_3_PHPFPM.sh
```



## 1.新建用户和用户组

```
groupadd www
useradd -g www www
```

## 2.安装EPEL仓库

```
dnf install -y epel-release
```

## 3.安装依赖

```
# 清理缓存并更新软件包列表
dnf clean all
dnf makecache
dnf install -y  wget libxml2-devel sqlite-devel bzip2-devel libcurl-devel libffi-devel libpng-devel libwebp-devel libjpeg-devel oniguruma libzip
dnf install -y gcc make autoconf automake libtool bison gcc  libicu-devel openssl-devel
dnf install -y gcc gcc-c++ make autoconf automake libtool bison re2c  openssl-devel libxml2-devel libpng-devel  libjpeg-devel  libicu-devel curl-devel   sqlite-devel libuuid-devel systemd-devel libxslt-devel readline-devel

dnf groupinstall "Development Tools" -y
```

## 4.安装oniguruma-devel和libzip-devel

```
wget https://dl.rockylinux.org/pub/rocky/9/devel/x86_64/os/Packages/o/oniguruma-devel-6.9.6-1.el9.6.x86_64.rpm
dnf -y install oniguruma-devel-6.9.6-1.el9.6.x86_64.rpm

wget https://dl.rockylinux.org/pub/rocky/9/devel/x86_64/os/Packages/l/libzip-devel-1.7.3-8.el9.x86_64.rpm
dnf -y install libzip-devel-1.7.3-8.el9.x86_64.rpm
```

## 5.下载php8解压安装

```
mkdir -p /data/app/php8.3 /data/software/php8.3
mkdir -p /data/software && cd /data/software
cd /data/software
    wget https://www.php.net/distributions/php-8.3.3.tar.gz
	tar -zxf php-8.3.3.tar.gz
	cd /data/software/php-8.3.3
	
    ./configure \
    --with-fpm-user=www \
    --with-fpm-group=www \
    --prefix=/data/app/php8.3 \
    --with-config-file-path=/data/app/php8.3/etc \
    --with-openssl \
    --with-zlib \
    --with-bz2 \
    --with-curl \
    --enable-bcmath \
    --enable-gd \
    --with-webp \
    --with-jpeg \
    --with-mhash \
    --enable-mbstring \
    --with-imap-ssl \
    --with-mysqli \
    --enable-exif \
    --with-ffi \
    --with-zip \
    --enable-sockets \
    --with-pcre-jit \
    --enable-fpm \
    --with-pdo-mysql \
    --enable-pcntl

    make && make install
```

## 6.安装phpredis扩展

```
cd /data/software/php8.3
	wget  http://js.funet8.com/centos_software/php8/phpredis-6.0.2.tar.gz
	tar xzf phpredis-6.0.2.tar.gz
	cd /data/software/php8.3/phpredis-6.0.2
	/data/app/php8.3/bin/phpize
	./configure --with-php-config=/data/app/php8.3/bin/php-config
	make && make install
```

## 7.安装swoole扩展

```
cd /data/software/php8.3
	wget  http://js.funet8.com/centos_software/php8/swoole-src-5.1.2.tar.gz
	tar -zxf swoole-src-5.1.2.tar.gz
	cd /data/software/php8.3/swoole-src-5.1.2
	/data/app/php8.3/bin/phpize
	./configure --with-php-config=/data/app/php8.3/bin/php-config
	make && make install
```

## 8.安装rabbitmq扩展

```
cd /data/software/php8.3
wget -c http://js.funet8.com/centos_software/rabbitmq-php/rabbitmq-c-0.8.0.tar.gz
tar zxf rabbitmq-c-0.8.0.tar.gz
		cd rabbitmq-c-0.8.0
		./configure --prefix=/usr/local/rabbitmq-c-0.8.0
		make && make install
```

## 9.安装amqp扩展

```
cd /data/software/php8.3
		wget  http://js.funet8.com/centos_software/php8/amqp-2.1.2.tgz
		tar -zxf amqp-2.1.2.tgz
		cd /data/software/php8.3/amqp-2.1.2
		/data/app/php8.3/bin/phpize
		./configure --with-php-config=/data/app/php8.3/bin/php-config --with-amqp --with-librabbitmq-dir=/usr/local/rabbitmq-c-0.8.0
		make && make install
```

## 10.配置php配置

```
cp /data/software/php-8.3.3/php.ini-production /data/app/php8.3/etc/php.ini
	cp /data/software/php-8.3.3/sapi/fpm/php-fpm.conf /data/app/php8.3/etc/php-fpm.conf
	cp /data/app/php8.3/etc/php-fpm.d/www.conf.default /data/app/php8.3/etc/php-fpm.d/www.conf

    # 修改 PHP-FPM 配置
    sed -i "s|^listen = 127.0.0.1:9000|listen = 127.0.0.1:8300|" "/data/app/php8.3/etc/php-fpm.d/www.conf"
    sed -i "s|^;listen.allowed_clients|listen.allowed_clients|" "/data/app/php8.3/etc/php-fpm.d/www.conf"
    sed -i "s|^;pid = run/php-fpm.pid|pid = run/php-fpm.pid|" "/data/app/php8.3/etc/php-fpm.conf"
    # 修改php进程数
	sed -i "s/pm\.max\_children \= 5/pm\.max\_children \= 20/g" /data/app/php8.3/etc/php-fpm.d/www.conf
    # 修改 request_terminate_timeout = 30 （请求终止超时）
	sed -i "s/\;request\_terminate\_timeout \= 0/request\_terminate\_timeout \= 30/g" /data/app/php8.3/etc/php-fpm.d/www.conf


    # 修改 PHP.ini 配置
    sed -i "s|^;date.timezone =|date.timezone = Asia/Shanghai|" "/data/app/php8.3/etc/php.ini"
    sed -i "s|^memory_limit = 128M|memory_limit = 256M|" "/data/app/php8.3/etc/php.ini"
    sed -i "s|^;cgi.fix_pathinfo=1|cgi.fix_pathinfo=0|" "/data/app/php8.3/etc/php.ini"
    sed -i "s|^upload_max_filesize = 2M|upload_max_filesize = 32M|" "/data/app/php8.3/etc/php.ini"
    sed -i "s|^post_max_size = 8M|post_max_size = 32M|" "/data/app/php8.3/etc/php.ini"
    #sed -i "s|^max_execution_time = 30|max_execution_time = 300|" "/data/app/php8.3/etc/php.ini"


    #添加扩展
	echo 'extension=redis.so'>> /data/app/php8.3/etc/php.ini
	#echo 'extension=zip.so'>> /data/app/php8.3/etc/php.ini
	echo 'extension=swoole.so'>> /data/app/php8.3/etc/php.ini
	echo 'extension=amqp.so'>> /data/app/php8.3/etc/php.ini
	# 显示扩展
	/data/app/php8.3/bin/php -m|grep redis
	/data/app/php8.3/bin/php -m|grep zip
	/data/app/php8.3/bin/php -m|grep swoole
	/data/app/php8.3/bin/php -m|grep amqp
```



## 11.配置环境变量

```
cp -a /data/app/php8.3/bin/php /data/app/php8.3/bin/php8.3
	echo "export PATH=$PATH:/data/app/php8.3/bin">>/etc/profile
	source /etc/profile
	php8.3 -v
```

## 12.开机启动脚本配置

```
cat > /etc/systemd/system/php8.3-fpm.service << EOF
[Unit]
Description=PHP 8.3 FastCGI Process Manager
After=network.target

[Service]
Type=simple
PIDFile=/data/app/php8.3/var/run/php-fpm.pid
ExecStart=/data/app/php8.3/sbin/php-fpm --nodaemonize --fpm-config /data/app/php8.3/etc/php-fpm.conf
ExecReload=/bin/kill -USR2 \$MAINPID
ExecStop=/bin/kill -SIGINT \$MAINPID
PrivateTmp=true
RestartSec=5s
Restart=on-failure

[Install]
WantedBy=multi-user.target
EOF

systemctl daemon-reload
systemctl enable php8.3-fpm.service
systemctl start php8.3-fpm.service
```

## 13.配置防火墙

```
    firewall-cmd --zone=public --add-port=8300/tcp --permanent
    firewall-cmd --reload
    firewall-cmd --zone=public --list-ports
```

# 最后

折腾了这么久，可能有同学会问：“yum install php不香吗？”星哥想说，源码编译的“爽”在于“掌控感”——你可以精确控制PHP的每一个功能，启用最新特性，甚至针对服务器硬件优化编译参数。当然，代价是需要手动处理依赖和升级，但对于追求极致性能和定制化的场景（如生产环境、高性能API服务）

写文不易，如果你都看到了这里，请点个赞和在看，分享给更多的朋友；也别忘了关注星哥玩云！这里有满满的干货分享，还有轻松有趣的技术交流～点个赞、分享给身边的小伙伴，一起成长，一起玩转技术世界吧！ 😊





