# Rocky Linux 9 æºç åŒ…å®‰è£…php8

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯æ˜Ÿå“¥ï¼ä»Šå¤©å’±ä»¬ä¸èŠyumä¸€é”®å®‰è£…çš„â€œå¿«é¤å¼â€éƒ¨ç½²ï¼Œæ¥ç‚¹å„¿ç¡¬æ ¸çš„â€”â€”æºç ç¼–è¯‘å®‰è£…PHP 8.3ã€‚ä¸ºä»€ä¹ˆè¦æŠ˜è…¾æºç ï¼Ÿå› ä¸ºå®ƒèƒ½è®©ä½ æ·±åº¦å®šåˆ¶PHPåŠŸèƒ½ã€å¯ç”¨æœ€æ–°ç‰¹æ€§ï¼Œè¿˜èƒ½é¿å¼€ç³»ç»Ÿé»˜è®¤æºçš„ç‰ˆæœ¬é™åˆ¶ã€‚

è¯ä¸å¤šè¯´ï¼Œè·Ÿç€æ˜Ÿå“¥ä¸€æ­¥æ­¥æŠŠPHP 8.3.3 åœ¨Rocky Linux 9ä¸Šä»Ž0åˆ°1è·‘èµ·æ¥ï¼Œé¡ºä¾¿æŠŠæ€§èƒ½æ¦¨å¹²ï¼

![img](https://imgoss.xgss.net/picgo-tx2025/QQ_1752581819875.png?tx)

# å¿«é€Ÿå®‰è£…

Rocky Linux 9ç³»ç»Ÿä¸­æºç åŒ…å®‰è£…php8.3.3 å¹¶ä¸”ä½¿ç”¨phpfpm

å®‰è£…ç›®å½•ä¸ºï¼š/data/app/php8.3

ç”¨æˆ·ä¸º www 

ç«¯å£è‡ªå®šä¹‰ä¸º 8300

éœ€è¦PHPå®‰è£…æ‰©å±•

zip

openssl

libmemcached

phpredis

pcntl

amqp

rabbitmq

swoole

```
# ä½¿ç”¨ï¼š
# gitee:
# wget https://gitee.com/funet8/Rocky-Linux-Shell/raw/main/shell/Rocky_Linux_9_Install_PHP8_3_PHPFPM.sh
# sh Rocky_Linux_9_Install_PHP8_3_PHPFPM.sh
# github:
# wget https://raw.githubusercontent.com/funet8/Rocky-Linux-Shell/refs/heads/main/shell/Rocky_Linux_9_Install_PHP8_3_PHPFPM.sh
# sh Rocky_Linux_9_Install_PHP8_3_PHPFPM.sh
```



## 1.æ–°å»ºç”¨æˆ·å’Œç”¨æˆ·ç»„

```
groupadd www
useradd -g www www
```

## 2.å®‰è£…EPELä»“åº“

```
dnf install -y epel-release
```

## 3.å®‰è£…ä¾èµ–

```
# æ¸…ç†ç¼“å­˜å¹¶æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨
dnf clean all
dnf makecache
dnf install -y  wget libxml2-devel sqlite-devel bzip2-devel libcurl-devel libffi-devel libpng-devel libwebp-devel libjpeg-devel oniguruma libzip
dnf install -y gcc make autoconf automake libtool bison gcc  libicu-devel openssl-devel
dnf install -y gcc gcc-c++ make autoconf automake libtool bison re2c  openssl-devel libxml2-devel libpng-devel  libjpeg-devel  libicu-devel curl-devel   sqlite-devel libuuid-devel systemd-devel libxslt-devel readline-devel

dnf groupinstall "Development Tools" -y
```

## 4.å®‰è£…oniguruma-develå’Œlibzip-devel

```
wget https://dl.rockylinux.org/pub/rocky/9/devel/x86_64/os/Packages/o/oniguruma-devel-6.9.6-1.el9.6.x86_64.rpm
dnf -y install oniguruma-devel-6.9.6-1.el9.6.x86_64.rpm

wget https://dl.rockylinux.org/pub/rocky/9/devel/x86_64/os/Packages/l/libzip-devel-1.7.3-8.el9.x86_64.rpm
dnf -y install libzip-devel-1.7.3-8.el9.x86_64.rpm
```

## 5.ä¸‹è½½php8è§£åŽ‹å®‰è£…

```
mkdir -p /data/app/php8.3 /data/software/php8.3
mkdir -p /data/software && cd /data/software
cd /data/software
    wget https://www.php.net/distributions/php-8.3.3.tar.gz
	tar -zxf php-8.3.3.tar.gz
	cd /data/software/php-8.3.3
	
    ./configure \
    --with-fpm-user=www \
    --with-fpm-group=www \
    --prefix=/data/app/php8.3 \
    --with-config-file-path=/data/app/php8.3/etc \
    --with-openssl \
    --with-zlib \
    --with-bz2 \
    --with-curl \
    --enable-bcmath \
    --enable-gd \
    --with-webp \
    --with-jpeg \
    --with-mhash \
    --enable-mbstring \
    --with-imap-ssl \
    --with-mysqli \
    --enable-exif \
    --with-ffi \
    --with-zip \
    --enable-sockets \
    --with-pcre-jit \
    --enable-fpm \
    --with-pdo-mysql \
    --enable-pcntl

    make && make install
```

## 6.å®‰è£…phpredisæ‰©å±•

```
cd /data/software/php8.3
	wget  http://js.funet8.com/centos_software/php8/phpredis-6.0.2.tar.gz
	tar xzf phpredis-6.0.2.tar.gz
	cd /data/software/php8.3/phpredis-6.0.2
	/data/app/php8.3/bin/phpize
	./configure --with-php-config=/data/app/php8.3/bin/php-config
	make && make install
```

## 7.å®‰è£…swooleæ‰©å±•

```
cd /data/software/php8.3
	wget  http://js.funet8.com/centos_software/php8/swoole-src-5.1.2.tar.gz
	tar -zxf swoole-src-5.1.2.tar.gz
	cd /data/software/php8.3/swoole-src-5.1.2
	/data/app/php8.3/bin/phpize
	./configure --with-php-config=/data/app/php8.3/bin/php-config
	make && make install
```

## 8.å®‰è£…rabbitmqæ‰©å±•

```
cd /data/software/php8.3
wget -c http://js.funet8.com/centos_software/rabbitmq-php/rabbitmq-c-0.8.0.tar.gz
tar zxf rabbitmq-c-0.8.0.tar.gz
		cd rabbitmq-c-0.8.0
		./configure --prefix=/usr/local/rabbitmq-c-0.8.0
		make && make install
```

## 9.å®‰è£…amqpæ‰©å±•

```
cd /data/software/php8.3
		wget  http://js.funet8.com/centos_software/php8/amqp-2.1.2.tgz
		tar -zxf amqp-2.1.2.tgz
		cd /data/software/php8.3/amqp-2.1.2
		/data/app/php8.3/bin/phpize
		./configure --with-php-config=/data/app/php8.3/bin/php-config --with-amqp --with-librabbitmq-dir=/usr/local/rabbitmq-c-0.8.0
		make && make install
```

## 10.é…ç½®phpé…ç½®

```
cp /data/software/php-8.3.3/php.ini-production /data/app/php8.3/etc/php.ini
	cp /data/software/php-8.3.3/sapi/fpm/php-fpm.conf /data/app/php8.3/etc/php-fpm.conf
	cp /data/app/php8.3/etc/php-fpm.d/www.conf.default /data/app/php8.3/etc/php-fpm.d/www.conf

    # ä¿®æ”¹ PHP-FPM é…ç½®
    sed -i "s|^listen = 127.0.0.1:9000|listen = 127.0.0.1:8300|" "/data/app/php8.3/etc/php-fpm.d/www.conf"
    sed -i "s|^;listen.allowed_clients|listen.allowed_clients|" "/data/app/php8.3/etc/php-fpm.d/www.conf"
    sed -i "s|^;pid = run/php-fpm.pid|pid = run/php-fpm.pid|" "/data/app/php8.3/etc/php-fpm.conf"
    # ä¿®æ”¹phpè¿›ç¨‹æ•°
	sed -i "s/pm\.max\_children \= 5/pm\.max\_children \= 20/g" /data/app/php8.3/etc/php-fpm.d/www.conf
    # ä¿®æ”¹ request_terminate_timeout = 30 ï¼ˆè¯·æ±‚ç»ˆæ­¢è¶…æ—¶ï¼‰
	sed -i "s/\;request\_terminate\_timeout \= 0/request\_terminate\_timeout \= 30/g" /data/app/php8.3/etc/php-fpm.d/www.conf


    # ä¿®æ”¹ PHP.ini é…ç½®
    sed -i "s|^;date.timezone =|date.timezone = Asia/Shanghai|" "/data/app/php8.3/etc/php.ini"
    sed -i "s|^memory_limit = 128M|memory_limit = 256M|" "/data/app/php8.3/etc/php.ini"
    sed -i "s|^;cgi.fix_pathinfo=1|cgi.fix_pathinfo=0|" "/data/app/php8.3/etc/php.ini"
    sed -i "s|^upload_max_filesize = 2M|upload_max_filesize = 32M|" "/data/app/php8.3/etc/php.ini"
    sed -i "s|^post_max_size = 8M|post_max_size = 32M|" "/data/app/php8.3/etc/php.ini"
    #sed -i "s|^max_execution_time = 30|max_execution_time = 300|" "/data/app/php8.3/etc/php.ini"


    #æ·»åŠ æ‰©å±•
	echo 'extension=redis.so'>> /data/app/php8.3/etc/php.ini
	#echo 'extension=zip.so'>> /data/app/php8.3/etc/php.ini
	echo 'extension=swoole.so'>> /data/app/php8.3/etc/php.ini
	echo 'extension=amqp.so'>> /data/app/php8.3/etc/php.ini
	# æ˜¾ç¤ºæ‰©å±•
	/data/app/php8.3/bin/php -m|grep redis
	/data/app/php8.3/bin/php -m|grep zip
	/data/app/php8.3/bin/php -m|grep swoole
	/data/app/php8.3/bin/php -m|grep amqp
```



## 11.é…ç½®çŽ¯å¢ƒå˜é‡

```
cp -a /data/app/php8.3/bin/php /data/app/php8.3/bin/php8.3
	echo "export PATH=$PATH:/data/app/php8.3/bin">>/etc/profile
	source /etc/profile
	php8.3 -v
```

## 12.å¼€æœºå¯åŠ¨è„šæœ¬é…ç½®

```
cat > /etc/systemd/system/php8.3-fpm.service << EOF
[Unit]
Description=PHP 8.3 FastCGI Process Manager
After=network.target

[Service]
Type=simple
PIDFile=/data/app/php8.3/var/run/php-fpm.pid
ExecStart=/data/app/php8.3/sbin/php-fpm --nodaemonize --fpm-config /data/app/php8.3/etc/php-fpm.conf
ExecReload=/bin/kill -USR2 \$MAINPID
ExecStop=/bin/kill -SIGINT \$MAINPID
PrivateTmp=true
RestartSec=5s
Restart=on-failure

[Install]
WantedBy=multi-user.target
EOF

systemctl daemon-reload
systemctl enable php8.3-fpm.service
systemctl start php8.3-fpm.service
```

## 13.é…ç½®é˜²ç«å¢™

```
    firewall-cmd --zone=public --add-port=8300/tcp --permanent
    firewall-cmd --reload
    firewall-cmd --zone=public --list-ports
```

# æœ€åŽ

æŠ˜è…¾äº†è¿™ä¹ˆä¹…ï¼Œå¯èƒ½æœ‰åŒå­¦ä¼šé—®ï¼šâ€œyum install phpä¸é¦™å—ï¼Ÿâ€æ˜Ÿå“¥æƒ³è¯´ï¼Œæºç ç¼–è¯‘çš„â€œçˆ½â€åœ¨äºŽâ€œæŽŒæŽ§æ„Ÿâ€â€”â€”ä½ å¯ä»¥ç²¾ç¡®æŽ§åˆ¶PHPçš„æ¯ä¸€ä¸ªåŠŸèƒ½ï¼Œå¯ç”¨æœ€æ–°ç‰¹æ€§ï¼Œç”šè‡³é’ˆå¯¹æœåŠ¡å™¨ç¡¬ä»¶ä¼˜åŒ–ç¼–è¯‘å‚æ•°ã€‚å½“ç„¶ï¼Œä»£ä»·æ˜¯éœ€è¦æ‰‹åŠ¨å¤„ç†ä¾èµ–å’Œå‡çº§ï¼Œä½†å¯¹äºŽè¿½æ±‚æžè‡´æ€§èƒ½å’Œå®šåˆ¶åŒ–çš„åœºæ™¯ï¼ˆå¦‚ç”Ÿäº§çŽ¯å¢ƒã€é«˜æ€§èƒ½APIæœåŠ¡ï¼‰

å†™æ–‡ä¸æ˜“ï¼Œå¦‚æžœä½ éƒ½çœ‹åˆ°äº†è¿™é‡Œï¼Œè¯·ç‚¹ä¸ªèµžå’Œåœ¨çœ‹ï¼Œåˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ï¼›ä¹Ÿåˆ«å¿˜äº†å…³æ³¨æ˜Ÿå“¥çŽ©äº‘ï¼è¿™é‡Œæœ‰æ»¡æ»¡çš„å¹²è´§åˆ†äº«ï¼Œè¿˜æœ‰è½»æ¾æœ‰è¶£çš„æŠ€æœ¯äº¤æµï½žç‚¹ä¸ªèµžã€åˆ†äº«ç»™èº«è¾¹çš„å°ä¼™ä¼´ï¼Œä¸€èµ·æˆé•¿ï¼Œä¸€èµ·çŽ©è½¬æŠ€æœ¯ä¸–ç•Œå§ï¼ ðŸ˜Š





